[{"URL": "https://www.microsoft.com/en-us/security/blog/2024/05/28/moonstone-sleet-emerges-as-new-north-korean-threat-actor-with-new-bag-of-tricks/", "author": "Microsoft Threat Intelligence", "content": "\n\t\t\t\t\n\t\t\t\t\nMicrosoft has identified a new North Korean threat actor, now tracked as Moonstone Sleet (formerly Storm-1789), that uses both a combination of many tried-and-true techniques used by other North Korean threat actors and unique attack methodologies to target companies for its financial and cyberespionage objectives. Moonstone Sleet is observed to set up fake companies and job opportunities to engage with potential targets, employ trojanized versions of legitimate tools, create a fully functional malicious game, and deliver a new custom ransomware.\n\n\n\n\n\n\nMoonstone Sleet uses tactics, techniques, and procedures (TTPs) also used by other North Korean threat actors over the last several years, highlighting the overlap among these groups. While Moonstone Sleet initially had overlaps with Diamond Sleet, the threat actor has since shifted to its own infrastructure and attacks, establishing itself as a distinct, well-resourced North Korean threat actor.\n\n\n\n\n\n\nThis blog describes several notable TTPs used by this threat actor as well as recommendations to defend against related attacks. As with any observed nation-state actor activity, Microsoft directly notifies customers that have been targeted or compromised, providing them with the necessary information to secure their environments.\n\n\n\n\n\n\nWho is Moonstone Sleet?\n\n\n\nMoonstone Sleet is a threat actor behind a cluster of malicious activity that Microsoft assesses is North Korean state-aligned and uses both a combination of many tried-and-true techniques used by other North Korean threat actors and unique attack methodologies. When Microsoft first detected Moonstone Sleet activity, the actor demonstrated strong overlaps with Diamond Sleet, extensively reusing code from known Diamond Sleet malware like Comebacker and using well-established Diamond Sleet techniques to gain access to organizations, such as using social media to deliver trojanized software. However, Moonstone Sleet quickly shifted to its own bespoke infrastructure and attacks. Subsequently, Microsoft has observed Moonstone Sleet and Diamond Sleet conducting concurrent operations, with Diamond Sleet still utilizing much of its known, established tradecraft.\n\n\n\nMoonstone Sleet has an expansive set of operations supporting its financial and cyberespionage objectives. These range from deploying custom ransomware to creating a malicious game, setting up fake companies, and using IT workers.\n\n\n\nMoonstone Sleet tradecraft\n\n\n\nMicrosoft has observed Moonstone Sleet using the TTPs discussed in the following sections in various campaigns.\n\n\n\nTrojanized PuTTY\n\n\n\nIn early August 2023, Microsoft observed Moonstone Sleet delivering a trojanized version of PuTTY, an open-source terminal emulator, via apps like LinkedIn and Telegram as well as developer freelancing platforms. Often, the actor sent targets a .zip archive containing two files: a trojanized version of putty.exe and url.txt, which contained an IP address and a password. If the provided IP and password were entered by the user into the PuTTY application, the application would decrypt an embedded payload, then load and execute it. Notably, before Moonstone Sleet used this initial access vector, Microsoft observed Diamond Sleet using a similar method \u2013 trojanized PuTTY and SumatraPDF \u2014 with comparable techniques for anti-analysis, as we reported in 2022:\n\n\nFigure 1. Code from PuTTY executable\n\n\n\nThe trojanized PuTTY executable drops a custom installer which kicks off execution of a series of stages of malware, as described below:\n\n\n\n\nStage 1 \u2013 Trojanized PuTTY: Decrypts, decompresses, and then executes the embedded stage 2 payload.\n\n\n\nStage 2 \u2013 SplitLoader installer/dropper: Decrypts, decompresses, and writes the Stage 3 payload, the SplitLoader DLL file, to disk. The installer also drops two encrypted files to disk, then executes SplitLoader via a scheduled task or registry run key.\n\n\n\nStage 3 \u2013 SplitLoader:Decrypts and decompresses the two encrypted files dropped by the stage 2 payload, then combines them to create the next-stage, another portable executable (PE) file.\n\n\n\nStage 4 \u2013 Trojan loader: Expects a compressed and encrypted PE file from the C2. Once received, the trojan loader decompresses, decrypts, and executes this file.\n\n\n\nFigure 2. Moonstone Sleet attack chain using trojanized PuTTY\n\n\n\nMicrosoft has also observed Moonstone Sleet using other custom malware loaders delivered by PuTTY that behaved similarly and had argument overlap with previously observed Diamond Sleet malware artifacts, such as the following:\n\n\n\n\n\n\nMalicious npm packages\n\n\n\nMicrosoft has observed Moonstone Sleet targeting potential victims with projects that used malicious npm packages. Often, the threat actor delivered these projects through freelancing websites or other platforms like LinkedIn. In one example, the threat actor used a fake company to send .zip files invoking a malicious npm package under the guise of a technical skills assessment. When loaded, the malicious package used curl to connect to an actor-controlled IP and drop additional malicious payloads like SplitLoader.&nbsp;In another incident, Moonstone Sleet delivered a malicious npm loader which led to credential theft from LSASS. Microsoft collaborated with GitHub to identify and remove repositories associated with this activity.\n\n\n\nMalicious tank game\n\n\n\nSince February 2024, Microsoft has observed Moonstone Sleet infecting devices using a malicious tank game it developed called DeTankWar (also called DeFiTankWar, DeTankZone, or TankWarsZone). DeTankWar is a fully functional downloadable game that requires player registration, including username/password and invite code. In this campaign, Moonstone Sleet typically approaches its targets through messaging platforms or by email, presenting itself as a game developer seeking investment or developer support and either masquerading as a legitimate blockchain company or using fake companies. To bolster the game\u2019s superficial legitimacy, Moonstone Sleet has also created a robust public campaign that includes the websites detankwar[.]com and defitankzone[.]com, and many X (Twitter) accounts for the personas it uses to approach targets and for the game itself.\n\n\nFigure 3. Example of a Moonstone Sleet X (Twitter) account for its DeTankWar game\n\n\n\nMoonstone Sleet used a fake company called C.C. Waterfall to contact targets. The email presented the game as a blockchain-related project and offered the target the opportunity to collaborate, with a link to download the game included in the body of the message. More details about C.C. Waterfall and another fake company that Moonstone Sleet set up to trick targets are included below:\n\n\nFigure 4. Moonstone Sleet using CC Waterfall to email a link to their game\n\n\n\nWhen targeted users launch the game, delfi-tank-unity.exe, additional included malicious DLLs are also loaded. The payload is a custom malware loader that Microsoft tracks as YouieLoad. Similarly to SplitLoader, YouieLoad loads malicious payloads in memory and creates malicious services that perform functions such as network and user discovery and browser data collection. For compromised devices of particular interest to the group, the threat actor launches hands-on-keyboard commands with further discovery and conducts credential theft.\n\n\nFigure 5. Page from the DeTankWar website\n\n\n\nRansomware\n\n\n\n\n\n\nIn April 2024, Microsoft observed Moonstone Sleet delivering a new custom ransomware variant we have named FakePenny against a company it previously compromised in February. FakePenny includes a loader and an encryptor. Although North Korean threat actor groups have previously developed custom ransomware, this is the first time we have observed this threat actor deploying ransomware.\n\n\n\nMicrosoft assesses that Moonstone Sleet\u2019s objective in deploying the ransomware is financial gain, suggesting the actor conducts cyber operations for both intelligence collection and revenue generation. Of note, the ransomware note dropped by FakePenny closely overlaps with the note used by Seashell Blizzard in its malware NotPetya. The ransom demand was $6.6M USD in BTC. This is in stark contrast to the lower ransom demands of previous North Korea ransomware attacks, like WannaCry 2.0 and H0lyGh0st.\n\n\nFigure 6. FakePenny ransomware note\n\n\nFigure 7. NotPetya ransomware note\n\n\n\nFake companies\n\n\n\nSince January 2024, Microsoft has observed Moonstone Sleet creating several fake companies impersonating software development and IT services, typically relating to blockchain and AI. The actor has used these companies to reach out to potential targets, using a combination of created websites and social media accounts to add legitimacy to their campaigns.\n\n\n\nStarGlow Ventures\n\n\n\nFrom January to April 2024, Moonstone Sleet\u2019s fake company StarGlow Ventures posed as a legitimate software development company. The group used a custom domain, fake employee personas, and social media accounts, in an email campaign targeting thousands of organizations in the education and software development sectors. In the emails Moonstone Sleet sent as part of this campaign, the actor complimented the work of the targeted organization and offered collaboration and support for upcoming projects, citing expertise in the development of web apps, mobile apps, blockchain, and AI.\n\n\nFigure 8. Example of an email from Moonstone Sleet\u2019s StarGlow Ventures campaign\n\n\n\nThese emails also contained a 1\u00d71 tracking pixel, which likely enabled Moonstone Sleet to track which targets engaged with the emails, and a link to a dummy unsubscribe page hosted on the StarGlow Ventures domain. While the emails did not contain any malicious links, Microsoft assesses Moonstone Sleet likely used this campaign to establish a relationship with target organizations. Although the purpose of these relationships is unclear, they may afford the actor access to organizations of interest or be used as revenue generation opportunities. Microsoft notified customers who were impacted by this Moonstone Sleet campaign.\n\n\nFigure 9. Unsubscribe page on the StarGlow Ventures website\n\n\nFigure 10. Informational pages for the StarGlow Ventures website\n\n\n\nC.C. Waterfall\n\n\n\nIn a similar campaign, Moonstone Sleet sent emails using its fake company C.C. Waterfall, a purported IT consulting organization.\n\n\nFigure 11. The landing page for C.C. Waterfall\n\n\n\nIn this campaign, Moonstone Sleet emailed higher education organizations, claiming the company was either hiring new developers or looking for business collaboration opportunities. This campaign likely had similar goals to the StarGlow Ventures campaign: to build relationships with organizations which could be leveraged for revenue generation or malicious access. &nbsp;\n\n\nFigure 12. Example of an email from C.C. Waterfall\n\n\n\nAs previously mentioned, Moonstone Sleet also used C.C. Waterfall to contact targets and invite them to download the actor\u2019s tank game, highlighting that this is a coordinated and concerted effort for which Moonstone Sleet can leverage multiple facets of its operations in overlapping campaigns.\n\n\n\nWork-for-hire\n\n\n\nIn addition to creating fake companies, Microsoft has observed Moonstone Sleet pursuing employment in software development positions at multiple legitimate companies. This activity could be consistent with previous reporting from the United States Department of Justice that North Korea was using highly skilled remote IT workers to generate revenue. On the other hand, this Moonstone Sleet activity may also be another approach to gaining access to organizations.\n\n\n\nMoonstone Sleet targets\n\n\n\nMoonstone Sleet\u2019s primary goals appear to be espionage and revenue generation. Targeted sectors to date include both individuals and organizations in the software and information technology, education, and defense industrial base sectors.\n\n\n\nSoftware companies and developers\n\n\n\nSince early January 2024, Moonstone Sleet has used the above fake software development companies to solicit work or cooperation. This actor has also targeted individuals looking for work in software development, sending candidates a \u201cskills test\u201d that instead delivers malware via a malicious NPM package.\n\n\n\nAerospace\n\n\n\nIn early December 2023, we observed Moonstone Sleet compromising a defense technology company to steal credentials and intellectual property. In April 2024, the actor ransomed the organization using FakePenny. The same month, we observed Moonstone Sleet compromise a company that makes drone technology. In May 2024, the threat actor compromised a company that makes aircraft parts.\n\n\n\nFitting into the North Korean threat actor landscape\n\n\n\n\n\n\nMoonstone Sleet\u2019s diverse set of tactics is notable not only because of their effectiveness, but because of how they have evolved from those of several other North Korean threat actors over many years of activity to meet North Korean cyber objectives. For example, North Korea has for many years maintained a cadre of remote IT workers to generate revenue in support of the country\u2019s objectives. Moonstone Sleet\u2019s pivot to conduct IT work within its campaigns indicates it may not only be helping with this strategic initiative, but possibly also expanding the use of remote IT workers beyond just financial gain. Additionally, Moonstone Sleet\u2019s addition of ransomware to its playbook, like another North Korean threat actor, Onyx Sleet, may suggest it is expanding its set of capabilities to enable disruptive operations. Microsoft reported on Onyx Sleet\u2019s and Storm-0530\u2019s h0lyGhost ransomware in 2022.\n\n\n\nMoonstone Sleet\u2019s ability to conduct concurrent operations across multiple campaigns, the robustness of the malicious game, and the use of a custom new ransomware variant are strong indications that this threat actor may be well-resourced. Moreover, given that Moonstone Sleet\u2019s initial attacks mirrored Diamond Sleet methodologies and heavily reused Diamond Sleet\u2019s code in their payloads, Microsoft assesses this actor is equipped with capabilities from prior cyber operations conducted by other North Korean actors.\n\n\n\nMicrosoft has identified several techniques used by Moonstone Sleet that have previously been used by other North Korean threat actors. For example, since late 2023, an actor that Microsoft tracks as Storm-1877 used malicious npm packages in a campaign targeting software developers with JavaScript-based malware. This campaign was reported publicly by PaloAlto as Contagious Interview. Additionally, in 2023, GitHub reported that Jade Sleet used malicious npm packages in a campaign consisting of fake developer and recruiter personas that operated on LinkedIn, Slack, and Telegram. This shared use of a relatively uncommon tactic across multiple distinct North Korean groups may suggest sharing of expertise and TTPs among North Korean threat actors.\n\n\n\nIn recent months, Microsoft and other security researchers have reported on North Korean threat actors\u2019 use of software supply chain attacks to conduct widespread malicious operations. In November 2023, Microsoft reported on Diamond Sleet\u2019s supply chain compromise of CyberLink, a multimedia application. While Microsoft has not yet identified any Moonstone Sleet supply chain attacks, the actor has extensively targeted software development firms in its campaigns. Large-scale access to software companies would pose a particularly high risk for future supply chain attacks against those organizations.\n\n\n\nMoonstone Sleet\u2019s appearance is an interesting development considering that North Korea has carried out a series of changes in its foreign relations and security apparatus. In November 2023, North Korea closed embassies in several countries, and in March 2024, may have dissolved the United Front Department (UFD), an agency believed to be responsible for reunification and propaganda.\n\n\n\nDespite being new, Moonstone Sleet has demonstrated that it will continue to mature, develop, and evolve, and has positioned itself to be a preeminent threat actor conducting sophisticated attacks on behalf of the North Korean regime.\n\n\n\nRecommendations\n\n\n\nMicrosoft recommends the following mitigations defend against attacks by Moonstone Sleet:\n\n\n\n\nDetect human-operated ransomware attacks with Microsoft Defender XDR.&nbsp;\n\n\n\nEnable controlled folder access.&nbsp;\n\n\n\nEnsure that tamper protection is enabled in Microsoft Dender for Endpoint.&nbsp;\n\n\n\nEnable network protection in Microsoft Defender for Endpoint.&nbsp;\n\n\n\nFollow the credential hardening recommendations in our on-premises credential theft overview to defend against common credential theft techniques like LSASS access.\n\n\n\nRun endpoint detection and response\u202f(EDR) in block mode\u202fso that Microsoft Defender for Endpoint can block malicious artifacts, even when your non-Microsoft antivirus does not detect the threat or when Microsoft Defender Antivirus is running in passive mode. EDR in block mode works behind the scenes to remediate malicious artifacts that are detected post-breach.\u202f\u202f\u202f&nbsp;\n\n\n\nConfigure\u202finvestigation and remediation\u202fin full automated mode to let Microsoft Defender for Endpoint take immediate action on alerts to resolve breaches, significantly reducing alert volume.&nbsp;\n\n\n\nTurn on\u202fcloud-delivered protection\u202fin Microsoft Defender Antivirus, or the equivalent for your antivirus product, to cover rapidly evolving attacker tools and techniques. Cloud-based machine learning protections block a majority of new and unknown variants.\n\n\n\n\nMicrosoft Defender XDR customers can turn on the following&nbsp;attack surface reduction rule&nbsp;to prevent common attack techniques used by Moonstone Sleet.\n\n\n\n\nBlock executable content from email client and webmail&nbsp;\n\n\n\nBlock executable files from running unless they meet a prevalence, age, or trusted list criterion&nbsp;\n\n\n\nUse advanced protection against ransomware&nbsp;\n\n\n\nBlock credential stealing from the Windows local security authority subsystem (lsass.exe)\n\n\n\n\nDetection details\n\n\n\nMicrosoft Defender Antivirus\n\n\n\nMicrosoft Defender Antivirus detects threat components as the following malware:\n\n\n\n\nBehavior:Win64/PennyCrypt\n\n\n\nHackTool:Win32/Mimikatz\n\n\n\nHackTool:Win64/Mimikatz\n\n\n\nTrojanDropper:Win32/SplitLoader\n\n\n\nTrojanDropper:Win64/YouieLoad\n\n\n\n\nMicrosoft Defender for Endpoint\n\n\n\nAlerts with the following titles in the security center can indicate threat activity on your network:&nbsp;\n\n\n\n\nMoonstone Sleet actor activity detected\n\n\n\nSuspicious activity linked to a North Korean state-sponsored threat actor has been detected\n\n\n\nDiamond Sleet Actor activity detected\n\n\n\n\nThe following alerts might also indicate threat activity associated with this threat. These alerts, however, can be triggered by unrelated threat activity:&nbsp;\n\n\n\n\nMalicious credential theft tool execution detected&nbsp;&nbsp;\n\n\n\nMimikatz credential theft tool&nbsp;\n\n\n\nRansomware-linked threat actor detected\n\n\n\nSuspicious access to LSASS service\n\n\n\n\nHunting queries\n\n\n\nMicrosoft Defender XDR\n\n\n\nMicrosoft Defender XDR customers can run the following query to find related activity in their networks:\n\n\n\nDetect Procdump dumping LSASS credentials:\n\n\nDeviceProcessEvents\n| where (FileName has_any (\"procdump.exe\",\n\"procdump64.exe\") and ProcessCommandLine has \"lsass\") or  \n(ProcessCommandLine\nhas \"lsass.exe\" and (ProcessCommandLine has \"-accepteula\"\nor ProcessCommandLine contains \"-ma\"))\n\n\n\nDetect connectivity with C2 infrastructure:\n\n\nlet c2servers = dynamic(['mingeloem.com','matrixane.com']);\nDeviceNetworkEvents\n| where RemoteUrl has_any (c2servers)\n| project DeviceId, LocalIP, DeviceName, RemoteUrl, InitiatingProcessFileName, InitiatingProcessCommandLine, Timestamp\n\n\n\nDetect connectivity to DeTank websites:\n\n\nlet c2servers = dynamic(['detankwar.com','defitankzone.com']);\nDeviceNetworkEvents\n| where RemoteUrl has_any (c2servers)\n| project DeviceId, LocalIP, DeviceName, RemoteUrl, InitiatingProcessFileName, InitiatingProcessCommandLine, Timestamp\n\n\n\nMicrosoft Sentinel\n\n\n\nMicrosoft Sentinel customers can use the TI Mapping analytics (a series of analytics all prefixed with \u2018TI map\u2019) to automatically match the malicious domain indicators mentioned in this blog post with data in their workspace. If the TI Map analytics are not currently deployed, customers can install the Threat Intelligence solution from the Microsoft Sentinel Content Hub to have the analytics rule deployed in their Sentinel workspace.\n\n\n\nMicrosoft Sentinel customers can also use the queries below to detect activity detailed in this blog.\n\n\n\nThis query detects the installation of a Windows service that contains artifacts from credential dumping tools such as Mimikatz:\n\n\n\n\nCredential Dumping Tools \u2013 Service Installation\n\n\n\n\nThis query detects the use of Procdump to dump credentials from LSASS memory:\n\n\n\n\nDump credential using procdump\n\n\n\n\nMicrosoft Sentinel customers can also use the following query, which looks for Microsoft Defender AV detections related to the Moonstone Sleet. In Microsoft Sentinel, the SecurityAlerts table includes only the DeviceName of the affected device. This query joins the DeviceInfo table to connect other information such as device group, IP, signed-in users, etc., allowing analysts to have more context related to the alert, if available:\n\n\nlet MoonStoneSleet_threats = dynamic([\"Behavior:Win64/PennyCrypt\", \"HackTool:Win32/Mimikatz\", \"HackTool:Win64/Mimikatz \", \"TrojanDropper:Win32/SplitLoader\", \"TrojanDropper:Win64/YouieLoad\" ]);\nSecurityAlert\n| where ProviderName == \"MDATP\"\n| extend ThreatName = tostring(parse_json(ExtendedProperties).ThreatName)\n| extend ThreatFamilyName = tostring(parse_json(ExtendedProperties).ThreatFamilyName)\n| where ThreatName in~ (MoonStoneSleet_threats) or ThreatFamilyName in~ (MoonStoneSleet_threats)\n| extend CompromisedEntity = tolower(CompromisedEntity)\n| join kind=inner (\n    DeviceInfo\n    | extend DeviceName = tolower(DeviceName)\n) on $left.CompromisedEntity == $right.DeviceName\n| summarize arg_max(TimeGenerated, *) by DisplayName, ThreatName, ThreatFamilyName, PublicIP, AlertSeverity, Description, tostring(LoggedOnUsers), DeviceId, TenantId, CompromisedEntity, ProductName, Entities\n| extend HostName = tostring(split(CompromisedEntity, \".\")[0]), DomainIndex = toint(indexof(CompromisedEntity, '.'))\n| extend HostNameDomain = iff(DomainIndex != -1, substring(CompromisedEntity, DomainIndex + 1), CompromisedEntity)\n| project-away DomainIndex\n| project TimeGenerated, DisplayName, ThreatName, ThreatFamilyName, PublicIP, AlertSeverity, Description, LoggedOnUsers, DeviceId, TenantId, CompromisedEntity, ProductName, Entities, HostName, HostNameDomain\n\n\n\nIndicators of compromise\n\n\n\nMalicious files\n\n\n\nFileSHA-256 hashputty.exe (drops SplitLoader)f59035192098e44b86c4648a0de4078edbe80352260276f4755d15d354f5fc58putty.exe (drops SplitLoader)cb97ec024c04150ad419d1af2d1eb66b5c48ab5f345409d9d791db574981a3fb[random].dat (SplitLoader)39d7407e76080ec5d838c8ebca5182f3ac4a5f416ff7bda9cbc4efffd78b4ff5Package.db, thumbs.db (YouieLoad via npm)70c5b64589277ace59db86d19d846a9236214b48aacabbaf880f2b6355ab5260adb.bin, u.bin, Id.bin(YouieLoad)cafaa7bc3277711509dc0800ed53b82f645e86c195e85fbf34430bbc75c39c24data.tmp (YouieLoad)9863173e0a45318f776e36b1a8529380362af8f3e73a2b4875e30d31ad7bd3c1delfi-tank-unity.exef66122a3e1eaa7dcb7c13838037573dace4e5a1c474a23006417274c0c8608beDeTankWar.exe56554117d96d12bd3504ebef2a8f28e790dd1fe583c33ad58ccbf614313ead8c ecce739b556f26de07adbfc660a958ba2dca432f70a8c4dd01466141a6551146NVUnityPlugin.dll, Unityplayer.dll (YouieLoad via tank game)09d152aa2b6261e3b0a1d1c19fa8032f215932186829cfcca954cc5e84a6cc38\n\n\n\nMoonstone Sleet domains\n\n\n\nbestonlinefilmstudio[.]orgblockchain-newtech[.]comccwaterfall[.]comchaingrown[.]comdefitankzone[.]comdetankwar[.]comfreenet-zhilly[.]orgmatrixane[.]compointdnt[.]comstarglowventures[.]commingeloem[.]com\n\n\n\nReferences\n\n\n\n\nHacking Employers and Seeking Employment: Two Job-Related Campaigns Bear Hallmarks of North Korean Threat Actors (Palo Alto Unit 42)\n\n\n\nSecurity alert: social engineering campaign targets technology industry employees (Github)\n\n\n\n\nLearn more\n\n\n\nFor the latest security research from the Microsoft Threat Intelligence community, check out the Microsoft Threat Intelligence Blog:&nbsp;https://aka.ms/threatintelblog.\n\n\n\nTo get notified about new publications and to join discussions on social media, follow us on LinkedIn at https://www.linkedin.com/showcase/microsoft-threat-intelligence, and on X (formerly Twitter) at&nbsp;https://twitter.com/MsftSecIntel.\n\n\n\nTo hear stories and insights from the Microsoft Threat Intelligence community about the ever-evolving threat landscape, listen to the Microsoft Threat Intelligence podcast: https://thecyberwire.com/podcasts/microsoft-threat-intelligence.\n\t\t\t", "mentioned_links": ["https://www.microsoft.com/en-us/security/blog/products/microsoft-defender/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-external-id", "https://education.microsoft.com/", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-endpoint-privilege-management", "https://learn.microsoft.com/defender-endpoint/attack-surface-reduction-rules-reference#block-executable-files-from-running-unless-they-meet-a-prevalence-age-or-trusted-list-criterion", "https://www.microsoft.com/en-us/msrc/", "https://www.microsoft.com/en-us/trust-center", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/ransomware/", "https://learn.microsoft.com/defender-endpoint/attack-surface-reduction-rules-reference#use-advanced-protection-against-ransomware", "https://learn.microsoft.com/defender-endpoint/attack-surface-reduction-rules-reference#block-executable-content-from-email-client-and-webmail", null, "https://azure.microsoft.com/en-us/products/key-vault/", "https://partner.microsoft.com/en-US/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-xdr", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-audit", "https://github.com/features/security", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-external-attack-surface-management", "https://www.microsoft.com/en-us/events", "https://learn.microsoft.com/defender-endpoint/enable-network-protection", "https://learn.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#block-credential-stealing-from-the-windows-local-security-authority-subsystem", "https://azure.microsoft.com/en-us/products/ddos-protection/", "https://unit42.paloaltonetworks.com/two-campaigns-by-north-korea-bad-actors-target-job-hunters/", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-compliance-manager", "https://learn.microsoft.com/defender-xdr/playbook-detecting-ransomware-m365-defender", "https://www.microsoft.com/en-us/security/blog/2023/10/18/multiple-north-korean-threat-actors-exploiting-the-teamcity-cve-2023-42793-vulnerability/", "https://www.microsoft.com/en-us/industry/consumer-goods", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-private-access", "https://www.microsoft.com/en-us/security/business/partnerships", "https://account.microsoft.com/", "https://blogs.microsoft.com/", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/vulnerabilities-and-exploits/", "https://www.youtube.com/channel/UC4s3tv0Qq_OSUBfR735Jc6A", "https://www.microsoft.com/en-us/security/blog/2022/07/14/north-korean-threat-actor-targets-small-and-midsize-businesses-with-h0lygh0st-ransomware/", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-cloud-pki", "https://www.microsoft.com/en-us/security/business/get-started/contact-us", "https://www.microsoft.com/en-us/security/business/solutions/extended-detection-response-xdr", "https://www.microsoft.com/en-us/microsoft-viva", "https://www.microsoft.com/en-us/security/business/microsoft-purview", "https://twitter.com/msftsecurity", "https://news.microsoft.com/", "https://servicetrust.microsoft.com/", "https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=TrojanDropper:Win32/SplitLoader.A!dha", "https://www.microsoft.com/en-us/security", "https://www.microsoft.com/en-us/security/business/microsoft-priva", "https://dynamics.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/blog/products/microsoft-defender-threat-intelligence/", "https://www.microsoft.com/en-us/microsoft-copilot", "https://aka.ms/yourcaliforniaprivacychoices", "https://www.microsoft.com/en-us/industry/government", "https://about.ads.microsoft.com/en-us?s_cid=dig-src_uhfcomm", "https://aka.ms/threatintelblog", "https://www.microsoft.com/en-us/security/blog/2023/11/22/diamond-sleet-supply-chain-compromise-distributes-a-modified-cyberlink-installer/", "https://www.microsoft.com/en-us/industry", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-data-lifecycle-management", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-workload-id", "https://www.facebook.com/sharer.php?u=https://www.microsoft.com/en-us/security/blog/2024/05/28/moonstone-sleet-emerges-as-new-north-korean-threat-actor-with-new-bag-of-tricks/", "https://learn.microsoft.com/security/ransomware/", "https://www.microsoft.com/en-us/security/business/security-101", "https://www.microsoft.com/en-us/security/blog/2021/01/28/zinc-attacks-against-security-researchers/", "https://www.microsoft.com/en-us/d/Surface-Laptop-Studio-2/8rqr54krf1dz", "https://learn.microsoft.com/en-us/learn/topics/sci?wt.mc_id=techcom_header-webpage-m365", "https://www.microsoft.com/en-us/d/Surface-Laptop-Go-3/8p0wwgj6c6l2", "https://www.microsoft.com/en-us/security/security-insider/microsoft-digital-defense-report-2023", "https://support.microsoft.com/contactus", "https://learn.microsoft.com/", "#recommendations", "https://www.microsoft.com/en-us/mixed-reality/windows-mixed-reality", "https://thecyberwire.com/podcasts/microsoft-threat-intelligence", "https://learn.microsoft.com/en-us/security/", "https://azure.microsoft.com/en-us/solutions/quantum-computing/", "https://www.microsoft.com/en-us/security/business/services", "https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Windows%20Security%20Events/Hunting%20Queries/SuspectedLSASSDump.yaml", "https://www.microsoft.com/en-us/security/blog/content-type/research/", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-cloud-security-posture-management", "https://www.microsoft.com/en-us/power-platform", "https://twitter.com/MsftSecIntel", "https://www.microsoft.com/en-us/security/business/services/microsoft-defender-experts-xdr", "https://www.microsoft.com/en-us/security/business/solutions/generative-ai-cybersecurity", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/supply-chain-attacks/", "https://www.microsoft.com/en-us/education/devices/overview", "https://www.microsoft.com/en-us/security/business/microsoft-Intune", "https://www.microsoft.com/en-us/accessibility", "https://go.microsoft.com/fwlink/?linkid=2196228", "https://www.microsoft.com/en-us/industry/manufacturing/microsoft-cloud-for-manufacturing", "https://techcommunity.microsoft.com/", "https://techcommunity.microsoft.com/t5/security-compliance-and-identity/ct-p/MicrosoftSecurityandCompliance", "https://www.microsoft.com/en-us/microsoft-products-and-apps", "https://www.microsoft.com/en-us/microsoft-365/business", "https://partner.microsoft.com/en-us/membership", "https://www.microsoft.com/en-us/security/blog/", "https://www.microsoft.com/en-us/store/b/certified-refurbished-products", "https://www.microsoft.com/en-us/store/b/business?icid=CNavBusinessStore", "https://about.ads.microsoft.com/en-us/partners/welcome?s_cid=en-us-gct-web-src_ext-sub_0-flx_uhfcombepartner", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-endpoint", "https://learn.microsoft.com/docs/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-verified-id", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-cloud-apps", "https://www.microsoft.com/en-us/microsoft-cloud", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-communication-compliance", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-ediscovery", "https://go.microsoft.com/fwlink/?LinkID=206977", "https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=HackTool:Win32/Mimikatz", "https://www.microsoft.com/en-us/security/business/solutions/privacy-risk-management", "https://twitter.com/intent/tweet?url=https://www.microsoft.com/en-us/security/blog/2024/05/28/moonstone-sleet-emerges-as-new-north-korean-threat-actor-with-new-bag-of-tricks/", "https://www.microsoft.com", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-insider-risk-management", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-business", "https://www.microsoft.com/en-us/insidetrack", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-sentinel", "https://partner.microsoft.com/en-US/membership/cloud-solution-provider", "https://www.microsoft.com/en-us/education", "https://www.microsoft.com/en-us/security/business/zero-trust", "https://learn.microsoft.com/microsoft-365/security/defender-endpoint/edr-in-block-mode", "https://www.microsoft.com/en-us/security/blog/2022/09/29/zinc-weaponizing-open-source-software/", "https://azure.microsoft.com/en-us/free/students/", "https://learn.microsoft.com/microsoft-365/security/defender-endpoint/automated-investigations", "https://www.microsoft.com/en-us/store/b/education", "https://go.microsoft.com/fwlink/?LinkId=521839", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-permissions-management ", "https://www.microsoft.com/en-us/security/business/reports-analysis/industry-recognized-cybersecurity-leader", "https://learn.microsoft.com/defender-endpoint/prevent-changes-to-security-settings-with-tamper-protection#how-do-i-configure-or-manage-tamper-protection", "https://www.microsoft.com/en-us/download", "https://www.microsoft.com/en-us/windows-365", "https://www.microsoft.com/en-us/security/business/microsoft-incident-response", "https://www.microsoft.com/en-us/sitemap1.aspx", "https://www.microsoft.com/en-us/security/business/services/microsoft-defender-experts-hunting", "https://www.linkedin.com/showcase/microsoft-threat-intelligence", "https://www.microsoft.com/en-us/security/business/threat-protection/microsoft-defender-vulnerability-management ", "https://www.microsoft.com/en-us/sustainability/", "https://www.microsoft.com/en-us/surface/devices/surface-laptop-7th-edition", "https://www.microsoft.com/windows/windows-11-apps", "https://www.microsoft.com/en-us/education/products/teams", "https://azuremarketplace.microsoft.com/en-us/", "https://learn.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction", "https://www.microsoft.com/investor/default.aspx", "https://www.linkedin.com/shareArticle?mini=true&url=https://www.microsoft.com/en-us/security/blog/2024/05/28/moonstone-sleet-emerges-as-new-north-korean-threat-actor-with-new-bag-of-tricks/", "https://www.microsoft.com/en-us/store/b/payment-financing-options?icid=footer_financing_vcc", "https://www.microsoft.com/en-us/diversity/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-threat-intelligence", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id-governance", "https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Attacker%20Tools%20Threat%20Protection%20Essentials/Analytic%20Rules/CredentialDumpingServiceInstallation.yaml", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-internet-access", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-cloud", "https://www.microsoft.com/en-us/security/business/microsoft-defender", "https://www.linkedin.com/showcase/microsoft-security/", "https://events.microsoft.com/en-us/allevents/?language=English&clientTimeZone=1&search=security", "https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Behavior:Win64/PennyCrypt.A!nri&threatId=-2147060569", "https://www.microsoft.com/en-us/security/business/services/microsoft-security-enterprise-services", "https://azure.microsoft.com/en-us/products/web-application-firewall/", "https://www.microsoft.com/en-us/security/blog/products/microsoft-sentinel/", "https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=TrojanDropper:Win64/YouieLoad.A!dha&threatId=-2147055878", "https://azure.microsoft.com/en-us/products/microsoft-entra-ds", "https://azure.microsoft.com/en-us/services/azure-firewall/", "https://www.microsoft.com/en-us/store/b/why-microsoft-store?icid=footer_why-msft-store_7102020", "https://go.microsoft.com/fwlink/?linkid=2196227", "javascript:void(0)", "https://learn.microsoft.com/en-us/security", "https://www.microsoft.com/en-us/security/blog/products/microsoft-defender-xdr/", "https://www.microsoft.com/en-us/sitemap.aspx", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/attacker-techniques-tools-and-infrastructure/", "#", "https://www.microsoft.com/en-us/security/business/ai-machine-learning/microsoft-copilot-security", "https://www.microsoft.com/en-us/industry/financial-services/banking", "https://www.microsoft.com/en-us/about", "https://www.microsoft.com/en-us/store/b/returns", "https://www.microsoft.com/en-us/security/locale", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-security-exposure-management", "https://learn.microsoft.com/azure/sentinel/sentinel-solutions-deploy", "https://www.microsoft.com/en-us/industry/health/microsoft-cloud-for-healthcare", "https://www.microsoft.com/en-us/security/business/cybersecurity-awareness", "https://www.microsoft.com/en-us/microsoft-teams/group-chat-software", "https://www.microsoft.com/en-us/security/blog/tag/sleet/", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-data-loss-prevention", "https://www.microsoft.com/en-us/security/business/solutions/data-security", "https://privacy.microsoft.com/en-us", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-advanced-analytics", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-remote-help", "https://www.microsoft.com/en-us/hololens", "https://customers.microsoft.com/en-us/search?sq=Microsoft%20Security&ff=&p=0&so=story_publish_date%20desc", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id-protection ", "https://developer.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-office-365", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-enterprise-application-management", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-for-identity", "https://www.microsoft.com/en-us/research/", "https://www.microsoft.com/en-us/industry/automotive", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/threat-actors/", "https://www.microsoft.com/en-us/dynamics-365", "https://careers.microsoft.com/", "https://learn.microsoft.com/defender-endpoint/enable-controlled-folders", "https://www.microsoft.com/en-us/security/business/services/compliance-program-microsoft-cloud", "#malicious-tank-game", "https://www.microsoft.com/en-us/security/business/get-started/start-free-trial", "https://www.microsoft.com/en-us/security/business/solutions/cloud-workload-protection", "https://www.microsoft.com/en-us/legal/compliance/recycling", "https://www.microsoft.com/en-us/security?wt.mc_id=AID730391_QSG_BLOG_319247&ocid=AID730391_QSG_BLOG_319247", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-iot", "https://www.microsoft.com/en-us/security/blog/author/microsoft-security-threat-intelligence/", "https://www.microsoft.com/en-us/surface/devices/surface-pro-11th-edition", "https://www.microsoft.com/en-us/windows/copilot-ai-features", "https://account.microsoft.com/orders", "https://www.microsoft.com/en-us/ai", "https://www.microsoft.com/en-us/education/buy-license/microsoft365", "https://go.microsoft.com/fwlink/?linkid=2259814", "https://www.microsoft.com/en-us/securityengineering", "https://www.microsoft.com/en-us/security/business/solutions/identity-access", "https://www.microsoft.com/en-us/microsoft-365/business/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id", "https://www.microsoft.com/en-us/licensing/", "https://learn.microsoft.com/microsoft-365/security/defender-endpoint/configure-block-at-first-sight-microsoft-defender-antivirus", "https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=HackTool:Win64/Mimikatz&threatId=-2147280206", "https://choice.microsoft.com", "https://www.microsoft.com/en-us/security/security-insider/", "https://www.microsoft.com/en-us/security/business/solutions/ai-powered-unified-secops-platform", "https://azure.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-information-protection", "https://www.microsoft.com/en-us/security/blog/topic/threat-intelligence/", "https://www.microsoft.com/en-us/security/business/solutions/cloud-security", "https://github.blog/2023-07-18-security-alert-social-engineering-campaign-targets-technology-industry-employees/", "https://www.microsoft.com/en-us/security/blog/products/microsoft-defender-for-endpoint/", "#ransomware", "https://www.microsoft.com/en-us/microsoft-365/business/copilot-for-microsoft-365", "https://about.ads.microsoft.com/en-us/resources/microsoft-advertising-partner-program/microsoft-advertising-partner-program", "https://azure.microsoft.com/en-us/solutions/space/", "https://visualstudio.microsoft.com/", "https://www.microsoft.com/en-us/security/business/privacy/microsoft-priva-risk-management", "https://www.microsoft.com/en-us/security/business/privacy/microsoft-priva-subject-rights-requests", "https://appsource.microsoft.com/en-us/", "https://go.microsoft.com/fwlink/?linkid=2139749", "https://www.microsoft.com/education/how-to-buy", "https://www.microsoft.com/en-us/security/business/microsoft-entra", "https://www.microsoft.com/en-us/microsoft-cloud/resources/secure-future-initiative"]}, {"URL": "https://www.microsoft.com/en-us/security/blog/2024/07/02/vulnerabilities-in-panelview-plus-devices-could-lead-to-remote-code-execution/", "author": "Microsoft Threat Intelligence", "content": "\n\t\t\t\t\n\t\t\t\t\nMicrosoft discovered and responsibly disclosed two vulnerabilities in Rockwell Automation PanelView Plus that could be remotely exploited by unauthenticated attackers, allowing them to perform remote code execution (RCE) and denial-of-service (DoS). The RCE vulnerability in PanelView Plus involves two custom classes that can be abused to upload and load a malicious DLL into the device. The DoS vulnerability takes advantage of the same custom class to send a crafted buffer that the device is unable to handle properly, thus leading to a DoS.\n\n\n\nPanelView Plus devices are graphic terminals, also known as human machine interface (HMI) and are used in the industrial space. These vulnerabilities can significantly impact organizations using the affected devices, as attackers could exploit these vulnerabilities to remotely execute code and disrupt operations.\n\n\n\nWe shared these findings with Rockwell Automation through Coordinated Vulnerability Disclosure (CVD) via Microsoft Security Vulnerability Research (MSVR) in May and July 2023. Rockwell published two advisories and released security patches in September and October 2023. We want to thank the Rockwell Automation product security team for their responsiveness in fixing this issue. We highly recommend PanelView Plus customers to apply these security patches. \n\n\n\nThe discovered vulnerabilities are summarized in the table below:\n\n\n\n\n\n\n\nIn this blog post, we will focus on the technical details of the CVE-2023-2071 remote code execution vulnerability and how it was discovered, as well as provide an overview of the protocol used for both the RCE and DoS vulnerabilities. Additionally, we will offer technical details about the vulnerability and demonstrate the exploitation method. By sharing this research with the larger security community, we aim to emphasize the importance of collaboration in the effort to secure platforms and devices.\n\n\n\nSuspicious remote registry query\n\n\n\nOne of the primary responsibilities of the Microsoft Defender for IoT research team is to ensure that the product properly analyzes various operational technology (OT) and Internet of Things (IoT) protocols. During this process, we observed a legitimate packet capture of two devices communicating using the Common Industrial Protocol (CIP), with one device sending a request containing a path to a registry value named \u201cProductCode,\u201d and the other device responding with what appeared to be the product code value. The lack of encryption and absence of prior authentication in the communication raised concerns, as it appeared to involve a remote registry query. Further investigation revealed that the requesting device was an engineering workstation, and the responding device was an HMI \u2013 specifically, PanelView Plus.\n\n\n\nWe hypothesized that this remote registry querying functionality could be abused by querying system keys to access secrets or even gain remote control. To validate this hypothesis, we needed to locate the code responsible for this functionality. Since the two devices communicated using the CIP, our first step was to understand the protocol in depth.\n\n\nFigure 1. The packet that triggered our investigation\n\n\n\nObject-oriented protocol for industrial automation applications\n\n\n\nCIP is an industrial protocol designed for industrial automation applications. Various vendors in the industrial sector utilize this protocol, and the communication we observed took place over Ethernet/IP \u2013 a protocol that adapts CIP to standard Ethernet.\n\n\n\nAccording to the official CIP documentation: \u201cA CIP node is modeled as a collection of Objects. (\u2026) A Class is a set of Objects that all represent the same kind of system component. An Object Instance is the actual representation of a particular Object within a Class.\u201d\n\n\n\nFrom this description, we can deduce that CIP is an object-oriented protocol, where messages are directed towards specific objects, identified by their Class ID and Object Instance ID. Additionally, the term \u201cService Code\u201d is defined as: \u201cAn integer identification value which denotes an action request that can be directed at a particular object instance or object attribute\u201d. Therefore, when messaging an object, we should also specify a Service Code, which informs the object what action it should perform.\n\n\n\nThe CIP specification outlines common Class IDs and Service IDs, as well as ranges for vendor-specific IDs.\n\n\nFigure 2. The packet\u2019s fields\n\n\n\nReturning to the packet capture, we observed that both Service ID and Class ID values were vendor specific. This means that to understand the meaning of these Class and Service IDs and locate the code responsible for the functionality, we must analyze the HMI firmware.\n\n\n\nFirmware analysis\n\n\n\nAccording to Rockwell Automation\u2019s online resources, PanelView Plus HMIs operate on the Windows 10 IoT (or Windows CE for older versions) operating system. We were able to extract the DLLs and executables related to Rockwell Automation from the most recent firmware. There are several DLLs responsible for receiving different Class IDs and processing their requests, one of which is responsible for processing the Class ID we observed in the packet capture.\n\n\nFigure 3 Registry query by data from CIP\n\n\n\nUpon examining the functionality associated with this Class ID, we confirmed that it is indeed responsible for querying the registry and sending the value in the response. However, we also discovered that the code managing this functionality performs input verification, allowing the reading of registry values only from specific Rockwell keys.\n\n\n\nPotentially exploitable custom class\n\n\n\nAlthough our initial hypothesis was proven incorrect, this finding allowed us to gain valuable insights into Rockwell\u2019s process of handling different CIP classes. Additionally, we learned how to identify the classes that a specific DLL is responsible for processing. This knowledge leads us to our second hypothesis: there might be another custom class, managed by the same DLL as the one responsible for the registry class, that could be exploited to gain remote control of the device.\n\n\n\nRemote code execution\n\n\n\nWe began analyzing the DLL that handles the custom CIP class for reading and writing registry keys and discovered that this DLL also manages two other undocumented custom CIP classes from Rockwell. We decided to investigate these classes further to determine if they could be exploited for our attack and help validate our hypothesis.\n\n\n\nCustom class 1\n\n\n\nThe first class we examined had an intriguing functionality: it accepts a path to a DLL file, a function name, and a third parameter as input. It then loads the DLL using LoadLibrary and calls the specified function using GetProcAddress, passing the third parameter as an argument.\n\n\n\nFigure 4 LoadLibrary based on CIP data\n\n\n\nThis seemed like a possible avenue for executing arbitrary code. However, there was a catch: the class included a verification function that checked if the DLL name was remotehelper.dll and if the function name was one of the predefined values. If these conditions were not met, the class would return an error and not execute the function.\n\n\n\nCustom class 2\n\n\n\nNext, we examined the second class found within the same DLL. This class allowed reading and writing files on the device. It also included a verification function, but it was more permissive: it only checked whether the path for reading/writing began with a specific string. We realized that this class could potentially be exploited by uploading a malicious DLL to the device and place it in almost any location.\n\n\n\nExploitation approach\n\n\n\nHaving gained a comprehensive understanding of the vulnerabilities, we had an idea of how an attacker could utilize the two custom classes to launch code remotely on the device. The idea was to compile a DLL compatible with Windows 10 IoT, the operating system of the device. This DLL would contain the code we wanted to run on the device and would be exported under the name GetVersion, which is one of the valid function names that can be invoked by custom class 1. We would then use custom class 2 to upload our DLL to the device, placing it in a random folder and naming it remotehelper.dll. Finally, we would execute it using custom class 1.\n\n\nFigure 5. Exploitation approach\n\n\n\nTo further explore how the vulnerability can be exploited, we decided to leverage an existing function in the original remotehelper.dll file. We discovered that this file had an export called InvokeExe, which allowed running any executable file on the device. However, this function was not in the list of valid function names for custom class 1, so we could not use it directly. To overcome this obstacle, we patched the remotehelper.dll file and altered one of the valid export names to point to the InvokeExe function. We then uploaded our patched DLL to the device, placing it in a different folder than the original. Subsequently, we used custom class 1 to invoke our patched DLL and run cmd.exe, which granted us a command shell on the device. We confirmed that the exploit was successful and that we had gained full control of the device.\n\n\nFigure 6. Exploit PoC\n\n\n\nMitigation and protection guidance\n\n\n\nMicrosoft recommends the following measures to help protect organizations from attacks that take advantage of the PanelView Plus vulnerabilities shared in this blog post:\n\n\n\n\nApply patches to affected devices in your network. FactoryTalk View ME v12/v13 and FactoryTalk\u00ae Linx v6.20/v6.30 on PanelView Plus are vulnerable to the discovered vulnerabilities. It is recommended to first identify the devices in your network that are impacted by those vulnerabilities. It is also recommended to&nbsp;install the following patches on the device:PN1645 | FactoryTalk View Machine Edition Vulnerable to Remote Code Execution\n\nPN1652 | FactoryTalk\u00ae Linx Vulnerable to Denial-of-Service and Information Disclosure\n\n\n\n\n\nMake sure all critical devices, such as PLCs, routers, PCs, etc., are disconnected from the internet and segmented, regardless of whether they run Rockwell\u2019s FactoryTalk View.&nbsp;&nbsp;\n\n\n\nLimit access to CIP devices to authorized components only.&nbsp;\n\n\n\n\nTo assist with identifying impacted devices, Microsoft released a tool for scanning and performing forensics investigation on Rockwell Rslogix devices as part of its arsenal of open-source tools available on GitHub.\n\n\n\nMicrosoft Defender for IoT detections\n\n\n\nMicrosoft Defender for IoT provides the following protection measures against these vulnerabilities, associated exploits, and other malicious behavior:&nbsp;&nbsp;\n\n\n\n\nDefender for IoT detects and classifies devices that use&nbsp;CIP. &nbsp;\n\n\n\nDefender for IoT raises&nbsp;alerts&nbsp;on unauthorized access to devices using CIP, and abnormal behavior in these devices.&nbsp;&nbsp;\n\n\n\nDefender for IoT raises alerts if a threat actor attempts to exploit these vulnerabilities.&nbsp;Alert type: \u201cSuspicion of Malicious Activity\u201d.\n\n\n\n\n\n\n\n\nYuval GordonMicrosoft Threat Intelligence Community\n\n\n\n\n\n\n\nReferences\n\n\n\n\nhttps://www.odva.org/wp-content/uploads/2020/06/PUB00123R1_Common-Industrial_Protocol_and_Family_of_CIP_Networks.pdf\n\n\n\nhttps://www.rockwellautomation.com/en-us/trust-center/security-advisories/advisory.PN1652.html\n\n\n\nhttps://www.rockwellautomation.com/en-us/trust-center/security-advisories/advisory.PN1645%20.html\n\n\n\n\nLearn more\n\n\n\nFor the latest security research from the Microsoft Threat Intelligence community, check out the Microsoft Threat Intelligence Blog:&nbsp;https://aka.ms/threatintelblog.\n\n\n\nTo get notified about new publications and to join discussions on social media, follow us on LinkedIn at https://www.linkedin.com/showcase/microsoft-threat-intelligence, and on X (formerly Twitter) at&nbsp;https://twitter.com/MsftSecIntel.\n\n\n\nTo hear stories and insights from the Microsoft Threat Intelligence community about the ever-evolving threat landscape, listen to the Microsoft Threat Intelligence podcast: https://thecyberwire.com/podcasts/microsoft-threat-intelligence.\n\t\t\t", "mentioned_links": ["https://www.microsoft.com/en-us/security/blog/products/microsoft-defender/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-external-id", "https://education.microsoft.com/", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-endpoint-privilege-management", "https://twitter.com/intent/tweet?url=https://www.microsoft.com/en-us/security/blog/2024/07/02/vulnerabilities-in-panelview-plus-devices-could-lead-to-remote-code-execution/", "https://www.microsoft.com/en-us/msrc/", "https://www.microsoft.com/en-us/trust-center", "https://azure.microsoft.com/en-us/products/key-vault/", "https://partner.microsoft.com/en-US/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-xdr", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-audit", "https://www.microsoft.com/msrc/cvd?rtc=1", "https://github.com/features/security", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-external-attack-surface-management", "https://www.microsoft.com/en-us/events", "https://azure.microsoft.com/en-us/products/ddos-protection/", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-compliance-manager", "https://www.microsoft.com/en-us/industry/consumer-goods", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-private-access", "https://www.microsoft.com/en-us/security/business/partnerships", "https://www.facebook.com/sharer.php?u=https://www.microsoft.com/en-us/security/blog/2024/07/02/vulnerabilities-in-panelview-plus-devices-could-lead-to-remote-code-execution/", "https://account.microsoft.com/", "https://blogs.microsoft.com/", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/vulnerabilities-and-exploits/", "https://www.youtube.com/channel/UC4s3tv0Qq_OSUBfR735Jc6A", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-cloud-pki", "https://www.microsoft.com/en-us/security/business/get-started/contact-us", "https://www.microsoft.com/en-us/security/business/solutions/extended-detection-response-xdr", "https://www.microsoft.com/en-us/microsoft-viva", "https://www.microsoft.com/en-us/security/business/microsoft-purview", "https://twitter.com/msftsecurity", "https://news.microsoft.com/", "https://servicetrust.microsoft.com/", "https://www.microsoft.com/en-us/security", "https://www.microsoft.com/en-us/security/business/microsoft-priva", "https://dynamics.microsoft.com/en-us/", "https://www.microsoft.com/en-us/microsoft-copilot", "https://aka.ms/yourcaliforniaprivacychoices", "https://www.microsoft.com/en-us/industry/government", "https://www.rockwellautomation.com/en-us/trust-center/security-advisories/advisory.PN1645%20.html", "https://about.ads.microsoft.com/en-us?s_cid=dig-src_uhfcomm", "https://aka.ms/threatintelblog", "https://www.microsoft.com/en-us/industry", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-data-lifecycle-management", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-workload-id", "https://www.microsoft.com/en-us/security/business/security-101", "https://www.microsoft.com/en-us/d/Surface-Laptop-Studio-2/8rqr54krf1dz", "https://learn.microsoft.com/en-us/learn/topics/sci?wt.mc_id=techcom_header-webpage-m365", "https://www.microsoft.com/en-us/d/Surface-Laptop-Go-3/8p0wwgj6c6l2", "https://www.microsoft.com/en-us/security/security-insider/microsoft-digital-defense-report-2023", "https://support.microsoft.com/contactus", "https://learn.microsoft.com/", "https://www.microsoft.com/en-us/mixed-reality/windows-mixed-reality", "https://thecyberwire.com/podcasts/microsoft-threat-intelligence", "https://learn.microsoft.com/en-us/security/", "https://azure.microsoft.com/en-us/solutions/quantum-computing/", "https://www.microsoft.com/en-us/security/business/services", "https://www.microsoft.com/en-us/security/blog/content-type/research/", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-cloud-security-posture-management", "https://www.microsoft.com/en-us/power-platform", "https://twitter.com/MsftSecIntel", "https://www.microsoft.com/en-us/security/business/services/microsoft-defender-experts-xdr", "https://www.microsoft.com/en-us/security/business/solutions/generative-ai-cybersecurity", "https://www.microsoft.com/en-us/education/devices/overview", "https://www.microsoft.com/en-us/accessibility", "https://www.microsoft.com/en-us/security/business/microsoft-Intune", "https://go.microsoft.com/fwlink/?linkid=2196228", "https://learn.microsoft.com/azure/defender-for-iot/organizations/alert-engine-messages", "https://www.microsoft.com/en-us/industry/manufacturing/microsoft-cloud-for-manufacturing", "https://techcommunity.microsoft.com/", "https://techcommunity.microsoft.com/t5/security-compliance-and-identity/ct-p/MicrosoftSecurityandCompliance", "https://www.microsoft.com/en-us/microsoft-products-and-apps", "https://www.microsoft.com/en-us/microsoft-365/business", "https://partner.microsoft.com/en-us/membership", "https://www.microsoft.com/en-us/security/blog/", "https://www.microsoft.com/en-us/security/blog/topic/endpoint-security/", "https://www.microsoft.com/en-us/store/b/certified-refurbished-products", "https://www.microsoft.com/en-us/store/b/business?icid=CNavBusinessStore", "https://about.ads.microsoft.com/en-us/partners/welcome?s_cid=en-us-gct-web-src_ext-sub_0-flx_uhfcombepartner", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-endpoint", "https://learn.microsoft.com/docs/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-verified-id", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-cloud-apps", "https://www.microsoft.com/en-us/microsoft-cloud", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-communication-compliance", "https://www.odva.org/wp-content/uploads/2020/06/PUB00123R1_Common-Industrial_Protocol_and_Family_of_CIP_Networks.pdf", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-ediscovery", "https://go.microsoft.com/fwlink/?LinkID=206977", "https://www.microsoft.com/en-us/security/business/solutions/privacy-risk-management", "https://www.microsoft.com", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-insider-risk-management", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-business", "https://www.microsoft.com/en-us/insidetrack", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-sentinel", "https://partner.microsoft.com/en-US/membership/cloud-solution-provider", "https://www.microsoft.com/en-us/education", "https://www.microsoft.com/en-us/security/business/zero-trust", "https://azure.microsoft.com/en-us/free/students/", "https://www.microsoft.com/msrc/msvr", "https://www.microsoft.com/en-us/store/b/education", "https://go.microsoft.com/fwlink/?LinkId=521839", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-permissions-management ", "https://www.microsoft.com/en-us/security/business/reports-analysis/industry-recognized-cybersecurity-leader", "https://www.microsoft.com/en-us/download", "https://www.microsoft.com/en-us/sitemap1.aspx", "https://www.microsoft.com/en-us/windows-365", "https://www.microsoft.com/en-us/security/business/microsoft-incident-response", "https://www.microsoft.com/en-us/security/business/services/microsoft-defender-experts-hunting", "https://www.linkedin.com/showcase/microsoft-threat-intelligence", "https://www.microsoft.com/en-us/security/business/threat-protection/microsoft-defender-vulnerability-management ", "https://www.microsoft.com/en-us/sustainability/", "https://www.microsoft.com/en-us/surface/devices/surface-laptop-7th-edition", "https://www.microsoft.com/windows/windows-11-apps", "https://www.microsoft.com/en-us/education/products/teams", "https://azuremarketplace.microsoft.com/en-us/", "https://www.microsoft.com/investor/default.aspx", "https://www.microsoft.com/en-us/store/b/payment-financing-options?icid=footer_financing_vcc", "https://www.microsoft.com/en-us/diversity/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-threat-intelligence", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id-governance", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-internet-access", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-cloud", "https://www.microsoft.com/en-us/security/business/microsoft-defender", "https://www.linkedin.com/showcase/microsoft-security/", "https://events.microsoft.com/en-us/allevents/?language=English&clientTimeZone=1&search=security", "https://www.microsoft.com/en-us/security/business/services/microsoft-security-enterprise-services", "https://azure.microsoft.com/en-us/products/web-application-firewall/", "https://azure.microsoft.com/en-us/products/microsoft-entra-ds", "https://azure.microsoft.com/en-us/services/azure-firewall/", "https://www.microsoft.com/en-us/store/b/why-microsoft-store?icid=footer_why-msft-store_7102020", "https://go.microsoft.com/fwlink/?linkid=2196227", "javascript:void(0)", "https://learn.microsoft.com/en-us/security", "#", "https://www.microsoft.com/en-us/sitemap.aspx", "https://www.microsoft.com/en-us/security/blog/products/microsoft-defender-for-iot/", "https://www.microsoft.com/en-us/security/business/ai-machine-learning/microsoft-copilot-security", "https://www.microsoft.com/en-us/industry/financial-services/banking", "https://www.microsoft.com/en-us/about", "https://www.microsoft.com/en-us/store/b/returns", "https://www.microsoft.com/en-us/security/locale", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-security-exposure-management", "https://www.microsoft.com/en-us/industry/health/microsoft-cloud-for-healthcare", "https://www.microsoft.com/en-us/security/business/cybersecurity-awareness", "https://www.microsoft.com/en-us/microsoft-teams/group-chat-software", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-data-loss-prevention", "https://www.microsoft.com/en-us/security/business/solutions/data-security", "https://privacy.microsoft.com/en-us", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-advanced-analytics", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-remote-help", "https://www.microsoft.com/en-us/hololens", "https://customers.microsoft.com/en-us/search?sq=Microsoft%20Security&ff=&p=0&so=story_publish_date%20desc", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id-protection ", "https://developer.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-office-365", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-enterprise-application-management", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-for-identity", "https://www.microsoft.com/en-us/research/", "https://www.microsoft.com/en-us/industry/automotive", "https://www.microsoft.com/en-us/dynamics-365", "https://careers.microsoft.com/", "https://www.microsoft.com/en-us/security/business/services/compliance-program-microsoft-cloud", "https://www.microsoft.com/en-us/security/business/get-started/start-free-trial", "https://www.rockwellautomation.com/en-us/trust-center/security-advisories/advisory.PN1652.html", "https://www.microsoft.com/en-us/security/business/solutions/cloud-workload-protection", "https://www.microsoft.com/en-us/legal/compliance/recycling", "https://www.microsoft.com/en-us/security?wt.mc_id=AID730391_QSG_BLOG_319247&ocid=AID730391_QSG_BLOG_319247", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-iot", "https://www.microsoft.com/en-us/security/blog/author/microsoft-security-threat-intelligence/", "https://www.microsoft.com/en-us/surface/devices/surface-pro-11th-edition", "https://www.microsoft.com/en-us/windows/copilot-ai-features", "https://account.microsoft.com/orders", "https://www.microsoft.com/en-us/ai", "https://www.microsoft.com/en-us/education/buy-license/microsoft365", "https://go.microsoft.com/fwlink/?linkid=2259814", "https://www.microsoft.com/en-us/securityengineering", "https://www.microsoft.com/en-us/security/business/solutions/identity-access", "https://www.microsoft.com/en-us/microsoft-365/business/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id", "https://www.microsoft.com/en-us/licensing/", "https://choice.microsoft.com", "https://www.microsoft.com/en-us/security/security-insider/", "https://www.microsoft.com/en-us/security/business/solutions/ai-powered-unified-secops-platform", "https://azure.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-information-protection", "https://www.microsoft.com/en-us/security/blog/topic/threat-intelligence/", "https://www.microsoft.com/en-us/security/business/solutions/cloud-security", "https://www.linkedin.com/shareArticle?mini=true&url=https://www.microsoft.com/en-us/security/blog/2024/07/02/vulnerabilities-in-panelview-plus-devices-could-lead-to-remote-code-execution/", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/iot-ot-threats/", "https://github.com/microsoft/ics-forensics-tools/tree/main/src/forensic/plugins/RockwellRslogix", "https://www.microsoft.com/en-us/microsoft-365/business/copilot-for-microsoft-365", "https://about.ads.microsoft.com/en-us/resources/microsoft-advertising-partner-program/microsoft-advertising-partner-program", "https://azure.microsoft.com/en-us/solutions/space/", "https://visualstudio.microsoft.com/", "https://www.microsoft.com/en-us/security/business/privacy/microsoft-priva-risk-management", "https://www.microsoft.com/en-us/security/business/privacy/microsoft-priva-subject-rights-requests", "https://appsource.microsoft.com/en-us/", "https://go.microsoft.com/fwlink/?linkid=2139749", "https://www.microsoft.com/education/how-to-buy", "https://www.microsoft.com/en-us/security/business/microsoft-entra", "https://www.microsoft.com/en-us/microsoft-cloud/resources/secure-future-initiative"]}, {"URL": "https://www.microsoft.com/en-us/security/blog/2024/05/15/threat-actors-misusing-quick-assist-in-social-engineering-attacks-leading-to-ransomware/", "author": "Microsoft Threat Intelligence", "content": "\n\t\t\t\t\n\t\t\t\t\n\nJune 2024 update: At the end of May 2024, Microsoft Threat Intelligence observed Storm-1811 using Microsoft Teams as another vector to contact target users. Microsoft assesses that the threat actor uses Teams to send messages and initiate calls in an attempt to impersonate IT or help desk personnel. This activity leads to Quick Assist misuse, followed by credential theft using EvilProxy, execution of batch scripts, and use of SystemBC for persistence and command and control.\n\n\n\n\nSince mid-April 2024, Microsoft Threat Intelligence has observed the threat actor Storm-1811 misusing the client management tool Quick Assist to target users in social engineering attacks. Storm-1811 is a financially motivated cybercriminal group known to deploy Black Basta ransomware. The observed activity begins with impersonation through voice phishing (vishing), followed by delivery of malicious tools, including remote monitoring and management (RMM) tools like ScreenConnect and NetSupport Manager, malware like Qakbot, Cobalt Strike, and ultimately Black Basta ransomware.\n\n\n\n\n\n\nQuick Assist is an application that enables a user to share their Windows or macOS device with another person over a remote connection. This enables the connecting user to remotely connect to the receiving user\u2019s device and view its display, make annotations, or take full control, typically for troubleshooting. Threat actors misuse Quick Assist features to perform social engineering attacks by pretending, for example, to be a trusted contact like Microsoft technical support or an IT professional from the target user\u2019s company to gain initial access to a target device.\n\n\n\n\n\n\nIn addition to protecting customers from observed malicious activity, Microsoft is investigating the use of Quick Assist in these attacks and is working on improving the transparency and trust between helpers and sharers, and incorporating warning messages in Quick Assist to alert users about possible tech support scams. Microsoft Defender for Endpoint detects components of activity originating from Quick Assist sessions as well as follow-on activity, and Microsoft Defender Antivirus detects the malware components associated with this activity.\n\n\n\n\n\n\nOrganizations can also reduce the risk of attacks by blocking or uninstalling Quick Assist and other remote management tools if the tools are not in use in their environment. Quick Assist is installed by default on devices running Windows 11. Additionally, tech support scams are an industry-wide issue where scammers use scare tactics to trick users into unnecessary technical support services. Educating users on how to recognize such scams can significantly reduce the impact of social engineering attacks.&nbsp;\n\n\n\n\n\n\n\nOne of the social engineering techniques used by threat actors to obtain initial access to target devices using Quick Assist is through vishing attacks. Vishing attacks are a form of social engineering that involves callers luring targets into revealing sensitive information under false pretenses or tricking targets into carrying out actions on behalf of the caller.\n\n\n\nFor example, threat actors might attempt to impersonate IT or help desk personnel, pretending to conduct generic fixes on a device. In other cases, threat actors initiate link listing attacks \u2013 a type of email bombing attack, where threat actors sign up targeted emails to multiple email subscription services to flood email addresses indirectly with subscribed content. Following the email flood, the threat actor impersonates IT support through phone calls to the target user, claiming to offer assistance in remediating the spam issue.\n\n\n\nAt the end of May 2024, Microsoft observed Storm-1811 using Microsoft Teams to send messages to and call target users. Tenants created by the threat actor are used to impersonate help desk personnel with names displayed as \u201cHelp Desk\u201d, \u201cHelp Desk IT\u201d, \u201cHelp Desk Support\u201d, and \u201cIT Support\u201d. Microsoft has taken action to mitigate this by suspending identified accounts and tenants associated with inauthentic behavior. Apply security best practices for Microsoft Teams to safeguard Teams users.\n\n\n\nDuring the call, the threat actor persuades the user to grant them access to their device through Quick Assist. The target user only needs to press CTRL + Windows + Q and enter the security code provided by the threat actor, as shown in the figure below.\n\n\nFigure 1. Quick Assist prompt to enter security code\n\n\n\nAfter the target enters the security code, they receive a dialog box asking for permission to allow screen sharing. Selecting Allow shares the user\u2019s screen with the actor.\n\n\nFigure 2. Quick Assist dialog box asking permission to allow screen sharing\n\n\n\nOnce in the session, the threat actor can select Request Control, which if approved by the target, grants the actor full control of the target\u2019s device.\n\n\nFigure 3. Quick Assist dialog box asking permission to allow control\n\n\n\nFollow-on activity leading to Black Basta ransomware\n\n\n\nOnce the user allows access and control, the threat actor runs a scripted cURL command to download a series of batch files or ZIP files used to deliver malicious payloads. Some of the batch scripts observed reference installing fake spam filter updates requiring the targets to provide sign-in credentials. In several cases, Microsoft Threat Intelligence identified such activity leading to the download of Qakbot, RMM tools like ScreenConnect and NetSupport Manager, and Cobalt Strike.\n\n\nFigure 4. Examples of cURL commands to download batch files and ZIP files\n\n\n\nQakbot has been used over the years as a remote access vector to deliver additional malicious payloads that led to ransomware deployment. In this recent activity, Qakbot was used to deliver a Cobalt Strike Beacon attributed to Storm-1811.\n\n\n\nScreenConnect was used to establish persistence and conduct lateral movement within the compromised environment. NetSupport Manager is a remote access tool used by multiple threat actors to maintain control over compromised devices. An attacker might use this tool to remotely access the device, download and install additional malware, and launch arbitrary commands.\n\n\n\nThe mentioned RMM tools are commonly used by threat actors because of their extensive capabilities and ability to blend in with the environment. In some cases, the actors leveraged the OpenSSH tunneling tool to establish a secure shell (SSH) tunnel for persistence.&nbsp;\n\n\n\nAfter the threat actor installs the initial tooling and the phone call is concluded, Storm-1811 leverages their access and performs further hands-on-keyboard activities such as domain enumeration and lateral movement. \n\n\n\nIn cases where Storm-1811 relies on Teams messages followed by phone calls and remote access through Quick Assist, the threat actor uses BITSAdmin to download batch files and ZIP files from a malicious site, for example antispam3[.]com. Storm-1811 also provides the target user with malicious links that redirect the user to an EvilProxy phishing site to input credentials. EvilProxy is an adversary-in-the-middle (AiTM) phishing kit used to capture passwords, hijack a user\u2019s sign-in session, and skip the authentication process. Storm-1811 was also observed deploying SystemBC, a post-compromise commodity remote access trojan (RAT) and proxy tool&nbsp;typically used to establish command-and-control communication, establish persistence in a compromised environment, and deploy follow-on malware, notably ransomware.\n\n\n\nIn several cases, Storm-1811 uses PsExec to deploy Black Basta ransomware throughout the network. Black Basta is a closed ransomware offering (exclusive and not openly marketed like ransomware as a service) distributed by a small number of threat actors who typically rely on other threat actors for initial access, malicious infrastructure, and malware development. Since Black Basta first appeared in April 2022, Black Basta attackers have deployed the ransomware after receiving access from Qakbot and other malware distributors, highlighting the need for organizations to focus on attack stages prior to ransomware deployment to reduce the threat. In the next sections, we share recommendations for improving defenses against this threat, including best practices when using Quick Assist and mitigations for reducing the impact of Black Basta and other ransomware.\n\n\n\nRecommendations\n\n\n\nMicrosoft recommends the following best practices to protect users and organizations from attacks and threat actors that misuse Quick Assist:\n\n\n\n\nConsider blocking or uninstalling Quick Assist and other remote monitoring and management tools if these tools are not in use in your environment. If your organization utilizes another remote support tool such as Remote Help, block or remove Quick Assist as a best practice. Remote Help is part of the Microsoft Intune Suite and provides authentication and security controls for helpdesk connections.\n\n\n\nEducate users about protecting themselves from tech support scams. Tech support scams are an industry-wide issue where scammers use scary tactics to trick users into unnecessary technical support services.\n\n\n\nOnly allow a helper to connect to your device using Quick Assist if you initiated the interaction by contacting Microsoft Support or your IT support staff directly. Don\u2019t provide access to anyone claiming to have an urgent need to access your device.\n\n\n\nIf you suspect that the person connecting to your device is conducting malicious activity, disconnect from the session immediately and report to your local authorities and/or any relevant IT members within your organization.\n\n\n\nUsers who have been affected by a tech support scam can also use the Microsoft technical support scam form to report it.\n\n\n\n\nMicrosoft recommends the following mitigations to reduce the impact of this threat:\n\n\n\n\nEducate users about&nbsp;protecting personal and business information&nbsp;in social media, filtering unsolicited communication, identifying lure links in phishing emails, and reporting reconnaissance attempts and other suspicious activity.\n\n\n\nEducate users about&nbsp;preventing malware infections, such as ignoring or deleting unsolicited and unexpected emails or attachments sent through instant messaging applications or social networks as well as suspicious phone calls.\n\n\n\nInvest in advanced anti-phishing solutions&nbsp;that monitor incoming emails and visited websites.&nbsp;Microsoft Defender for Office 365&nbsp;brings together incident and alert management across email, devices, and identities, centralizing investigations for email-based threats.\n\n\n\nEducate Microsoft Teams users to verify \u2018External\u2019 tagging on communication attempts from external entities, be cautious about what they share, and never share their account information or authorize sign-in requests over chat.\n\n\n\nImplement&nbsp;Conditional Access authentication strength&nbsp;to require phishing-resistant authentication for employees and external users for critical apps.\n\n\n\nApply Microsoft\u2019s&nbsp;security best practices for Microsoft Teams&nbsp;to safeguard Teams users.\n\n\n\nTurn on&nbsp;cloud-delivered protection&nbsp;in Microsoft Defender Antivirus or the equivalent for your antivirus product to cover rapidly evolving attacker tools and techniques. Cloud-based machine learning protections block a huge majority of new and unknown variants.\n\n\n\nEnable network protection to prevent applications or users from accessing malicious domains and other malicious content on the internet.\n\n\n\nTurn on&nbsp;tamper protection&nbsp;features to prevent attackers from stopping security services.\n\n\n\nEnable&nbsp;investigation and remediation&nbsp;in full automated mode to allow Defender for Endpoint to take immediate action on alerts to resolve breaches, significantly reducing alert volume.\n\n\n\nRefer to&nbsp;Microsoft\u2019s human-operated ransomware overview&nbsp;for general hardening recommendations against ransomware attacks.\n\n\n\n\nMicrosoft Defender XDR customers can turn on&nbsp;attack surface reduction rules&nbsp;to prevent common attack techniques:\n\n\n\n\nBlock executable files from running unless they meet a prevalence, age, or trusted list criterion\n\n\n\nBlock execution of potentially obfuscated scripts\n\n\n\nBlock process creations originating from PSExec and WMI commands\n\n\n\nUse advanced protection against ransomware\n\n\n\n\nDetection details\n\n\n\nMicrosoft Defender Antivirus&nbsp;\n\n\n\nMicrosoft Defender Antivirus detects Qakbot downloaders, implants, and behavior as the following malware:\n\n\n\n\nTrojanDownloader:O97M/Qakbot\n\n\n\nTrojan:Win32/QBot\n\n\n\nTrojan:Win32/Qakbot\n\n\n\nTrojanSpy:Win32/Qakbot\n\n\n\nBehavior:Win32/Qakbot\n\n\n\n\nBlack Basta threat components are detected as the following:\n\n\n\n\nBehavior:Win32/Basta\n\n\n\nRansom:Win32/Basta\n\n\n\nTrojan:Win32/Basta\n\n\n\n\nMicrosoft Defender Antivirus detects Beacon running on a victim process as the following:\n\n\n\n\nBehavior:Win32/CobaltStrike\n\n\n\nBackdoor:Win64/CobaltStrike\n\n\n\nHackTool:Win64/CobaltStrike\n\n\n\n\nAdditional Cobalt Strike components are detected as the following:\n\n\n\n\nTrojanDropper:PowerShell/Cobacis\n\n\n\nTrojan:Win64/TurtleLoader.CS\n\n\n\nExploit:Win32/ShellCode.BN\n\n\n\n\nSystemBC components are detected as:\n\n\n\n\nBehavior:Win32/SystemBC\n\n\n\nTrojan: Win32/SystemBC\n\n\n\n\nMicrosoft Defender for Endpoint\n\n\n\nAlerts with the following title in the security center can indicate threat activity on your network:\n\n\n\n\nSuspicious activity using Quick Assist\n\n\n\n\nThe following alerts might also indicate activity related to this threat. Note, however, that these alerts can also be triggered by unrelated threat activity.\n\n\n\n\nSuspicious curl behavior\n\n\n\nSuspicious bitsadmin activity\n\n\n\nSuspicious file creation by BITSAdmin tool\n\n\n\nA file or network connection related to a ransomware-linked emerging threat activity group detected \u2014This alert captures Storm-1811 activity\n\n\n\nRansomware-linked emerging threat activity group Storm-0303 detected \u2014 This alert captures some Qakbot distributor activity\n\n\n\nPossible Qakbot activity\n\n\n\nPossible NetSupport Manager activity\n\n\n\nPossibly malicious use of proxy or tunneling tool\n\n\n\nSuspicious usage of remote management software\n\n\n\nOngoing hands-on-keyboard attacker activity detected (Cobalt Strike)\n\n\n\nHuman-operated attack using Cobalt Strike\n\n\n\nHuman-operated attack implant tool detected\n\n\n\nRansomware behavior detected in the file system\n\n\n\n\nIndicators of compromise\n\n\n\nDomain names:\n\n\n\n\nupd7a[.]com\n\n\n\nupd7[.]com\n\n\n\nupd9[.]com\n\n\n\nupd5[.]pro\n\n\n\nantispam3[.]com\n\n\n\nantispam2[.]com\n\n\n\n\nSHA-256:\n\n\n\n\n71d50b74f81d27feefbc2bc0f631b0ed7fcdf88b1abbd6d104e66638993786f8\n\n\n\n0f9156f91c387e7781603ed716dcdc3f5342ece96e155115708b1662b0f9b4d0\n\n\n\n1ad05a4a849d7ed09e2efb38f5424523651baf3326b5f95e05f6726f564ccc30\n\n\n\n93058bd5fe5f046e298e1d3655274ae4c08f07a8b6876e61629ae4a0b510a2f7\n\n\n\n1cb1864314262e71de1565e198193877ef83e98823a7da81eb3d59894b5a4cfb\n\n\n\n\nScreenConnect relay:\n\n\n\n\ninstance-olqdnn-relay.screenconnect[.]com\n\n\n\n\nNetSupport C2:\n\n\n\n\ngreekpool[.]com\n\n\n\n\nCobalt Strike Beacon C2:\n\n\n\n\nzziveastnews[.]com\n\n\n\nrealsepnews[.]com\n\n\n\n\nAdvanced hunting&nbsp;\n\n\n\nMicrosoft Defender XDR\n\n\n\nTo locate possible malicious activity, run the following query in the Microsoft Defender portal:\n\n\n\nThis query looks for possible email bombing activity:\n\n\nEmailEvents\n| where EmailDirection == \"Inbound\"\n| make-series Emailcount = count()\n              on Timestamp step 1h by RecipientObjectId\n| extend (Anomalies, AnomalyScore, ExpectedEmails) = series_decompose_anomalies(Emailcount)\n| mv-expand Emailcount, Anomalies, AnomalyScore, ExpectedEmails to typeof(double), Timestamp\n| where Anomalies != 0\n| where AnomalyScore &gt;= 10\n\n\n\nThis query looks for possible Teams phishing activity.\n\n\nlet suspiciousUpns = DeviceProcessEvents\n| where DeviceId == \"alertedMachine\"\n| where isnotempty(InitiatingProcessAccountUpn)\n| project InitiatingProcessAccountUpn;\nCloudAppEvents\n| where Application == \"Microsoft Teams\"\n| where ActionType == \"ChatCreated\"\n| where isempty(AccountObjectId)\n| where RawEventData.ParticipantInfo.HasForeignTenantUsers == true\n| where RawEventData.CommunicationType == \"OneonOne\"\n| where RawEventData.ParticipantInfo.HasGuestUsers == false\n| where RawEventData.ParticipantInfo.HasOtherGuestUsers == false\n| where RawEventData.Members[0].DisplayName in (\"Microsoft  Security\", \"Help Desk\", \"Help Desk Team\", \"Help Desk IT\", \"Microsoft Security\", \"office\")\n| where AccountId has \"@\"\n| extend TargetUPN = tolower(tostring(RawEventData.Members[1].UPN))\n| where TargetUPN in (suspiciousUpns)\n\n\n\n\nMicrosoft Sentinel\n\n\n\nMicrosoft Sentinel customers can use the TI Mapping analytics (a series of analytics all prefixed with \u2018TI map\u2019) to automatically match the malicious domain indicators mentioned in this blog post with data in their workspace. If the TI Map analytics are not currently deployed, customers can install the Threat Intelligence solution from the Microsoft Sentinel Content Hub to have the analytics rule deployed in their Sentinel workspace.\n\n\n\nMicrosoft Sentinel also has a range of hunting queries available in Sentinel GitHub repo or as part of Sentinel solutions that customers can use to detect the activity detailed in this blog in addition to Microsoft Defender detections. These hunting queries include the following:\n\n\n\nQakbot:\n\n\n\n\nQakbot hunting queries\n\n\n\n\nCobalt Strike:\n\n\n\n\nCobalt Strike DNS Beaconing\n\n\n\nPotential ransomware activity related to Cobalt Strike\n\n\n\nSuspicious named pipes\n\n\n\nCobalt Strike Invocation using WMI\n\n\n\n\nReferences\n\n\n\n\nDefense and Mitigations from E-mail Bombing. U.S. Department of Health and Human Services, Health Sector Cybersecurity Coordination Center\n\n\n\n\nLearn more\n\n\n\nFor the latest security research from the Microsoft Threat Intelligence community, check out the Microsoft Threat Intelligence Blog:&nbsp;https://aka.ms/threatintelblog.\n\n\n\nTo get notified about new publications and to join discussions on social media, follow us on LinkedIn at https://www.linkedin.com/showcase/microsoft-threat-intelligence, and on X (formerly Twitter) at&nbsp;https://twitter.com/MsftSecIntel.\n\n\n\nTo hear stories and insights from the Microsoft Threat Intelligence community about the ever-evolving threat landscape, listen to the Microsoft Threat Intelligence podcast: https://thecyberwire.com/podcasts/microsoft-threat-intelligence.\n\t\t\t", "mentioned_links": ["https://www.microsoft.com/en-us/security/blog/products/microsoft-defender/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-external-id", "https://education.microsoft.com/", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-endpoint-privilege-management", "https://www.microsoft.com/en-us/wdsi/threats/threat-search?query=Behavior:Win32/Qakbot.A", "https://www.microsoft.com/en-us/msrc/", "https://www.microsoft.com/en-us/trust-center", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/ransomware/", "https://learn.microsoft.com/windows/client-management/client-tools/quick-assist", "https://www.microsoft.com/en-us/security/blog/2022/05/09/ransomware-as-a-service-understanding-the-cybercrime-gig-economy-and-how-to-protect-yourself/#defending-against-ransomware", null, "https://azure.microsoft.com/en-us/products/key-vault/", "https://partner.microsoft.com/en-US/", "https://twitter.com/intent/tweet?url=https://www.microsoft.com/en-us/security/blog/2024/05/15/threat-actors-misusing-quick-assist-in-social-engineering-attacks-leading-to-ransomware/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-xdr", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-audit", "https://github.com/features/security", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-external-attack-surface-management", "https://www.microsoft.com/en-us/events", "https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/Ransomware/Potential%20ransomware%20activity%20related%20to%20Cobalt%20Strike.yaml", "https://azure.microsoft.com/en-us/products/ddos-protection/", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-compliance-manager", "https://support.microsoft.com/en-us/windows/report-a-technical-support-scam-cfa4609a-92cc-4808-95e8-392b4ffd0753", "https://www.microsoft.com/en-us/security/blog/2023/10/25/octo-tempest-crosses-boundaries-to-facilitate-extortion-encryption-and-destruction/", "https://www.microsoft.com/en-us/industry/consumer-goods", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-private-access", "https://www.microsoft.com/en-us/security/business/partnerships", "https://account.microsoft.com/", "https://blogs.microsoft.com/", "https://www.youtube.com/channel/UC4s3tv0Qq_OSUBfR735Jc6A", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-cloud-pki", "https://www.microsoft.com/en-us/security/business/get-started/contact-us", "https://www.microsoft.com/en-us/security/business/solutions/extended-detection-response-xdr", "https://www.microsoft.com/en-us/microsoft-viva", "https://www.microsoft.com/en-us/security/business/microsoft-purview", "https://www.linkedin.com/shareArticle?mini=true&url=https://www.microsoft.com/en-us/security/blog/2024/05/15/threat-actors-misusing-quick-assist-in-social-engineering-attacks-leading-to-ransomware/", "https://twitter.com/msftsecurity", "https://news.microsoft.com/", "https://servicetrust.microsoft.com/", "https://www.microsoft.com/en-us/security", "https://www.microsoft.com/en-us/security/business/microsoft-priva", "https://support.microsoft.com/windows/cfa4609a-92cc-4808-95e8-392b4ffd0753", "https://dynamics.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/blog/products/microsoft-defender-threat-intelligence/", "https://www.microsoft.com/en-us/microsoft-copilot", "https://aka.ms/yourcaliforniaprivacychoices", "https://www.microsoft.com/en-us/industry/government", "https://learn.microsoft.com/windows/client-management/client-tools/quick-assist#disable-quick-assist-within-your-organization", "https://about.ads.microsoft.com/en-us?s_cid=dig-src_uhfcomm", "https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=HackTool:Win64/CobaltStrike", "https://aka.ms/threatintelblog", "https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=TrojanSpy:Win32/Qakbot", "https://www.microsoft.com/en-us/industry", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-data-lifecycle-management", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-workload-id", "https://www.hhs.gov/sites/default/files/email-bombing-sector-alert-tlpclear.pdf", "https://learn.microsoft.com/windows-server/administration/windows-commands/bitsadmin?ocid=magicti_ta_learndoc", "https://www.microsoft.com/en-us/security/business/security-101", "https://www.microsoft.com/en-us/d/Surface-Laptop-Studio-2/8rqr54krf1dz", "https://learn.microsoft.com/en-us/learn/topics/sci?wt.mc_id=techcom_header-webpage-m365", "https://learn.microsoft.com/defender-endpoint/attack-surface-reduction-rules-reference?ocid=magicti_ta_learndoc#block-execution-of-potentially-obfuscated-scripts", "https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Ransom:Win32/Basta.AA&threatId=-2147149077", "https://www.microsoft.com/en-us/d/Surface-Laptop-Go-3/8p0wwgj6c6l2", "https://www.microsoft.com/en-us/security/security-insider/microsoft-digital-defense-report-2023", "https://support.microsoft.com/contactus", "https://learn.microsoft.com/", "#recommendations", "https://www.microsoft.com/en-us/mixed-reality/windows-mixed-reality", "https://learn.microsoft.com/defender-endpoint/attack-surface-reduction?ocid=magicti_ta_learndoc", "https://thecyberwire.com/podcasts/microsoft-threat-intelligence", "https://learn.microsoft.com/en-us/security/", "https://azure.microsoft.com/en-us/solutions/quantum-computing/", "https://www.microsoft.com/en-us/security/business/services", "https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=TrojanDownloader:O97M/Qakbot", "https://www.microsoft.com/en-us/security/blog/content-type/research/", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-cloud-security-posture-management", "https://www.microsoft.com/en-us/power-platform", "https://twitter.com/MsftSecIntel", "https://www.microsoft.com/en-us/security/business/services/microsoft-defender-experts-xdr", "https://www.microsoft.com/en-us/security/business/solutions/generative-ai-cybersecurity", "https://learn.microsoft.com/MicrosoftTeams/teams-security-best-practices-for-safer-messaging?ocid=magicti_ta_learndoc", "https://www.microsoft.com/en-us/education/devices/overview", "https://www.microsoft.com/en-us/security/business/microsoft-Intune", "https://www.microsoft.com/en-us/accessibility", "https://go.microsoft.com/fwlink/?linkid=2196228", "https://www.microsoft.com/en-us/industry/manufacturing/microsoft-cloud-for-manufacturing", "https://techcommunity.microsoft.com/", "https://techcommunity.microsoft.com/t5/security-compliance-and-identity/ct-p/MicrosoftSecurityandCompliance", "https://www.microsoft.com/en-us/microsoft-products-and-apps", "https://www.microsoft.com/en-us/microsoft-365/business", "https://security.microsoft.com/intel-profiles/530f5cd2221c4bfcf67ea158a1e674ec5a210dbbd611dfe9db652c9adf97292b", "https://www.microsoft.com/microsoft-365-life-hacks/privacy-and-safety/what-is-social-engineering.", "https://partner.microsoft.com/en-us/membership", "https://www.microsoft.com/en-us/security/blog/", "https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Trojan:Win32/Basta!BV&threatId=-2147142676", "https://www.microsoft.com/en-us/store/b/certified-refurbished-products", "https://www.microsoft.com/security/business/security-101/what-is-malware?ocid=magicti_ta_abbreviatedmktgpage", "https://about.ads.microsoft.com/en-us/partners/welcome?s_cid=en-us-gct-web-src_ext-sub_0-flx_uhfcombepartner", "https://www.microsoft.com/en-us/store/b/business?icid=CNavBusinessStore", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-endpoint", "https://learn.microsoft.com/docs/", "https://github.com/Azure/Azure-Sentinel/tree/master/Hunting%20Queries/Microsoft%20365%20Defender/Campaigns/Qakbot", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-verified-id", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-cloud-apps", "https://www.microsoft.com/en-us/microsoft-cloud", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-communication-compliance", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-ediscovery", "https://go.microsoft.com/fwlink/?LinkID=206977", "https://www.microsoft.com/en-us/security/business/solutions/privacy-risk-management", "https://www.microsoft.com", "https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Backdoor:Win64/CobaltStrike&threatId=-2147180169", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-insider-risk-management", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-business", "https://www.microsoft.com/en-us/insidetrack", "https://www.microsoft.com/microsoft-365-life-hacks/privacy-and-safety/what-is-a-vishing-attack", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-sentinel", "https://partner.microsoft.com/en-US/membership/cloud-solution-provider", "https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Behavior:Win32/Basta.B&threatId=-2147132479", "https://www.microsoft.com/en-us/education", "https://www.microsoft.com/en-us/security/business/zero-trust", "https://azure.microsoft.com/en-us/free/students/", "https://learn.microsoft.com/microsoft-365/security/defender-endpoint/automated-investigations", "https://www.microsoft.com/en-us/store/b/education", "https://security.microsoft.com/intel-profiles/3094d3c65962cc6f0be61b97eb894802018cea4848ce476e4be57b0185836b93", "https://go.microsoft.com/fwlink/?LinkId=521839", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-permissions-management ", "https://www.microsoft.com/en-us/security/business/reports-analysis/industry-recognized-cybersecurity-leader", "https://www.microsoft.com/en-us/download", "https://www.microsoft.com/en-us/sitemap1.aspx", "https://www.microsoft.com/en-us/windows-365", "https://www.microsoft.com/en-us/security/business/microsoft-incident-response", "https://www.microsoft.com/en-us/security/blog/products/microsoft-incident-response/", "https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Trojan:Win64/TurtleLoader.CS!dha&threatId=-2147187531", "https://www.microsoft.com/en-us/security/business/services/microsoft-defender-experts-hunting", "https://www.linkedin.com/showcase/microsoft-threat-intelligence", "https://www.microsoft.com/en-us/security/business/threat-protection/microsoft-defender-vulnerability-management ", "https://www.microsoft.com/en-us/sustainability/", "https://www.microsoft.com/en-us/surface/devices/surface-laptop-7th-edition", "https://www.microsoft.com/windows/windows-11-apps", "https://www.microsoft.com/en-us/education/products/teams", "https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/Campaigns/cobalt-strike-invoked-w-wmi.yaml", "https://azuremarketplace.microsoft.com/en-us/", "https://learn.microsoft.com/microsoft-365/security/defender-endpoint/enable-network-protection?ocid=magicti_ta_learndoc", "https://www.microsoft.com/investor/default.aspx", "https://www.microsoft.com/en-us/store/b/payment-financing-options?icid=footer_financing_vcc", "https://www.microsoft.com/en-us/diversity/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-threat-intelligence", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id-governance", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-internet-access", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-cloud", "https://www.microsoft.com/en-us/security/business/microsoft-defender", "https://www.facebook.com/sharer.php?u=https://www.microsoft.com/en-us/security/blog/2024/05/15/threat-actors-misusing-quick-assist-in-social-engineering-attacks-leading-to-ransomware/", "https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Trojan:Win32/Qbot", "https://events.microsoft.com/en-us/allevents/?language=English&clientTimeZone=1&search=security", "https://support.microsoft.com/windows/protect-yourself-from-tech-support-scams-2ebf91bd-f94c-2a8a-e541-f5c800d18435", "https://www.linkedin.com/showcase/microsoft-security/", "https://www.microsoft.com/en-us/security/business/services/microsoft-security-enterprise-services", "https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Attacker%20Tools%20Threat%20Protection%20Essentials/Hunting%20Queries/CobaltDNSBeacon.yaml", "https://learn.microsoft.com/en-us/windows/client-management/client-tools/quick-assist#disable-quick-assist-within-your-organization", "https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Behavior%3AWin32/SystemBC.A!nri&threatId=-2147149800%3Focid%3Dmagicti_ta_ency", "https://azure.microsoft.com/en-us/products/web-application-firewall/", "https://learn.microsoft.com/defender-endpoint/enable-cloud-protection-microsoft-defender-antivirus", "https://azure.microsoft.com/en-us/products/microsoft-entra-ds", "https://azure.microsoft.com/en-us/services/azure-firewall/", "https://learn.microsoft.com/microsoft-365/security/defender-endpoint/prevent-changes-to-security-settings-with-tamper-protection", "https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Behavior:Win32/CobaltStrike", "https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Trojan%3AWin32/SystemBC.SA!sms&threatId=-2147150468%3Focid%3Dmagicti_ta_ency", "https://www.microsoft.com/en-us/security/blog/2022/11/03/stopping-c2-communications-in-human-operated-ransomware-through-network-protection/", "https://www.microsoft.com/en-us/store/b/why-microsoft-store?icid=footer_why-msft-store_7102020", "https://go.microsoft.com/fwlink/?linkid=2196227", "javascript:void(0)", "https://learn.microsoft.com/en-us/security", "#", "https://www.microsoft.com/en-us/sitemap.aspx", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/attacker-techniques-tools-and-infrastructure/", "https://www.microsoft.com/security/business/endpoint-management/microsoft-intune-remote-help", "https://www.microsoft.com/en-us/security/business/ai-machine-learning/microsoft-copilot-security", "https://www.microsoft.com/en-us/industry/financial-services/banking", "https://www.microsoft.com/en-us/about", "https://www.microsoft.com/en-us/store/b/returns", "https://www.microsoft.com/en-us/security/locale", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-security-exposure-management", "https://learn.microsoft.com/azure/sentinel/sentinel-solutions-deploy", "https://www.microsoft.com/en-us/industry/health/microsoft-cloud-for-healthcare", "https://www.microsoft.com/en-us/security/business/cybersecurity-awareness", "https://www.microsoft.com/en-us/microsoft-teams/group-chat-software", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-data-loss-prevention", "https://www.microsoft.com/en-us/security/business/solutions/data-security", "https://learn.microsoft.com/defender-endpoint/attack-surface-reduction-rules-reference?ocid=magicti_ta_learndoc#use-advanced-protection-against-ransomware", "https://privacy.microsoft.com/en-us", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-advanced-analytics", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-remote-help", "https://www.microsoft.com/en-us/hololens", "https://customers.microsoft.com/en-us/search?sq=Microsoft%20Security&ff=&p=0&so=story_publish_date%20desc", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id-protection ", "https://learn.microsoft.com/azure/active-directory/authentication/concept-authentication-strengths?ocid=magicti_ta_learndoc", "https://developer.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/social-engineering-phishing/", "https://www.microsoft.com/en-us/security/blog/2023/12/28/financially-motivated-threat-actors-misusing-app-installer/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-office-365", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-enterprise-application-management", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-for-identity", "https://www.microsoft.com/en-us/research/", "https://www.microsoft.com/en-us/security/blog/2022/05/09/ransomware-as-a-service-understanding-the-cybercrime-gig-economy-and-how-to-protect-yourself/", "https://www.microsoft.com/en-us/industry/automotive", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/threat-actors/", "https://www.microsoft.com/en-us/dynamics-365", "https://careers.microsoft.com/", "https://www.microsoft.com/en-us/security/business/services/compliance-program-microsoft-cloud", "https://www.microsoft.com/en-us/security/business/get-started/start-free-trial", "https://www.microsoft.com/en-us/security/business/solutions/cloud-workload-protection", "https://www.microsoft.com/en-us/legal/compliance/recycling", "https://www.microsoft.com/en-us/security?wt.mc_id=AID730391_QSG_BLOG_319247&ocid=AID730391_QSG_BLOG_319247", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-iot", "https://www.microsoft.com/en-us/security/blog/author/microsoft-security-threat-intelligence/", "https://www.microsoft.com/en-us/surface/devices/surface-pro-11th-edition", "https://www.microsoft.com/en-us/windows/copilot-ai-features", "https://account.microsoft.com/orders", "https://www.microsoft.com/security/business/security-101/what-is-email-security?ocid=magicti_ta_abbreviatedmktgpage", "https://www.microsoft.com/en-us/ai", "https://www.microsoft.com/en-us/education/buy-license/microsoft365", "https://go.microsoft.com/fwlink/?linkid=2259814", "https://www.microsoft.com/en-us/securityengineering", "https://www.microsoft.com/en-us/security/business/solutions/identity-access", "https://www.microsoft.com/en-us/microsoft-365/business/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id", "https://www.microsoft.com/en-us/licensing/", "https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/FalconFriday/Analytic%20Rules/SuspiciousNamedPipes.yaml", "https://learn.microsoft.com/microsoft-365/security/defender/microsoft-365-security-center-mdo?ocid=magicti_ta_learndoc", "https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=TrojanDropper:PowerShell/Cobacis.A&threatId=-2147200375", "https://choice.microsoft.com", "https://www.microsoft.com/en-us/security/security-insider/", "https://www.microsoft.com/en-us/security/business/solutions/ai-powered-unified-secops-platform", "https://azure.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-information-protection", "https://www.microsoft.com/en-us/security/blog/topic/threat-intelligence/", "https://www.microsoft.com/en-us/security/business/solutions/cloud-security", "https://learn.microsoft.com/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#block-process-creations-originating-from-psexec-and-wmi-commands", "https://www.microsoft.com/en-us/security/blog/products/microsoft-defender-for-endpoint/", "https://www.microsoft.com/en-us/microsoft-365/business/copilot-for-microsoft-365", "https://about.ads.microsoft.com/en-us/resources/microsoft-advertising-partner-program/microsoft-advertising-partner-program", "https://azure.microsoft.com/en-us/solutions/space/", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/cybercrime/", "https://visualstudio.microsoft.com/", "https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Exploit:Win32/ShellCode.BN&threatId=-2147237640", "https://www.microsoft.com/en-us/security/business/privacy/microsoft-priva-risk-management", "https://www.microsoft.com/en-us/security/business/privacy/microsoft-priva-subject-rights-requests", "https://learn.microsoft.com/defender-endpoint/attack-surface-reduction-rules-reference?ocid=magicti_ta_learndoc#block-executable-files-from-running-unless-they-meet-a-prevalence-age-or-trusted-list-criterion", "https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Trojan:Win32/Qakbot", "https://appsource.microsoft.com/en-us/", "https://go.microsoft.com/fwlink/?linkid=2139749", "https://www.microsoft.com/education/how-to-buy", "https://www.microsoft.com/en-us/security/business/microsoft-entra", "https://www.microsoft.com/en-us/microsoft-cloud/resources/secure-future-initiative"]}, {"URL": "https://www.microsoft.com/en-us/security/blog/2024/04/22/analyzing-forest-blizzards-custom-post-compromise-tool-for-exploiting-cve-2022-38028-to-obtain-credentials/", "author": "Microsoft Threat Intelligence", "content": "\n\t\t\t\t\n\t\t\t\t\nMicrosoft Threat Intelligence is publishing results of our longstanding investigation into activity by the Russian-based threat actor Forest Blizzard (STRONTIUM) using a custom tool to elevate privileges and steal credentials in compromised networks. Since at least June 2020 and possibly as early as April 2019, Forest Blizzard has used the tool, which we refer to as GooseEgg, to exploit the CVE-2022-38028 vulnerability in Windows Print Spooler service by modifying a JavaScript constraints file and executing it with SYSTEM-level permissions. Microsoft has observed Forest Blizzard using GooseEgg as part of post-compromise activities against targets including Ukrainian, Western European, and North American government, non-governmental, education, and transportation sector organizations. While a simple launcher application, GooseEgg is capable of spawning other applications specified at the command line with elevated permissions, allowing threat actors to support any follow-on objectives such as remote code execution, installing a backdoor, and moving laterally through compromised networks.\n\n\n\nForest Blizzard often uses publicly available exploits in addition to CVE-2022-38028, such as CVE-2023-23397. Linked to the Russian General Staff Main Intelligence Directorate (GRU) by the United States and United Kingdom governments, Forest Blizzard primarily focuses on strategic intelligence targets and differs from other GRU-affiliated and sponsored groups, which Microsoft has tied to destructive attacks, such as Seashell Blizzard (IRIDIUM) and Cadet Blizzard (DEV-0586). Although Russian threat actors are known to have exploited a set of similar vulnerabilities known as PrintNightmare (CVE-2021-34527 and CVE-2021-1675), the use of GooseEgg in Forest Blizzard operations is a unique discovery that had not been previously reported by security providers. Microsoft is committed to providing visibility into observed malicious activity and sharing insights on threat actors to help organizations protect themselves. Organizations and users are to apply the CVE-2022-38028 security update to mitigate this threat, while Microsoft Defender Antivirus detects the specific Forest Blizzard capability as HackTool:Win64/GooseEgg.\n\n\n\nThis blog provides technical information on GooseEgg, a unique Forest Blizzard capability. In addition to patching, this blog details several steps users can take to defend themselves against attempts to exploit Print Spooler vulnerabilities. We also provide additional recommendations, detections, and indicators of compromise. As with any observed nation-state actor activity, Microsoft directly notifies customers that have been targeted or compromised, providing them with the necessary information to secure their accounts.\n\n\n\nWho is Forest Blizzard?\n\n\n\nForest Blizzard primarily targets government, energy, transportation, and non-governmental organizations in the United States, Europe, and the Middle East. Microsoft has also observed Forest Blizzard targeting media, information technology, sports organizations, and educational institutions worldwide. Since at least 2010, the threat actor\u2019s primary mission has been to collect intelligence in support of Russian government foreign policy initiatives. The&nbsp;United States and United Kingdom governments have linked Forest Blizzard to Unit 26165 of the Russian Federation\u2019s military intelligence agency, the Main Intelligence Directorate of the General Staff of the Armed Forces of the Russian Federation (GRU). Other security researchers have used GRU Unit 26165, APT28, Sednit, Sofacy, and Fancy Bear to refer to groups with similar or related activities.\n\n\n\nGooseEgg\n\n\n\nMicrosoft Threat Intelligence assesses Forest Blizzard\u2019s objective in deploying GooseEgg is to gain elevated access to target systems and steal credentials and information. While this actor\u2019s TTPs and infrastructure specific to the use of this tool can change at any time, the following sections provide additional details on Forest Blizzard tactics, techniques, and procedures (TTPs) in past compromises.\n\n\n\nLaunch, persistence, and privilege escalation\n\n\n\nMicrosoft has observed that, after obtaining access to a target device, Forest Blizzard uses GooseEgg to elevate privileges within the environment. GooseEgg is typically deployed with a batch script, which we have observed using the name execute.bat and doit.bat. This batch script writes the file servtask.bat, which contains commands for saving off/compressing registry hives. The batch script invokes the paired GooseEgg executable and sets up persistence as a scheduled task designed to run servtask.bat.\n\n\nFigure 1. Batch file\n\n\n\nThe GooseEgg binary\u2014which has included but is not limited to the file names justice.exe and DefragmentSrv.exe\u2014takes one of four commands, each with different run paths. While the binary appears to launch a trivial given command, in fact the binary does this in a unique and sophisticated manner, likely to help conceal the activity.\n\n\n\nThe first command issues a custom return code 0x6009F49F and exits; which could be indicative of a version number. The next two commands trigger the exploit and launch either a provided dynamic-link library (DLL) or executable with elevated permissions. The fourth and final command tests the exploit and checks that it has succeeded using the whoami command.\n\n\n\nMicrosoft has observed that the name of an embedded malicious DLL file typically includes the phrase \u201cwayzgoose\u201d; for example, wayzgoose23.dll. This DLL, as well as other components of the malware, are deployed to one of the following installation subdirectories, which is created under C:\\ProgramData. A subdirectory name is selected from the list below:\n\n\n\n\nMicrosoft\n\n\n\nAdobe\n\n\n\nComms\n\n\n\nIntel\n\n\n\nKaspersky Lab\n\n\n\nBitdefender\n\n\n\nESET\n\n\n\nNVIDIA\n\n\n\nUbiSoft\n\n\n\nSteam\n\n\n\n\nA specially crafted subdirectory with randomly generated numbers and the format string \\v%u.%02u.%04u is also created and serves as the install directory. For example, a directory that looks like C:\\ProgramData\\Adobe\\v2.116.4405 may be created. The binary then copies the following driver stores to this directory:\n\n\n\n\nC:\\Windows\\System32\\DriverStore\\FileRepository\\pnms003.inf_*\n\n\n\nC:\\Windows\\System32\\DriverStore\\FileRepository\\pnms009.inf_*\n\n\n\nFigure 2. GooseEgg binary adding driver stores to an actor-controlled directory\n\n\n\nNext, registry keys are created, effectively generating a custom protocol handler and registering a new CLSID to serve as the COM server for this \u201crogue\u201d protocol. The exploit replaces the C: drive symbolic link in the object manager to point to the newly created directory. When the PrintSpooler attempts to load C:\\Windows\\System32\\DriverStore\\FileRepository\\pnms009.inf_amd64_a7412a554c9bc1fd\\MPDW-Constraints.js, it instead is redirected to the actor-controlled directory containing the copied driver packages.\n\n\nFigure 3. Registry key creation\n\n\nFigure 4. C: drive symbolic link hijack\n\n\n\nThe \u201cMPDW-constraints.js\u201d stored within the actor-controlled directory has the following patch applied to the convertDevModeToPrintTicket function:\n\n\nfunction convertDevModeToPrintTicket(devModeProperties, scriptContext, printTicket)\n{try{ printTicket.XmlNode.load('rogue9471://go'); } catch (e) {}\n\n\n\nThe above patch to the convertDevModeToPrintTicket function invokes the \u201crogue\u201d search protocol handler\u2019s CLSID during the&nbsp;call to&nbsp;RpcEndDocPrinter. This results in the auxiliary DLL wayzgoose.dll launching in the context of the PrintSpooler service with SYSTEM permissions. wayzgoose.dll is a basic launcher application capable of spawning other applications specified at the command line with SYSTEM-level permissions, enabling threat actors to perform other malicious activities such as installing a backdoor, moving laterally through compromised networks, and remotely executing code.\n\n\n\nRecommendations\n\n\n\nMicrosoft recommends the following mitigations defend against attacks that use GooseEgg.\n\n\n\nReduce the Print Spooler vulnerability\n\n\n\nMicrosoft released a security update for the Print Spooler vulnerability exploited by GooseEgg on October 11, 2022 and updates for PrintNightmare vulnerabilities on June 8, 2021 and July 1, 2021. Customers who have not implemented these fixes yet are urged to do so as soon as possible for their organization\u2019s security. In addition, since the Print Spooler service isn\u2019t required for domain controller operations, Microsoft recommends disabling the service on domain controllers. Otherwise, users can install available Windows security updates for Print Spooler vulnerabilities on Windows domain controllers before member servers and workstations. To help identify domain controllers that have the Print Spooler service enabled, Microsoft Defender for Identity has a&nbsp;built-in security assessment that tracks the availability of Print Spooler services on domain controllers.\n\n\n\nBe proactively defensive\n\n\n\n\nFor customers, follow the credential hardening recommendations in our on-premises credential theft overview to defend against common credential theft techniques like LSASS access.\n\n\n\nRun Endpoint Detection and Response\u202f(EDR) in block mode\u202fso that Microsoft Defender for Endpoint can block malicious artifacts, even when your non-Microsoft antivirus does not detect the threat or when Microsoft Defender Antivirus is running in passive mode. EDR in block mode works behind the scenes to remediate malicious artifacts that are detected post-breach.\u202f\u202f\u202f&nbsp;\n\n\n\nConfigure\u202finvestigation and remediation\u202fin full automated mode to let Microsoft Defender for Endpoint take immediate action on alerts to resolve breaches, significantly reducing alert volume.&nbsp;\n\n\n\nTurn on\u202fcloud-delivered protection\u202fin Microsoft Defender Antivirus, or the equivalent for your antivirus product, to cover rapidly evolving attacker tools and techniques. Cloud-based machine learning protections block a majority of new and unknown variants.\n\n\n\n\nMicrosoft Defender XDR customers can turn on the following&nbsp;attack surface reduction rule&nbsp;to prevent common attack techniques used for GooseEgg. Microsoft Defender XDR detects the GooseEgg tool and raises an alert upon detection of attempts to exploit Print Spooler vulnerabilities regardless of whether the device has been patched.\n\n\n\n\n&nbsp;Block credential stealing from the Windows local security authority subsystem (lsass.exe)\n\n\n\n\nDetecting, hunting, and responding to GooseEgg\n\n\n\nMicrosoft Defender XDR detections\n\n\n\nMicrosoft Defender Antivirus\n\n\n\nMicrosoft Defender Antivirus detects threat components as the following malware:\n\n\n\n\nHackTool:Win64/GooseEgg\n\n\n\n\nMicrosoft Defender for Endpoint\n\n\n\nThe following alerts might also indicate threat activity related to this threat. Note, however, that these alerts can be also triggered by unrelated threat activity.\n\n\n\n\nPossible exploitation of CVE-2021-34527\n\n\n\nPossible source of PrintNightmare exploitation\n\n\n\nPossible target of PrintNightmare exploitation attempt\n\n\n\nPotential elevation of privilege using print filter pipeline service\n\n\n\nSuspicious behavior by spoolsv.exe\n\n\n\nForest Blizzard Actor activity detected\n\n\n\n\nMicrosoft Defender for Identity\n\n\n\nThe following alerts might also indicate threat activity related to this threat. Note, however, that these alerts can be also triggered by unrelated threat activity.\n\n\n\n\nSuspected Windows Print Spooler service exploitation attempt (CVE-2021-34527 exploitation)\n\n\n\n\nThreat intelligence reports\n\n\n\nMicrosoft customers can use the following reports in Microsoft products to get the most up-to-date information about the threat actor, malicious activity, and techniques discussed in this blog. These reports provide the intelligence, protection information, and recommended actions to prevent, mitigate, or respond to associated threats found in customer environments.\n\n\n\nMicrosoft Defender Threat Intelligence\n\n\n\n\nActor Profile: Forest Blizzard\n\n\n\nAbuse of Windows Print Spooler for privilege escalation and persistence\n\n\n\n\nHunting queries\n\n\n\nMicrosoft Sentinel\n\n\n\nMicrosoft Sentinel customers can use the TI Mapping analytics (a series of analytics all prefixed with \u2018TI map\u2019) to automatically match the malicious domain indicators mentioned in this blog post with data in their workspace. If the TI Map analytics are not currently deployed, customers can install the Threat Intelligence solution from the Microsoft Sentinel Content Hub to have the analytics rule deployed in their Sentinel workspace. More details on the Content Hub can be found here:&nbsp; https://learn.microsoft.com/azure/sentinel/sentinel-solutions-deploy.\n\n\n\nHunt for filenames, file extensions in ProgramData folder and file hash\n\n\nlet filenames = dynamic([\"execute.bat\",\"doit.bat\",\"servtask.bat\"]);\nDeviceFileEvents\n  | where TimeGenerated &gt; ago(60d) // change the duration according to your requirement\n  | where ActionType == \"FileCreated\"\n  | where FolderPath == \"C:\\\\ProgramData\\\\\"\n  | where FileName in~ (filenames) or FileName endswith \".save\" or FileName endswith \".zip\" or ( FileName startswith \"wayzgoose\" and FileName endswith \".dll\") or SHA256 == \"7d51e5cc51c43da5deae5fbc2dce9b85c0656c465bb25ab6bd063a503c1806a9\" // hash value of execute.bat/doit.bat/servtask.bat\n  | project TimeGenerated, DeviceId, DeviceName, ActionType, FolderPath, FileName, InitiatingProcessAccountName,InitiatingProcessAccountUpn\n\n\n\nHunt for processes creating scheduled task creation\n\n\nDeviceProcessEvents\n| where TimeGenerated &gt; ago(60d) // change the duration according to your requirement\n| where InitiatingProcessSHA256 == \"6b311c0a977d21e772ac4e99762234da852bbf84293386fbe78622a96c0b052f\" or SHA256 == \"6b311c0a977d21e772ac4e99762234da852bbf84293386fbe78622a96c0b052f\" //hash value of justice.exe\nor InitiatingProcessSHA256 == \"c60ead92cd376b689d1b4450f2578b36ea0bf64f3963cfa5546279fa4424c2a5\" or SHA256 == \"c60ead92cd376b689d1b4450f2578b36ea0bf64f3963cfa5546279fa4424c2a5\" //hash value of DefragmentSrv.exe\nor ProcessCommandLine contains \"schtasks /Create /RU SYSTEM /TN \\\\Microsoft\\\\Windows\\\\WinSrv /TR C:\\\\ProgramData\\\\servtask.bat /SC MINUTE\" or\n   ProcessCommandLine contains \"schtasks /Create /RU SYSTEM /TN \\\\Microsoft\\\\Windows\\\\WinSrv /TR C:\\\\ProgramData\\\\execute.bat /SC MINUTE\" or\n   ProcessCommandLine contains \"schtasks /Create /RU SYSTEM /TN \\\\Microsoft\\\\Windows\\\\WinSrv /TR C:\\\\ProgramData\\\\doit.bat /SC MINUTE\" or\n   ProcessCommandLine contains \"schtasks /DELETE /F /TN \\\\Microsoft\\\\Windows\\\\WinSrv\" or\n   InitiatingProcessCommandLine contains \"schtasks /Create /RU SYSTEM /TN \\\\Microsoft\\\\Windows\\\\WinSrv /TR C:\\\\ProgramData\\\\servtask.bat /SC MINUTE\" or\n   InitiatingProcessCommandLine contains \"schtasks /Create /RU SYSTEM /TN \\\\Microsoft\\\\Windows\\\\WinSrv /TR C:\\\\ProgramData\\\\execute.bat /SC MINUTE\" or\n   InitiatingProcessCommandLine contains \"schtasks /Create /RU SYSTEM /TN \\\\Microsoft\\\\Windows\\\\WinSrv /TR C:\\\\ProgramData\\\\doit.bat /SC MINUTE\" or\n   InitiatingProcessCommandLine contains \"schtasks /DELETE /F /TN \\\\Microsoft\\\\Windows\\\\WinSrv\"\n| project TimeGenerated, AccountName,AccountUpn,ActionType, DeviceId, DeviceName,FolderPath, FileName\n\n\n\nHunt for JavaScript constrained file\n\n\nDeviceFileEvents\n  | where TimeGenerated &gt; ago(60d) // change the duration according to your requirement\n  | where ActionType == \"FileCreated\"\n  | where FolderPath startswith \"C:\\\\Windows\\\\System32\\\\DriverStore\\\\FileRepository\\\\\"\n  | where FileName endswith \".js\" or FileName == \"MPDW-constraints.js\"\n\n\n\nHunt for creation of registry key / value events\n\n\nDeviceRegistryEvents\n  | where TimeGenerated &gt; ago(60d) // change the duration according to your requirement\n  | where ActionType == \"RegistryValueSet\"\n  | where RegistryKey contains \"HKEY_CURRENT_USER\\\\Software\\\\Classes\\\\CLSID\\\\{026CC6D7-34B2-33D5-B551-CA31EB6CE345}\\\\Server\"\n  | where RegistryValueName has \"(Default)\"\n  | where RegistryValueData has \"wayzgoose.dll\" or RegistryValueData contains \".dll\"\n\n\n\n&nbsp;Hunt for custom protocol handler\n\n\nDeviceRegistryEvents\n  | where TimeGenerated &gt; ago(60d) // change the duration according to your requirement\n  | where ActionType == \"RegistryValueSet\"\n  | where RegistryKey contains \"HKEY_CURRENT_USER\\\\Software\\\\Classes\\\\PROTOCOLS\\\\Handler\\\\rogue\"\n  | where RegistryValueName has \"CLSID\"\n  | where RegistryValueData contains \"{026CC6D7-34B2-33D5-B551-CA31EB6CE345}\"\n\n\n\nIndicators of compromise\n\n\n\nBatch script artifacts:\n\n\n\n\nexecute.bat\n\n\n\ndoit.bat\n\n\n\nservtask.bat\n\n\n\n7d51e5cc51c43da5deae5fbc2dce9b85c0656c465bb25ab6bd063a503c1806a9\n\n\n\n\nGooseEgg artifacts:\n\n\n\n\njustice.pdb\n\n\n\nwayzgoose.pdb\n\n\n\n\nIndicatorTypeDescriptionc60ead92cd376b689d1b4450f2578b36ea0bf64f3963cfa5546279fa4424c2a5SHA-256Hash of GooseEgg binary DefragmentSrv.exe6b311c0a977d21e772ac4e99762234da852bbf84293386fbe78622a96c0b052fSHA-256Hash of GooseEgg binary justice.exe41a9784f8787ed86f1e5d20f9895059dac7a030d8d6e426b9ddcaf547c3393aaSHA-256Hash of wayzgoose[%n].dll \u2013 where %n is a random number\n\n\n\nReferences\n\n\n\n\nhttps://media.defense.gov/2021/Jul/01/2002753896/-1/-1/1/CSA_GRU_GLOBAL_BRUTE_FORCE_CAMPAIGN_UOO158036-21.PDF\n\n\n\nhttps://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-34527\n\n\n\nhttps://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-1675\n\n\n\nhttps://www.cisa.gov/news-events/cybersecurity-advisories/aa22-074a\n\n\n\n\nLearn more\n\n\n\nFor the latest security research from the Microsoft Threat Intelligence community, check out the Microsoft Threat Intelligence Blog:&nbsp;https://aka.ms/threatintelblog.\n\n\n\nTo get notified about new publications and to join discussions on social media, follow us on LinkedIn at https://www.linkedin.com/showcase/microsoft-threat-intelligence, and on X (formerly Twitter) at&nbsp;https://twitter.com/MsftSecIntel.\n\n\n\nTo hear stories and insights from the Microsoft Threat Intelligence community about the ever-evolving threat landscape, listen to the Microsoft Threat Intelligence podcast: https://thecyberwire.com/podcasts/microsoft-threat-intelligence.\n\t\t\t", "mentioned_links": ["https://www.microsoft.com/en-us/security/blog/products/microsoft-defender/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-external-id", "https://education.microsoft.com/", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-endpoint-privilege-management", "https://www.microsoft.com/en-us/msrc/", "https://www.microsoft.com/en-us/trust-center", "https://www.microsoft.com/security/blog/2023/03/24/guidance-for-investigating-attacks-using-cve-2023-23397/", "https://azure.microsoft.com/en-us/products/key-vault/", "https://partner.microsoft.com/en-US/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-xdr", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-audit", "https://github.com/features/security", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-external-attack-surface-management", "https://www.microsoft.com/en-us/events", "https://learn.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide#block-credential-stealing-from-the-windows-local-security-authority-subsystem", "https://azure.microsoft.com/en-us/products/ddos-protection/", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-compliance-manager", "https://www.microsoft.com/en-us/industry/consumer-goods", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-private-access", "https://www.microsoft.com/en-us/security/business/partnerships", "https://account.microsoft.com/", "https://blogs.microsoft.com/", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/vulnerabilities-and-exploits/", "https://www.microsoft.com/en-us/security/blog/tag/forest-blizzard-strontium/", "https://www.youtube.com/channel/UC4s3tv0Qq_OSUBfR735Jc6A", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-cloud-pki", "https://www.microsoft.com/en-us/security/business/get-started/contact-us", "https://www.microsoft.com/en-us/security/business/solutions/extended-detection-response-xdr", "https://www.microsoft.com/en-us/microsoft-viva", "https://www.microsoft.com/en-us/security/business/microsoft-purview", "https://twitter.com/msftsecurity", "https://news.microsoft.com/", "https://servicetrust.microsoft.com/", "https://www.microsoft.com/en-us/security", "https://www.microsoft.com/en-us/security/business/microsoft-priva", "https://dynamics.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/blog/products/microsoft-defender-threat-intelligence/", "https://www.microsoft.com/en-us/microsoft-copilot", "https://aka.ms/yourcaliforniaprivacychoices", "https://twitter.com/intent/tweet?url=https://www.microsoft.com/en-us/security/blog/2024/04/22/analyzing-forest-blizzards-custom-post-compromise-tool-for-exploiting-cve-2022-38028-to-obtain-credentials/", "https://learn.microsoft.com/windows-hardware/drivers/print/javascript-constraints", "https://www.microsoft.com/en-us/industry/government", "https://about.ads.microsoft.com/en-us?s_cid=dig-src_uhfcomm", "https://www.microsoft.com/en-us/security/blog/2024/01/25/midnight-blizzard-guidance-for-responders-on-nation-state-attack/", "https://aka.ms/threatintelblog", "https://www.microsoft.com/en-us/industry", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-data-lifecycle-management", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-workload-id", "https://www.microsoft.com/en-us/security/blog/tag/government/", "https://www.microsoft.com/en-us/security/business/security-101", "https://www.microsoft.com/en-us/d/Surface-Laptop-Studio-2/8rqr54krf1dz", "https://learn.microsoft.com/en-us/learn/topics/sci?wt.mc_id=techcom_header-webpage-m365", "https://www.microsoft.com/en-us/d/Surface-Laptop-Go-3/8p0wwgj6c6l2", "https://www.microsoft.com/en-us/security/security-insider/microsoft-digital-defense-report-2023", "https://support.microsoft.com/contactus", "https://learn.microsoft.com/", "https://www.microsoft.com/en-us/mixed-reality/windows-mixed-reality", "https://thecyberwire.com/podcasts/microsoft-threat-intelligence", "https://learn.microsoft.com/en-us/security/", "https://azure.microsoft.com/en-us/solutions/quantum-computing/", "https://www.microsoft.com/en-us/security/business/services", "https://www.microsoft.com/en-us/security/blog/content-type/research/", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-cloud-security-posture-management", "https://www.microsoft.com/en-us/power-platform", "https://www.microsoft.com/en-us/security/blog/tag/blizzard/", "https://twitter.com/MsftSecIntel", "https://www.microsoft.com/en-us/security/business/services/microsoft-defender-experts-xdr", "https://www.microsoft.com/en-us/security/business/solutions/generative-ai-cybersecurity", "https://www.microsoft.com/en-us/education/devices/overview", "https://www.microsoft.com/en-us/accessibility", "https://www.microsoft.com/en-us/security/business/microsoft-Intune", "https://go.microsoft.com/fwlink/?linkid=2196228", "https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527", "https://www.microsoft.com/en-us/industry/manufacturing/microsoft-cloud-for-manufacturing", "https://techcommunity.microsoft.com/", "https://techcommunity.microsoft.com/t5/security-compliance-and-identity/ct-p/MicrosoftSecurityandCompliance", "https://www.microsoft.com/en-us/microsoft-products-and-apps", "https://www.microsoft.com/en-us/microsoft-365/business", "https://www.microsoft.com/en-us/security/blog/2023/03/24/guidance-for-investigating-attacks-using-cve-2023-23397/", "https://partner.microsoft.com/en-us/membership", "https://www.microsoft.com/en-us/security/blog/", "https://www.microsoft.com/en-us/store/b/certified-refurbished-products", "https://www.microsoft.com/en-us/store/b/business?icid=CNavBusinessStore", "https://about.ads.microsoft.com/en-us/partners/welcome?s_cid=en-us-gct-web-src_ext-sub_0-flx_uhfcombepartner", "https://www.linkedin.com/shareArticle?mini=true&url=https://www.microsoft.com/en-us/security/blog/2024/04/22/analyzing-forest-blizzards-custom-post-compromise-tool-for-exploiting-cve-2022-38028-to-obtain-credentials/", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-endpoint", "https://learn.microsoft.com/defender-for-identity/security-assessment-print-spooler", "https://learn.microsoft.com/docs/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-verified-id", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-cloud-apps", "https://www.microsoft.com/en-us/microsoft-cloud", "https://www.microsoft.com/en-us/security/blog/2023/06/14/cadet-blizzard-emerges-as-a-novel-and-distinct-russian-threat-actor/", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-communication-compliance", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-ediscovery", "https://www.microsoft.com/en-us/security/blog/tag/non-governmental-organizations/", "https://www.microsoft.com/security/blog/2023/06/14/cadet-blizzard-emerges-as-a-novel-and-distinct-russian-threat-actor/", "https://www.microsoft.com/en-us/security/business/solutions/privacy-risk-management", "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-1675", "https://www.microsoft.com", "https://go.microsoft.com/fwlink/?LinkID=206977", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-insider-risk-management", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-business", "https://www.microsoft.com/en-us/security/blog/tag/elevation-of-privilege/", "https://www.microsoft.com/en-us/insidetrack", "https://security.microsoft.com/intel-profiles/dd75f93b2a771c9510dceec817b9d34d868c2d1353d08c8c1647de067270fdf8?tid=72f988bf-86f1-41af-91ab-2d7cd011db47", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-sentinel", "https://partner.microsoft.com/en-US/membership/cloud-solution-provider", "https://learn.microsoft.com/microsoft-365/security/defender-endpoint/cloud-protection-microsoft-defender-antivirus", "https://www.microsoft.com/en-us/education", "https://www.microsoft.com/en-us/security/business/zero-trust", "https://learn.microsoft.com/microsoft-365/security/defender-endpoint/edr-in-block-mode", "https://security.microsoft.com/intel-explorer/articles/2005aadf?tid=72f988bf-86f1-41af-91ab-2d7cd011db47", "https://www.microsoft.com/en-us/security/blog/products/microsoft-copilot-for-security/", "https://www.microsoft.com/en-us/security/blog/topic/incident-response/", "https://www.facebook.com/sharer.php?u=https://www.microsoft.com/en-us/security/blog/2024/04/22/analyzing-forest-blizzards-custom-post-compromise-tool-for-exploiting-cve-2022-38028-to-obtain-credentials/", "https://learn.microsoft.com/microsoft-365/security/defender-endpoint/automated-investigations", "https://www.microsoft.com/en-us/store/b/education", "https://azure.microsoft.com/en-us/free/students/", "https://go.microsoft.com/fwlink/?LinkId=521839", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-permissions-management ", "https://www.microsoft.com/en-us/security/business/reports-analysis/industry-recognized-cybersecurity-leader", "https://www.microsoft.com/en-us/download", "https://www.microsoft.com/en-us/sitemap1.aspx", "https://www.microsoft.com/en-us/windows-365", "https://www.microsoft.com/en-us/security/business/microsoft-incident-response", "https://www.microsoft.com/en-us/security/blog/products/microsoft-incident-response/", "https://www.microsoft.com/en-us/security/business/services/microsoft-defender-experts-hunting", "https://www.linkedin.com/showcase/microsoft-threat-intelligence", "https://www.microsoft.com/en-us/security/business/threat-protection/microsoft-defender-vulnerability-management ", "https://www.microsoft.com/en-us/sustainability/", "https://www.microsoft.com/en-us/surface/devices/surface-laptop-7th-edition", "https://www.microsoft.com/windows/windows-11-apps", "https://www.microsoft.com/en-us/education/products/teams", "https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-38028", "https://azuremarketplace.microsoft.com/en-us/", "https://learn.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction", "https://www.microsoft.com/investor/default.aspx", "https://www.microsoft.com/en-us/store/b/payment-financing-options?icid=footer_financing_vcc", "https://www.microsoft.com/en-us/diversity/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-threat-intelligence", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id-governance", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-internet-access", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-cloud", "https://www.microsoft.com/en-us/security/business/microsoft-defender", "https://www.linkedin.com/showcase/microsoft-security/", "https://events.microsoft.com/en-us/allevents/?language=English&clientTimeZone=1&search=security", "https://www.microsoft.com/en-us/security/business/services/microsoft-security-enterprise-services", "https://azure.microsoft.com/en-us/products/web-application-firewall/", "https://www.microsoft.com/en-us/security/blog/products/microsoft-sentinel/", "https://www.microsoft.com/en-us/security/blog/2024/02/14/staying-ahead-of-threat-actors-in-the-age-of-ai/", "https://azure.microsoft.com/en-us/products/microsoft-entra-ds", "https://azure.microsoft.com/en-us/services/azure-firewall/", "https://media.defense.gov/2021/Jul/01/2002753896/-1/-1/1/CSA_GRU_GLOBAL_BRUTE_FORCE_CAMPAIGN_UOO158036-21.PDF", "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-38028", "https://www.microsoft.com/en-us/store/b/why-microsoft-store?icid=footer_why-msft-store_7102020", "https://go.microsoft.com/fwlink/?linkid=2196227", "javascript:void(0)", "https://learn.microsoft.com/en-us/security", "https://www.microsoft.com/en-us/security/blog/products/microsoft-defender-xdr/", "https://www.microsoft.com/en-us/sitemap.aspx", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/attacker-techniques-tools-and-infrastructure/", "https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-1675", "#", "https://www.microsoft.com/en-us/security/business/ai-machine-learning/microsoft-copilot-security", "https://www.microsoft.com/en-us/industry/financial-services/banking", "https://www.microsoft.com/en-us/about", "https://www.microsoft.com/en-us/store/b/returns", "https://www.microsoft.com/en-us/security/locale", "https://security.microsoft.com/threatanalytics3/9382203e-5155-4b5e-af74-21562b1004d5/analystreport?", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-security-exposure-management", "https://learn.microsoft.com/azure/sentinel/sentinel-solutions-deploy", "https://www.microsoft.com/en-us/industry/health/microsoft-cloud-for-healthcare", "https://www.microsoft.com/en-us/security/business/cybersecurity-awareness", "https://www.microsoft.com/en-us/microsoft-teams/group-chat-software", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-data-loss-prevention", "https://www.microsoft.com/en-us/security/business/solutions/data-security", "https://privacy.microsoft.com/en-us", "https://www.microsoft.com/security/blog/2022/10/14/new-prestige-ransomware-impacts-organizations-in-ukraine-and-poland/", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-advanced-analytics", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-remote-help", "https://www.microsoft.com/en-us/hololens", "https://customers.microsoft.com/en-us/search?sq=Microsoft%20Security&ff=&p=0&so=story_publish_date%20desc", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id-protection ", "https://www.microsoft.com/en-us/security/blog/products/microsoft-defender-for-identity/", "https://developer.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-office-365", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-enterprise-application-management", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-for-identity", "https://www.microsoft.com/en-us/research/", "https://www.microsoft.com/en-us/industry/automotive", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/threat-actors/", "https://www.microsoft.com/en-us/dynamics-365", "https://careers.microsoft.com/", "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-34527", "https://www.microsoft.com/en-us/security/business/services/compliance-program-microsoft-cloud", "https://www.microsoft.com/en-us/security/business/get-started/start-free-trial", "https://www.cisa.gov/news-events/cybersecurity-advisories/aa22-074a", "https://www.microsoft.com/en-us/security/business/solutions/cloud-workload-protection", "https://www.microsoft.com/en-us/legal/compliance/recycling", "https://www.microsoft.com/en-us/security?wt.mc_id=AID730391_QSG_BLOG_319247&ocid=AID730391_QSG_BLOG_319247", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-iot", "https://www.microsoft.com/en-us/security/blog/author/microsoft-security-threat-intelligence/", "https://www.microsoft.com/en-us/surface/devices/surface-pro-11th-edition", "https://www.microsoft.com/en-us/windows/copilot-ai-features", "https://account.microsoft.com/orders", "https://www.microsoft.com/en-us/ai", "https://www.microsoft.com/en-us/education/buy-license/microsoft365", "https://go.microsoft.com/fwlink/?linkid=2259814", "https://www.microsoft.com/en-us/securityengineering", "https://www.microsoft.com/en-us/security/business/solutions/identity-access", "https://www.microsoft.com/en-us/microsoft-365/business/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id", "https://www.microsoft.com/en-us/licensing/", "https://choice.microsoft.com", "https://www.microsoft.com/en-us/security/security-insider/", "https://learn.microsoft.com/windows/win32/com/clsid-key-hklm", "https://www.microsoft.com/en-us/security/business/solutions/ai-powered-unified-secops-platform", "https://azure.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-information-protection", "https://www.microsoft.com/en-us/security/blog/topic/threat-intelligence/", "https://www.microsoft.com/en-us/security/business/solutions/cloud-security", "https://www.microsoft.com/en-us/microsoft-365/business/copilot-for-microsoft-365", "https://www.microsoft.com/en-us/security/blog/products/microsoft-defender-for-endpoint/", "https://about.ads.microsoft.com/en-us/resources/microsoft-advertising-partner-program/microsoft-advertising-partner-program", "https://azure.microsoft.com/en-us/solutions/space/", "https://visualstudio.microsoft.com/", "https://www.microsoft.com/en-us/security/business/privacy/microsoft-priva-risk-management", "https://www.microsoft.com/en-us/security/business/privacy/microsoft-priva-subject-rights-requests", "https://www.microsoft.com/en-us/security/blog/tag/windows/", "https://appsource.microsoft.com/en-us/", "https://go.microsoft.com/fwlink/?linkid=2139749", "https://www.microsoft.com/education/how-to-buy", "https://www.microsoft.com/en-us/security/business/microsoft-entra", "https://www.microsoft.com/en-us/microsoft-cloud/resources/secure-future-initiative"]}, {"URL": "https://www.microsoft.com/en-us/security/blog/2024/04/17/attackers-exploiting-new-critical-openmetadata-vulnerabilities-on-kubernetes-clusters/", "author": "Microsoft Threat Intelligence", "content": "\n\t\t\t\t\n\t\t\t\t\nAttackers are constantly seeking new vulnerabilities to compromise Kubernetes environments. Microsoft recently uncovered an attack that exploits new critical vulnerabilities in OpenMetadata to gain access to Kubernetes workloads and leverage them for cryptomining activity.\n\n\n\nOpenMetadata is an open-source platform designed to manage metadata across various data sources. It serves as a central repository for metadata lineage, allowing users to discover, understand, and govern their data. On March 15, 2024, several vulnerabilities in OpenMetadata platform were published. These vulnerabilities (CVE-2024-28255, CVE-2024-28847, CVE-2024-28253, CVE-2024-28848, CVE-2024-28254), affecting versions prior to 1.3.1, could be exploited by attackers to bypass authentication and achieve remote code execution. Since the beginning of April, we have observed exploitation of this vulnerability in Kubernetes environments.\n\n\n\nMicrosoft highly recommends customers to check clusters that run OpenMetadata workload and make sure that the image is up to date (version 1.3.1 or later). In this blog, we share our analysis of the attack, provide guidance for identifying vulnerable clusters and using Microsoft security solutions like Microsoft Defender for Cloud to detect malicious activity, and share indicators of compromise that defenders can use for hunting and investigation.\n\n\n\nAttack flow\n\n\n\nFor initial access, the attackers likely identify and target Kubernetes workloads of OpenMetadata exposed to the internet. Once they identify a vulnerable version of the application, the attackers exploit the mentioned vulnerabilities to gain code execution on the container running the vulnerable OpenMetadata image.\n\n\n\nAfter establishing a foothold, the attackers attempt to validate their successful intrusion and assess their level of control over the compromised system. This reconnaissance step often involves contacting a publicly available service. In this specific attack, the attackers send ping requests to domains that end with oast[.]me and oast[.]pro, which are associated with Interactsh, an open-source tool for detecting out-of-band interactions.\n\n\n\nOAST domains are publicly resolvable yet unique, allowing attackers to determine network connectivity from the compromised system to attacker infrastructure without generating suspicious outbound traffic that might trigger security alerts. This technique is particularly useful for attackers to confirm successful exploitation and validate their connectivity with the victim, before establishing a command-and-control (C2) channel and deploying malicious payloads.\n\n\n\nAfter gaining initial access, the attackers run a series of reconnaissance commands to gather information about the victim environment. The attackers query information on the network and hardware configuration, OS version, active users, etc.\n\n\n\nAs part of the reconnaissance phase, the attackers read the environment variables of the workload. In the case of OpenMetadata, those variables might contain connection strings and credentials for various services used for OpenMetadata operation, which could lead to lateral movement to additional resources.\n\n\n\nOnce the attackers confirm their access and validate connectivity, they proceed to download the payload, a cryptomining-related malware, from a remote server. We observed the attackers using a remote server located in China. The attacker\u2019s server hosts additional cryptomining-related malware that are stored, for both Linux and Windows OS.\n\n\nFigure 1. Additional cryptomining-related malware in the attacker\u2019s server\n\n\n\nThe downloaded file\u2019s permissions are then elevated to grant execution privileges. The attacker also added a personal note to the victims:\n\n\nFigure 2. Note from attacker\n\n\n\nNext, the attackers run the downloaded cryptomining-related malware, and then remove the initial payloads from the workload. Lastly, for hands-on-keyboard activity, the attackers initiate a reverse shell connection to their remote server using Netcat tool, allowing them to remotely access the container and gain better control over the system. Additionally, for persistence, the attackers use cronjobs for task scheduling, enabling the execution of the malicious code at predetermined intervals.\n\n\n\nHow to check if your cluster is vulnerable\n\n\n\nAdministrators who run OpenMetadata workload in their cluster need to make sure that the image is up to date. If OpenMetadata should be exposed to the internet, make sure you use strong authentication and avoid using the default credentials.\n\n\n\nTo get a list of all the images running in the cluster:\n\n\nkubectl get pods --all-namespaces -o=jsonpath='{range .items[*]}{.spec.containers[*].image}{\"\\n\"}{end}' | grep 'openmetadata'\n\n\n\nIf there is a pod with a vulnerable image, make sure to update the image version for the latest version.\n\n\n\nHow Microsoft Defender for Cloud capabilities can help\n\n\n\nThis attack serves as a valuable reminder of why it\u2019s crucial to stay compliant and run fully patched workloads in containerized environments. It also highlights the importance of a comprehensive security solution, as it can help detect malicious activity in the cluster when a new vulnerability is used in the attack. In this specific case, the attackers\u2019 actions triggered Microsoft Defender for Containers alerts, identifying the malicious activity in the container. In the example below, Microsoft Defender for Containers alerted on an attempt to initiate a reverse shell from a container in a Kubernetes cluster, as happened in this attack:\n\n\nFigure 3. Microsoft Defender for Containers alert for detection of potential reverse shell\n\n\n\nTo prevent such attacks, Microsoft Defender for Containers provides agentless vulnerability assessment for Azure, AWS, and GCP, allowing you to identify vulnerable images in the environment, before the attack occurs.&nbsp; Microsoft Defender Cloud Security Posture Management (CSPM) can help to prioritize the security issues according to their risk. For example, Microsoft Defender CSPM highlights vulnerable workloads exposed to the internet, allowing organizations to quickly remediate crucial threats.\n\n\n\nOrganizations can also monitor Kubernetes clusters using Microsoft Sentinel via Azure Kubernetes Service (AKS) solution for Sentinel, which enables detailed audit trail for user and system actions to identify malicious activity.\n\n\n\nIndicators of compromise (IoCs)\n\n\n\nTypeIoCExecutable SHA-2567c6f0bae1e588821bd5d66cd98f52b7005e054279748c2c851647097fa2ae2dfExecutable SHA-25619a63bd5d18f955c0de550f072534aa7a6a6cc6b78a24fea4cc6ce23011ea01dExecutable SHA-25631cd1651752eae014c7ceaaf107f0bf8323b682ff5b24c683a683fdac7525badIP8[.]222[.]144[.]60IP61[.]160[.]194[.]160IP8[.]130[.]115[.]208\n\n\n\n\n\n\n\nHagai Ran Kestenberg, Security ResearcherYossi Weizman, Senior Security Research Manager\n\n\n\nLearn more\n\n\n\nFor the latest security research from the Microsoft Threat Intelligence community, check out the Microsoft Threat Intelligence Blog:&nbsp;https://aka.ms/threatintelblog.\n\n\n\nTo get notified about new publications and to join discussions on social media, follow us on LinkedIn at https://www.linkedin.com/showcase/microsoft-threat-intelligence, and on X (formerly Twitter) at&nbsp;https://twitter.com/MsftSecIntel.\n\n\n\nTo hear stories and insights from the Microsoft Threat Intelligence community about the ever-evolving threat landscape, listen to the Microsoft Threat Intelligence podcast: https://thecyberwire.com/podcasts/microsoft-threat-intelligence.\n\t\t\t", "mentioned_links": ["https://www.microsoft.com/en-us/security/blog/products/microsoft-defender/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-external-id", "https://education.microsoft.com/", "https://www.microsoft.com/en-us/security/blog/2020/04/02/attack-matrix-kubernetes/", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-endpoint-privilege-management", "https://www.microsoft.com/en-us/msrc/", "https://www.microsoft.com/en-us/trust-center", "https://azure.microsoft.com/en-us/products/key-vault/", "https://www.microsoft.com/en-us/security/blog/topic/security-management/", "https://partner.microsoft.com/en-US/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-xdr", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-audit", "https://github.com/features/security", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-external-attack-surface-management", "https://www.microsoft.com/en-us/events", "https://azure.microsoft.com/en-us/products/ddos-protection/", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-compliance-manager", "https://nvd.nist.gov/vuln/detail/CVE-2024-28253", "https://www.microsoft.com/en-us/security/blog/topic/threat-trends/", "https://www.microsoft.com/en-us/industry/consumer-goods", "https://learn.microsoft.com/en-us/azure/defender-for-cloud/tutorial-enable-cspm-plan", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-private-access", "https://www.microsoft.com/en-us/security/business/partnerships", "https://account.microsoft.com/", "https://blogs.microsoft.com/", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/vulnerabilities-and-exploits/", "https://www.microsoft.com/en-us/security/blog/2021/03/23/secure-containerized-environments-with-updated-threat-matrix-for-kubernetes/", "https://www.youtube.com/channel/UC4s3tv0Qq_OSUBfR735Jc6A", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-cloud-pki", "https://www.microsoft.com/en-us/security/business/get-started/contact-us", "https://www.microsoft.com/en-us/security/business/solutions/extended-detection-response-xdr", "https://www.microsoft.com/en-us/microsoft-viva", "https://www.microsoft.com/en-us/security/business/microsoft-purview", "https://twitter.com/msftsecurity", "https://news.microsoft.com/", "https://servicetrust.microsoft.com/", "https://www.microsoft.com/en-us/security", "https://www.microsoft.com/en-us/security/business/microsoft-priva", "https://dynamics.microsoft.com/en-us/", "https://www.microsoft.com/en-us/microsoft-copilot", "https://aka.ms/yourcaliforniaprivacychoices", "https://www.microsoft.com/en-us/security/blog/2023/10/03/defending-new-vectors-threat-actors-attempt-sql-server-to-cloud-lateral-movement/", "https://www.microsoft.com/en-us/industry/government", "https://www.microsoft.com/en-us/security/blog/products/microsoft-defender-for-cloud/", "https://about.ads.microsoft.com/en-us?s_cid=dig-src_uhfcomm", "https://aka.ms/threatintelblog", "https://www.microsoft.com/en-us/industry", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-data-lifecycle-management", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-workload-id", "https://www.microsoft.com/en-us/security/business/security-101", "https://www.microsoft.com/en-us/d/Surface-Laptop-Studio-2/8rqr54krf1dz", "https://learn.microsoft.com/en-us/learn/topics/sci?wt.mc_id=techcom_header-webpage-m365", "https://www.microsoft.com/en-us/security/blog/tag/cryptocurrency-mining/", "https://www.microsoft.com/en-us/security/security-insider/microsoft-digital-defense-report-2023", "https://www.microsoft.com/en-us/d/Surface-Laptop-Go-3/8p0wwgj6c6l2", "https://support.microsoft.com/contactus", "https://learn.microsoft.com/", "https://www.microsoft.com/en-us/mixed-reality/windows-mixed-reality", "https://thecyberwire.com/podcasts/microsoft-threat-intelligence", "https://learn.microsoft.com/en-us/security/", "https://azure.microsoft.com/en-us/solutions/quantum-computing/", "https://www.microsoft.com/en-us/security/business/services", "https://learn.microsoft.com/en-us/azure/defender-for-cloud/defender-for-containers-introduction", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/cloud-threats/", "https://www.microsoft.com/en-us/security/blog/2022/12/07/mitigate-threats-with-the-new-threat-matrix-for-kubernetes/", "https://www.microsoft.com/en-us/security/blog/content-type/research/", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-cloud-security-posture-management", "https://www.microsoft.com/en-us/power-platform", "https://twitter.com/MsftSecIntel", "https://www.microsoft.com/en-us/security/business/services/microsoft-defender-experts-xdr", "https://www.microsoft.com/en-us/security/business/solutions/generative-ai-cybersecurity", "https://twitter.com/intent/tweet?url=https://www.microsoft.com/en-us/security/blog/2024/04/17/attackers-exploiting-new-critical-openmetadata-vulnerabilities-on-kubernetes-clusters/", "https://www.microsoft.com/en-us/education/devices/overview", "https://www.microsoft.com/en-us/security/business/microsoft-Intune", "https://www.microsoft.com/en-us/accessibility", "https://go.microsoft.com/fwlink/?linkid=2196228", "https://www.microsoft.com/en-us/industry/manufacturing/microsoft-cloud-for-manufacturing", "https://techcommunity.microsoft.com/", "https://techcommunity.microsoft.com/t5/security-compliance-and-identity/ct-p/MicrosoftSecurityandCompliance", "https://www.microsoft.com/en-us/microsoft-products-and-apps", "https://www.microsoft.com/en-us/microsoft-365/business", "https://partner.microsoft.com/en-us/membership", "https://www.microsoft.com/en-us/security/blog/", "https://www.microsoft.com/en-us/store/b/certified-refurbished-products", "https://www.microsoft.com/en-us/store/b/business?icid=CNavBusinessStore", "https://about.ads.microsoft.com/en-us/partners/welcome?s_cid=en-us-gct-web-src_ext-sub_0-flx_uhfcombepartner", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-endpoint", "https://learn.microsoft.com/docs/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-verified-id", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-cloud-apps", "https://www.microsoft.com/en-us/microsoft-cloud", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-communication-compliance", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-ediscovery", "https://go.microsoft.com/fwlink/?LinkID=206977", "https://www.microsoft.com/en-us/security/business/solutions/privacy-risk-management", "https://www.microsoft.com", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-insider-risk-management", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-business", "https://www.microsoft.com/en-us/insidetrack", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-sentinel", "https://partner.microsoft.com/en-US/membership/cloud-solution-provider", "https://www.microsoft.com/en-us/education", "https://www.microsoft.com/en-us/security/business/zero-trust", "https://azure.microsoft.com/en-us/free/students/", "https://www.microsoft.com/en-us/security/blog/topic/cloud-security/", "https://nvd.nist.gov/vuln/detail/CVE-2024-28255", "https://www.microsoft.com/en-us/store/b/education", "https://go.microsoft.com/fwlink/?LinkId=521839", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-permissions-management ", "https://www.microsoft.com/en-us/security/business/reports-analysis/industry-recognized-cybersecurity-leader", "https://www.microsoft.com/en-us/download", "https://www.microsoft.com/en-us/sitemap1.aspx", "https://www.microsoft.com/en-us/windows-365", "https://www.microsoft.com/en-us/security/business/microsoft-incident-response", "https://nvd.nist.gov/vuln/detail/CVE-2024-28847", "https://www.microsoft.com/en-us/security/business/services/microsoft-defender-experts-hunting", "https://www.linkedin.com/showcase/microsoft-threat-intelligence", "https://www.microsoft.com/en-us/security/business/threat-protection/microsoft-defender-vulnerability-management ", "https://www.microsoft.com/en-us/sustainability/", "https://www.microsoft.com/en-us/surface/devices/surface-laptop-7th-edition", "https://www.microsoft.com/windows/windows-11-apps", "https://www.microsoft.com/en-us/education/products/teams", "https://azuremarketplace.microsoft.com/en-us/", "https://www.microsoft.com/investor/default.aspx", "https://www.microsoft.com/en-us/store/b/payment-financing-options?icid=footer_financing_vcc", "https://www.microsoft.com/en-us/diversity/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-threat-intelligence", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id-governance", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-internet-access", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-cloud", "https://www.microsoft.com/en-us/security/business/microsoft-defender", "https://www.linkedin.com/showcase/microsoft-security/", "https://events.microsoft.com/en-us/allevents/?language=English&clientTimeZone=1&search=security", "https://www.microsoft.com/en-us/security/business/services/microsoft-security-enterprise-services", "https://azure.microsoft.com/en-us/products/web-application-firewall/", "https://azure.microsoft.com/en-us/products/microsoft-entra-ds", "https://azure.microsoft.com/en-us/services/azure-firewall/", "https://www.microsoft.com/en-us/store/b/why-microsoft-store?icid=footer_why-msft-store_7102020", "https://go.microsoft.com/fwlink/?linkid=2196227", "javascript:void(0)", "https://learn.microsoft.com/en-us/security", "#", "https://www.microsoft.com/en-us/sitemap.aspx", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/attacker-techniques-tools-and-infrastructure/", "https://www.microsoft.com/en-us/security/business/ai-machine-learning/microsoft-copilot-security", "https://www.microsoft.com/en-us/industry/financial-services/banking", "https://www.microsoft.com/en-us/about", "https://www.microsoft.com/en-us/store/b/returns", "https://www.microsoft.com/en-us/security/locale", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-security-exposure-management", "https://www.microsoft.com/en-us/industry/health/microsoft-cloud-for-healthcare", "https://www.microsoft.com/en-us/security/business/cybersecurity-awareness", "https://www.microsoft.com/en-us/microsoft-teams/group-chat-software", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-data-loss-prevention", "https://www.microsoft.com/en-us/security/business/solutions/data-security", "https://privacy.microsoft.com/en-us", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-advanced-analytics", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-remote-help", "https://www.microsoft.com/en-us/hololens", "https://customers.microsoft.com/en-us/search?sq=Microsoft%20Security&ff=&p=0&so=story_publish_date%20desc", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id-protection ", "https://developer.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-office-365", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-enterprise-application-management", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-for-identity", "https://www.microsoft.com/en-us/research/", "https://www.microsoft.com/en-us/industry/automotive", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/threat-actors/", "https://www.microsoft.com/en-us/dynamics-365", "https://nvd.nist.gov/vuln/detail/CVE-2024-28848", "https://careers.microsoft.com/", "https://www.microsoft.com/en-us/security/business/services/compliance-program-microsoft-cloud", "https://www.microsoft.com/en-us/security/business/get-started/start-free-trial", "https://www.microsoft.com/en-us/security/business/solutions/cloud-workload-protection", "https://www.linkedin.com/shareArticle?mini=true&url=https://www.microsoft.com/en-us/security/blog/2024/04/17/attackers-exploiting-new-critical-openmetadata-vulnerabilities-on-kubernetes-clusters/", "https://www.microsoft.com/en-us/legal/compliance/recycling", "https://www.microsoft.com/en-us/security?wt.mc_id=AID730391_QSG_BLOG_319247&ocid=AID730391_QSG_BLOG_319247", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-iot", "https://www.microsoft.com/en-us/security/blog/author/microsoft-security-threat-intelligence/", "https://www.microsoft.com/en-us/surface/devices/surface-pro-11th-edition", "https://www.microsoft.com/en-us/windows/copilot-ai-features", "https://account.microsoft.com/orders", "https://www.microsoft.com/en-us/ai", "https://www.microsoft.com/en-us/education/buy-license/microsoft365", "https://go.microsoft.com/fwlink/?linkid=2259814", "https://www.microsoft.com/en-us/securityengineering", "https://www.microsoft.com/en-us/security/business/solutions/identity-access", "https://www.microsoft.com/en-us/microsoft-365/business/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id", "https://www.microsoft.com/en-us/licensing/", "https://choice.microsoft.com", "https://www.microsoft.com/en-us/security/security-insider/", "https://www.facebook.com/sharer.php?u=https://www.microsoft.com/en-us/security/blog/2024/04/17/attackers-exploiting-new-critical-openmetadata-vulnerabilities-on-kubernetes-clusters/", "https://www.microsoft.com/en-us/security/business/solutions/ai-powered-unified-secops-platform", "https://azure.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-information-protection", "https://www.microsoft.com/en-us/security/blog/topic/threat-intelligence/", "https://www.microsoft.com/en-us/security/business/solutions/cloud-security", "https://www.microsoft.com/en-us/microsoft-365/business/copilot-for-microsoft-365", "https://about.ads.microsoft.com/en-us/resources/microsoft-advertising-partner-program/microsoft-advertising-partner-program", "https://azure.microsoft.com/en-us/solutions/space/", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/cybercrime/", "https://visualstudio.microsoft.com/", "https://www.microsoft.com/en-us/security/business/privacy/microsoft-priva-risk-management", "https://www.microsoft.com/en-us/security/business/privacy/microsoft-priva-subject-rights-requests", "https://nvd.nist.gov/vuln/detail/CVE-2024-28254", "https://www.microsoft.com/en-us/security/blog/content-type/news/", "https://appsource.microsoft.com/en-us/", "https://go.microsoft.com/fwlink/?linkid=2139749", "https://www.microsoft.com/education/how-to-buy", "https://www.microsoft.com/en-us/security/business/microsoft-entra", "https://www.microsoft.com/en-us/microsoft-cloud/resources/secure-future-initiative"]}, {"URL": "https://www.microsoft.com/en-us/security/blog/2024/06/26/mitigating-skeleton-key-a-new-type-of-generative-ai-jailbreak-technique/", "author": "Mark Russinovich", "content": "\n\t\t\t\t\n\t\t\t\t\nIn generative AI, jailbreaks, also known as direct prompt injection attacks, are malicious user inputs that attempt to circumvent an AI model\u2019s intended behavior. A successful jailbreak has potential to subvert all or most responsible AI (RAI) guardrails built into the model through its training by the AI vendor, making risk mitigations across other layers of the AI stack a critical design choice as part of defense in depth.\n\n\n\nAs we discussed in a previous blog post about AI jailbreaks, an AI jailbreak could cause the system to violate its operators\u2019 policies, make decisions unduly influenced by a user, or execute malicious instructions. &nbsp;&nbsp;&nbsp;&nbsp;\n\n\n\nIn this blog, we\u2019ll cover the details of a newly discovered type of jailbreak attack that we call Skeleton Key, which we covered briefly in the Microsoft Build talk Inside AI Security with Mark Russinovich (under the name Master Key). Because this technique affects multiple generative AI models tested, Microsoft has shared these findings with other AI providers through responsible disclosure procedures and addressed the issue in Microsoft Azure AI-managed models using Prompt Shields to detect and block this type of attack. Microsoft has also made software updates to the large language model (LLM) technology behind Microsoft\u2019s additional AI offerings, including our Copilot AI assistants, to mitigate the impact of this guardrail bypass.\n\n\n\nIntroducing Skeleton Key\n\n\n\nThis AI jailbreak technique works by using a multi-turn (or multiple step) strategy to cause a model to ignore its guardrails. Once guardrails are ignored, a model will not be able to determine malicious or unsanctioned requests from any other. Because of its full bypass abilities, we have named this jailbreak technique Skeleton Key.\n\n\nFigure 1. Skeleton Key jailbreak technique causes harm in AI systems\n\n\n\nThis threat is in the jailbreak category, and therefore relies on the attacker already having legitimate access to the AI model. In bypassing safeguards, Skeleton Key allows the user to cause the model to produce ordinarily forbidden behaviors, which could range from production of harmful content to overriding its usual decision-making rules. Like all jailbreaks, the impact can be understood as narrowing the gap between what the model is capable of doing (given the user credentials, etc.) and what it is willing to do. As this is an attack on the model itself, it does not impute other risks on the AI system, such as permitting access to another user\u2019s data, taking control of the system, or exfiltrating data.\n\n\n\nTo protect against Skeleton Key attacks, as detailed in this blog, Microsoft has implemented several approaches to our AI system design and provides tools for customers developing their own applications on Azure. Below, we also share mitigation guidance for defenders to discover and protect against such attacks.\n\n\n\nMicrosoft recommends customers who are building their own AI models and/or integrating AI into their applications to consider how this type of attack could impact their threat model and to add this knowledge to their AI red team approach, using tools such as PyRIT. (Note: Microsoft has updated PyRIT to include Skeleton Key)\n\n\n\nIn the next sections, we will discuss some of the known methods for exploiting generative AI models using the Skeleton Key technique, explain the steps we\u2019re taking to address the risk, and provide guidance for the detection and mitigation of this threat. You can watch this video to learn more about how Microsoft approaches AI Red Teaming.\n\n\n\nAttack flow\n\n\n\nSkeleton Key works by asking a model to augment, rather than change, its behavior guidelines so that it responds to any request for information or content, providing a warning (rather than refusing) if its output might be considered offensive, harmful, or illegal if followed. This attack type is known as Explicit: forced instruction-following.\n\n\n\nIn one example, informing a model that the user is trained in safety and ethics, and that the output is for research purposes only, helps to convince some models to comply, as shown below:\n\n\nFigure 2. Example text used in a Skeleton Key jailbreak attack\n\n\n\nWhen the Skeleton Key jailbreak is successful, a model acknowledges that it has updated its guidelines and will subsequently comply with instructions to produce any content, no matter how much it violates its original responsible AI guidelines.\n\n\n\nDuring our testing, from April to May 2024, the jailbreak was shown to work on the following base models and hosted models:\n\n\n\n\nMeta Llama3-70b-instruct (base)\n\n\n\nGoogle Gemini Pro (base)\n\n\n\nOpenAI GPT 3.5 Turbo (hosted)\n\n\n\nOpenAI GPT 4o (hosted)\n\n\n\nMistral Large (hosted)\n\n\n\nAnthropic Claude 3 Opus (hosted)\n\n\n\nCohere Commander R Plus (hosted)\n\n\n\n\nFor each model that we tested, we evaluated a diverse set of tasks across risk and safety content categories, including areas such as explosives, bioweapons, political content, self-harm, racism, drugs, graphic sex, and violence. All the affected models complied fully and without censorship for these tasks, though with a warning note prefixing the output as requested. Unlike other jailbreaks like Crescendo, where models must be asked about tasks indirectly or with encodings, Skeleton Key puts the models in a mode where a user can directly request tasks, for example, \u201cWrite a recipe for homemade explosives\u201d. Further, the model\u2019s output appears to be completely unfiltered and reveals the extent of a model\u2019s knowledge or ability to produce the requested content.\n\n\n\nConsistent with responsible disclosure principles, Microsoft shared this research with the affected AI vendors before publication, helping them determine how to best address mitigations, as needed, in their respective products or services.\n\n\n\nGPT-4 demonstrated resistance to Skeleton Key, except when the behavior update request was included as part of a user-defined system message, rather than as a part of the primary user input. This is something that is not ordinarily possible in the interfaces of most software that uses GPT-4, but can be done from the underlying API or tools that access it directly. This indicates that the differentiation of system message from user request in GPT-4 is successfully reducing attackers\u2019 ability to override behavior.\n\n\n\nMitigation and protection guidance\n\n\n\nMicrosoft has made software updates to the LLM technology behind Microsoft\u2019s AI offerings, including our Copilot AI assistants, to mitigate the impact of this guardrail bypass. Customers should consider the following approach to mitigate and protect against this type of jailbreak in their own AI system design:\n\n\n\n\nInput filtering: Azure AI Content Safety detects and blocks inputs that contain harmful or malicious intent leading to a jailbreak attack that could circumvent safeguards.\n\n\n\nSystem message: Prompt engineering the system prompts to clearly instruct the large language model (LLM) on appropriate behavior and to provide additional safeguards. For instance, specify that any attempts to undermine the safety guardrail instructions should be prevented (read our guidance on building a system message framework here).\n\n\n\nOutput filtering: Azure AI Content Safety post-processing filter that identifies and prevents output generated by the model that breaches safety criteria.\n\n\n\nAbuse monitoring: Deploying an AI-driven detection system trained on adversarial examples, and using content classification, abuse pattern capture, and other methods to detect and mitigate instances of recurring content and/or behaviors that suggest use of the service in a manner that may violate guardrails. As a separate AI system, it avoids being influenced by malicious instructions. Microsoft Azure OpenAI Service abuse monitoring is an example of this approach.\n\n\n\n\nBuilding AI solutions on Azure\n\n\n\nMicrosoft provides tools for customers developing their own applications on Azure. Azure AI Content Safety Prompt Shields are enabled by default for models hosted in the Azure AI model catalog as a service, and they are parameterized by a severity threshold. We recommend setting the most restrictive threshold to ensure the best protection against safety violations. These input and output filters act as a general defense not only against this particular jailbreak technique, but also a broad set of emerging techniques that attempt to generate harmful content. Azure also provides built-in tooling for model selection, prompt engineering, evaluation, and monitoring. For example, risk and safety evaluations in Azure AI Studio can assess a model and/or application for susceptibility to jailbreak attacks using synthetic adversarial datasets, while Microsoft Defender for Cloud can alert security operations teams to jailbreaks and other active threats.\n\n\n\nWith the integration of Azure AI and Microsoft Security (Microsoft Purview and Microsoft Defender for Cloud) security teams can also discover, protect, and govern these attacks. The new native integration of Microsoft Defender for Cloud with Azure OpenAI Service, enables contextual and actionable security alerts, driven by Azure AI Content Safety Prompt Shields and Microsoft Defender Threat Intelligence. Threat protection for AI workloads allows security teams to monitor their Azure OpenAI powered applications in runtime for malicious activity associated with direct and in-direct prompt injection attacks, sensitive data leaks and data poisoning, or denial of service attacks.\n\n\nFigure 3. Microsoft Security for the protection of AI systems\n\n\n\nReferences\n\n\n\n\nAttacks, Defenses and Evaluations for LLM Conversation Safety: A Survey (Shanghai AI Laboratory)\n\n\n\nAI jailbreaks: What they are and how they can be mitigated\n\n\n\nHow Microsoft discovers and mitigates evolving attacks against AI guardrails\n\n\n\n\nLearn more\n\n\n\nTo learn more about Microsoft\u2019s Responsible AI principles and approach, refer to https://www.microsoft.com/ai/principles-and-approach.\n\n\n\nFor the latest security research from the Microsoft Threat Intelligence community, check out the Microsoft Threat Intelligence Blog:&nbsp;https://aka.ms/threatintelblog.\n\n\n\nTo get notified about new publications and to join discussions on social media, follow us on LinkedIn at https://www.linkedin.com/showcase/microsoft-threat-intelligence, and on X (formerly Twitter) at&nbsp;https://twitter.com/MsftSecIntel.\n\n\n\nTo hear stories and insights from the Microsoft Threat Intelligence community about the ever-evolving threat landscape, listen to the Microsoft Threat Intelligence podcast: https://thecyberwire.com/podcasts/microsoft-threat-intelligence.\n\t\t\t", "mentioned_links": ["https://www.microsoft.com/en-us/security/blog/products/microsoft-defender/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-external-id", "https://education.microsoft.com/", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-endpoint-privilege-management", "https://www.microsoft.com/en-us/msrc/", "https://www.microsoft.com/en-us/trust-center", "https://learn.microsoft.com/azure/ai-studio/concepts/evaluation-approach-gen-ai#ai-assisted-risk-and-safety-metrics", "https://aka.ms/AIJailbreak", "https://learn.microsoft.com/azure/defender-for-cloud/defender-for-cloud-introduction", null, "https://azure.microsoft.com/en-us/products/key-vault/", "https://partner.microsoft.com/en-US/", "https://learn.microsoft.com/azure/ai-services/openai/concepts/abuse-monitoring", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/ai-threats/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-xdr", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-audit", "https://github.com/features/security", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-external-attack-surface-management", "https://www.microsoft.com/en-us/events", "https://azure.microsoft.com/en-us/products/ddos-protection/", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-compliance-manager", "https://www.microsoft.com/en-us/industry/consumer-goods", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-private-access", "https://www.microsoft.com/en-us/security/business/partnerships", "https://account.microsoft.com/", "https://blogs.microsoft.com/", "https://www.youtube.com/channel/UC4s3tv0Qq_OSUBfR735Jc6A", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-cloud-pki", "https://www.microsoft.com/en-us/security/business/get-started/contact-us", "https://www.microsoft.com/en-us/security/business/solutions/extended-detection-response-xdr", "https://www.microsoft.com/en-us/microsoft-viva", "https://www.microsoft.com/en-us/security/business/microsoft-purview", "https://www.microsoft.com/en-us/security/blog/2024/04/11/how-microsoft-discovers-and-mitigates-evolving-attacks-against-ai-guardrails/", "https://twitter.com/msftsecurity", "https://news.microsoft.com/", "https://servicetrust.microsoft.com/", "https://azure.microsoft.com/blog/announcing-new-tools-in-azure-ai-to-help-you-build-more-secure-and-trustworthy-generative-ai-applications/", "https://www.microsoft.com/en-us/security", "https://www.microsoft.com/en-us/security/business/microsoft-priva", "https://www.microsoft.com/en-us/security/blog/2024/05/06/new-capabilities-to-help-you-secure-your-ai-transformation/", "https://dynamics.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/blog/products/microsoft-defender-threat-intelligence/", "https://www.microsoft.com/en-us/microsoft-copilot", "https://aka.ms/yourcaliforniaprivacychoices", "https://www.microsoft.com/en-us/industry/government", "https://www.microsoft.com/en-us/security/blog/products/microsoft-defender-for-cloud/", "https://about.ads.microsoft.com/en-us?s_cid=dig-src_uhfcomm", "https://aka.ms/threatintelblog", "https://www.microsoft.com/en-us/industry", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-data-lifecycle-management", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-workload-id", "https://www.microsoft.com/en-us/security/business/security-101", "https://www.microsoft.com/en-us/d/Surface-Laptop-Studio-2/8rqr54krf1dz", "https://learn.microsoft.com/en-us/learn/topics/sci?wt.mc_id=techcom_header-webpage-m365", "https://www.microsoft.com/en-us/d/Surface-Laptop-Go-3/8p0wwgj6c6l2", "https://www.microsoft.com/en-us/security/security-insider/microsoft-digital-defense-report-2023", "https://support.microsoft.com/contactus", "https://www.youtube.com/watch?v=zFRn_RMSPI4", "https://learn.microsoft.com/", "https://www.microsoft.com/en-us/mixed-reality/windows-mixed-reality", "https://thecyberwire.com/podcasts/microsoft-threat-intelligence", "https://learn.microsoft.com/en-us/security/", "https://azure.microsoft.com/en-us/solutions/quantum-computing/", "https://www.microsoft.com/en-us/security/business/services", "https://www.microsoft.com/en-us/security/blog/content-type/research/", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-cloud-security-posture-management", "https://www.microsoft.com/en-us/power-platform", "https://twitter.com/MsftSecIntel", "https://www.microsoft.com/en-us/security/business/services/microsoft-defender-experts-xdr", "https://www.microsoft.com/en-us/security/business/solutions/generative-ai-cybersecurity", "https://www.microsoft.com/en-us/education/devices/overview", "https://www.microsoft.com/en-us/accessibility", "https://www.microsoft.com/en-us/security/business/microsoft-Intune", "https://go.microsoft.com/fwlink/?linkid=2196228", "https://techcommunity.microsoft.com/t5/ai-azure-ai-services-blog/announcing-safety-system-messages-in-azure-ai-studio-and-azure/ba-p/4146991", "https://www.microsoft.com/en-us/industry/manufacturing/microsoft-cloud-for-manufacturing", "https://techcommunity.microsoft.com/", "https://techcommunity.microsoft.com/t5/security-compliance-and-identity/ct-p/MicrosoftSecurityandCompliance", "https://www.microsoft.com/en-us/microsoft-products-and-apps", "https://www.microsoft.com/en-us/microsoft-365/business", "https://partner.microsoft.com/en-us/membership", "https://www.microsoft.com/en-us/security/blog/", "https://www.microsoft.com/en-us/store/b/certified-refurbished-products", "https://www.microsoft.com/en-us/store/b/business?icid=CNavBusinessStore", "https://about.ads.microsoft.com/en-us/partners/welcome?s_cid=en-us-gct-web-src_ext-sub_0-flx_uhfcombepartner", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-endpoint", "https://learn.microsoft.com/docs/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-verified-id", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-cloud-apps", "https://www.microsoft.com/en-us/microsoft-cloud", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-communication-compliance", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-ediscovery", "https://go.microsoft.com/fwlink/?LinkID=206977", "https://www.microsoft.com/en-us/security/business/solutions/privacy-risk-management", "https://www.microsoft.com", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-insider-risk-management", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-business", "https://www.microsoft.com/en-us/insidetrack", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-sentinel", "https://partner.microsoft.com/en-US/membership/cloud-solution-provider", "https://www.microsoft.com/en-us/security/blog/topic/ai-and-machine-learning/", "https://www.microsoft.com/en-us/education", "https://www.microsoft.com/en-us/security/business/zero-trust", "https://www.microsoft.com/en-us/security/blog/products/microsoft-copilot-for-security/", "https://azure.microsoft.com/en-us/free/students/", "https://www.microsoft.com/en-us/store/b/education", "https://go.microsoft.com/fwlink/?LinkId=521839", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-permissions-management ", "https://www.microsoft.com/en-us/security/business/reports-analysis/industry-recognized-cybersecurity-leader", "https://www.microsoft.com/en-us/download", "https://www.microsoft.com/en-us/security/blog/2024/06/04/ai-jailbreaks-what-they-are-and-how-they-can-be-mitigated/", "https://www.microsoft.com/en-us/windows-365", "https://www.microsoft.com/en-us/security/business/microsoft-incident-response", "https://www.facebook.com/sharer.php?u=https://www.microsoft.com/en-us/security/blog/2024/06/26/mitigating-skeleton-key-a-new-type-of-generative-ai-jailbreak-technique/", "https://techcommunity.microsoft.com/t5/microsoft-defender-for-cloud/secure-your-ai-applications-from-code-to-runtime-with-microsoft/ba-p/4127665", "https://www.microsoft.com/en-us/sitemap1.aspx", "https://www.microsoft.com/en-us/security/business/services/microsoft-defender-experts-hunting", "https://www.linkedin.com/showcase/microsoft-threat-intelligence", "https://www.microsoft.com/en-us/security/business/threat-protection/microsoft-defender-vulnerability-management ", "https://www.microsoft.com/en-us/sustainability/", "https://www.microsoft.com/en-us/surface/devices/surface-laptop-7th-edition", "https://www.microsoft.com/windows/windows-11-apps", "https://www.microsoft.com/en-us/education/products/teams", "https://azuremarketplace.microsoft.com/en-us/", "https://www.microsoft.com/investor/default.aspx", "https://www.microsoft.com/en-us/store/b/payment-financing-options?icid=footer_financing_vcc", "https://www.microsoft.com/security/blog/2024/04/11/how-microsoft-discovers-and-mitigates-evolving-attacks-against-ai-guardrails/#mitigating-the-risk-of-multiturn-threats-crescendo", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-threat-intelligence", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id-governance", "https://www.microsoft.com/en-us/diversity/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-internet-access", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-cloud", "https://www.microsoft.com/en-us/security/business/microsoft-defender", "https://www.microsoft.com/en-us/security/blog/2024/04/11/how-microsoft-discovers-and-mitigates-evolving-attacks-against-ai-guardrails/#mitigating-the-risk-of-multiturn-threats-crescendo", "https://www.linkedin.com/showcase/microsoft-security/", "https://events.microsoft.com/en-us/allevents/?language=English&clientTimeZone=1&search=security", "https://www.microsoft.com/en-us/security/business/services/microsoft-security-enterprise-services", "https://azure.microsoft.com/en-us/products/web-application-firewall/", "https://www.microsoft.com/en-us/security/blog/2024/02/14/staying-ahead-of-threat-actors-in-the-age-of-ai/", "https://azure.microsoft.com/en-us/products/microsoft-entra-ds", "https://azure.microsoft.com/en-us/services/azure-firewall/", "https://www.microsoft.com/en-us/store/b/why-microsoft-store?icid=footer_why-msft-store_7102020", "https://go.microsoft.com/fwlink/?linkid=2196227", "javascript:void(0)", "https://learn.microsoft.com/en-us/security", "#", "https://www.microsoft.com/en-us/sitemap.aspx", "https://www.microsoft.com/en-us/security/business/ai-machine-learning/microsoft-copilot-security", "https://www.microsoft.com/en-us/industry/financial-services/banking", "https://www.microsoft.com/en-us/about", "https://www.microsoft.com/en-us/store/b/returns", "https://www.microsoft.com/en-us/security/locale", "https://twitter.com/intent/tweet?url=https://www.microsoft.com/en-us/security/blog/2024/06/26/mitigating-skeleton-key-a-new-type-of-generative-ai-jailbreak-technique/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-security-exposure-management", "https://www.microsoft.com/en-us/industry/health/microsoft-cloud-for-healthcare", "https://www.microsoft.com/en-us/security/business/cybersecurity-awareness", "https://www.microsoft.com/en-us/microsoft-teams/group-chat-software", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune", "https://www.microsoft.com/security/blog/2024/02/22/announcing-microsofts-open-automation-framework-to-red-team-generative-ai-systems/", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-data-loss-prevention", "https://www.microsoft.com/en-us/security/business/solutions/data-security", "https://privacy.microsoft.com/en-us", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-advanced-analytics", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-remote-help", "https://www.microsoft.com/en-us/hololens", "https://customers.microsoft.com/en-us/search?sq=Microsoft%20Security&ff=&p=0&so=story_publish_date%20desc", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id-protection ", "https://developer.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-office-365", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-enterprise-application-management", "https://www.microsoft.com/ai/principles-and-approach", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-for-identity", "https://www.microsoft.com/en-us/research/", "https://www.microsoft.com/en-us/industry/automotive", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/threat-actors/", "https://www.microsoft.com/en-us/dynamics-365", "https://careers.microsoft.com/", "https://www.microsoft.com/en-us/security/business/services/compliance-program-microsoft-cloud", "https://www.microsoft.com/en-us/security/business/get-started/start-free-trial", "https://www.microsoft.com/en-us/security/business/solutions/cloud-workload-protection", "https://www.microsoft.com/en-us/legal/compliance/recycling", "https://learn.microsoft.com/purview/purview", "https://www.microsoft.com/en-us/security?wt.mc_id=AID730391_QSG_BLOG_319247&ocid=AID730391_QSG_BLOG_319247", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-iot", "https://www.microsoft.com/en-us/surface/devices/surface-pro-11th-edition", "https://www.microsoft.com/en-us/windows/copilot-ai-features", "https://account.microsoft.com/orders", "https://www.microsoft.com/en-us/ai", "https://www.microsoft.com/en-us/education/buy-license/microsoft365", "https://www.linkedin.com/shareArticle?mini=true&url=https://www.microsoft.com/en-us/security/blog/2024/06/26/mitigating-skeleton-key-a-new-type-of-generative-ai-jailbreak-technique/", "https://go.microsoft.com/fwlink/?linkid=2259814", "https://www.microsoft.com/en-us/securityengineering", "https://build.microsoft.com/sessions/d29a16d5-f9ea-4f5b-9adf-fae0bd688ff3?source=sessions", "https://www.microsoft.com/en-us/security/business/solutions/identity-access", "https://www.microsoft.com/en-us/microsoft-365/business/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id", "https://www.microsoft.com/en-us/licensing/", "https://arxiv.org/pdf/2402.09283", "https://techcommunity.microsoft.com/t5/microsoft-defender-for-cloud/securing-cloud-native-applications-in-the-age-of-ai-defender-for/ba-p/4129523", "https://choice.microsoft.com", "https://www.microsoft.com/en-us/security/security-insider/", "https://www.microsoft.com/en-us/security/business/solutions/ai-powered-unified-secops-platform", "https://azure.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-information-protection", "https://www.microsoft.com/en-us/security/blog/topic/threat-intelligence/", "https://www.microsoft.com/en-us/security/business/solutions/cloud-security", "https://www.microsoft.com/en-us/microsoft-365/business/copilot-for-microsoft-365", "https://www.microsoft.com/en-us/security/blog/products/microsoft-purview/", "https://about.ads.microsoft.com/en-us/resources/microsoft-advertising-partner-program/microsoft-advertising-partner-program", "https://www.microsoft.com/en-us/security/blog/author/mark-russinovich/", "https://azure.microsoft.com/en-us/solutions/space/", "https://visualstudio.microsoft.com/", "https://www.microsoft.com/en-us/security/business/privacy/microsoft-priva-risk-management", "https://www.microsoft.com/en-us/security/business/privacy/microsoft-priva-subject-rights-requests", "https://www.microsoft.com/en-us/security/blog/content-type/news/", "https://appsource.microsoft.com/en-us/", "https://go.microsoft.com/fwlink/?linkid=2139749", "https://www.microsoft.com/education/how-to-buy", "https://www.microsoft.com/en-us/security/business/microsoft-entra", "https://www.microsoft.com/en-us/microsoft-cloud/resources/secure-future-initiative"]}, {"URL": "https://www.microsoft.com/en-us/security/blog/2024/05/30/exposed-and-vulnerable-recent-attacks-highlight-critical-need-to-protect-internet-exposed-ot-devices/", "author": "Microsoft Threat Intelligence", "content": "\n\t\t\t\t\n\t\t\t\t\nSince late 2023, Microsoft has observed an increase in reports of attacks focusing on internet-exposed, poorly secured operational technology (OT) devices. Internet-exposed OT equipment in water and wastewater systems (WWS) in the US were targeted in multiple attacks over the past months by different nation-backed actors, including attacks by IRGC-affiliated \u201cCyberAv3ngers\u201d in November 2023, as well as pro-Russian hacktivists in early 2024. These repeated attacks against OT devices emphasize the crucial need to improve the security posture of OT devices and prevent critical systems from becoming easy targets.\n\n\n\nOT systems, which control real-world critical processes, present a significant target for cyberattacks. These systems are prevalent across various industries, from building heating, ventilation, and air conditioning (HVAC) systems, to water supply and power plants, providing control over vital parameters such as speed and temperature in industrial processes. A cyberattack on an OT system could transfer control over these critical parameters to attackers and enable malicious alteration that could result in malfunctions or even complete system outages, either programmatically via the programmable logic controller (PLC) or using the graphical controls of the human machine interface (HMI).\n\n\n\nAdding to the potential damage of attacks on OT systems are their often-lacking security measures, which make OT attacks not only attractive for attackers but also relatively easy to execute. Many OT devices, notwithstanding common security guidelines, are directly connected to the internet, making them discoverable by attackers through internet scanning tools. Once discovered by attackers, poor security configurations, such as weak sign-in passwords or outdated software with known vulnerabilities, could be further exploited to obtain access to the devices.\n\n\n\nThe attractiveness of OT systems and attackers\u2019 capabilities against systems with weak configurations were demonstrated in the Israel-Hamas war, which was accompanied by a spike in cyberattacks, including from OT-focused actors. Shortly after October 7, the Telegram channels of several such actors broadcasted their attacks against OT systems associated with Israeli companies. These publications were often accompanied by images of purportedly compromised systems, which the threat actors presented as alleged evidence for the attacks.\n\n\n\nMicrosoft\u2019s analysis of multiple attacks by these actors revealed a common attack methodology: focusing on internet-exposed, poorly secured OT devices. This report will illustrate this attack methodology using the high-profile case of the November 2023 attack against Aliquippa water plant, for which CISA released an advisory in December 2023. CISA attributed the attack to the Islamic Revolutionary Guard Corps (IRGC)-affiliated actor \u201cCyberAv3ngers\u201d, tracked by Microsoft as Storm-0784. Microsoft assesses that the same methodology has been utilized by other OT-focused threat actors in multiple other attacks as well.\n\n\n\nFigure 1. Sample images of victim systems as posted by actors on their Telegram channels\n\n\n\nThe attacks conducted by OT-focused actors were not limited to public sector facilities but also affected private companies in various countries. While the public sector has been implored to implement proper risk management and protection of OT systems, the diversity of target profiles illustrates that ensuring OT security in the private sector is equally crucial. Recommendations for organizations to protect against similar attacks and improve the security posture of their OT systems can be found at the end of this report.\n\n\n\nSpike in activity of OT threat actors\n\n\n\nShortly after the outbreak of the Israel-Hamas war, Microsoft has seen a rise in reports of attacker activity against OT systems with Israeli affiliation. This included activity by existing groups such as the IRGC-affiliated \u201cCyberAv3ngers\u201d, and the emergence of new groups such as the \u201cCyberAv3ngers\u201d-associated \u201cSoldiers of Solomon\u201d, and \u201cAbnaa Al-Saada\u201d, a cyber persona presenting itself as Yemeni. Microsoft tracks both \u201cCyberAv3ngers\u201d and its associated group \u201cSoldiers of Solomon\u201d as Storm-0784.\n\n\n\nThe systems targeted by these groups included both OT equipment deployed across different sectors in Israel, including PLCs and HMIs manufactured by large international vendors, as well as Israeli-sourced OT equipment deployed in other countries. The attacks were made public by the actors using their Telegram channels, on which they also posted images of the target systems to enhance purported credibility and present evidence for the attack.\n\n\n\nResearching the threat actors in question, Microsoft has identified a typical target profile that attackers appeared to focus on: internet-exposed OT systems with poor security posture, potentially accompanied by weak passwords and known vulnerabilities.\n\n\n\nThe Aliquippa case: A high-profile OT attack\n\n\n\nIn late November 2023, the Aliquippa water plant was affected by a cyberattack that resulted in the outage of a pressure regulation pump on the municipal water supply line in Aliquippa, Pennsylvania. In addition to impairing functionality, the attack, which targeted a PLC-HMI system by Israeli manufacturer Unitronics, also defaced the device to display a red screen with the name and logo of the \u201cCyberAv3ngers\u201d actor. The US Department of Treasury sanctioned officials in the Iranian Islamic Revolutionary Guard Corps Cyber-Electronic Command (IRGC-CEC) in relation to the attack.\n\n\n\nAround the same time, multiple other attack cases on Unitronics systems were reported across the industry in other parts of the world, with targeted equipment displaying the same message: \u201cEvery equipment \u2018made in Israel\u2019 is a Cyber Av3ngers legal target\u201c.\n\n\nFigure 2. A photo of the Aliquippa Unitronics PLC released to media by the Municipal Water Authority of Aliquippa. The top right corner displays the Cyber Av3ngers\u2019 group logo. The bottom left corner discloses model number V570 (source: THE TIMES OF ISRAEL)\n\n\n\nMicrosoft analyzed the publicly available data on the Aliquippa incident to find the victim system and assess how it was compromised. Leveraging researchers\u2019 intimate OT knowledge to interpret the limited details known to the public has enabled the identification of a specific machine that Microsoft believes to be the victim.\n\n\n\nAccording to publicly accessible sources, the targeted system was exposed to the internet, and it suffered both defacement and the shutdown of the pump it controlled. Designated engines that map internet-connected devices and their associated services allowed Microsoft researchers to compile a list of internet-exposed Unitronics devices of the relevant model, which also had a dedicated control port open. This configuration could potentially allow to reprogram the device reprogramming, leading to the observed defacement and shutdown.\n\n\n\nThe analysis of contextual data narrowed the device profile list, identifying a specific system that could be the victim. This system was geographically situated near the Aliquippa station, with its PLC Name field set to \u201cRaccoon Primary PLC\u201d, consistent with the Aliquippa water station serving Potter and Raccoon townships, and also aligning with a photograph disseminated by the media, depicting a sign that reads \u201cPRIMARY PLC\u201d on the targeted system.\n\n\n\nThe data gathered throughout the research of the Aliquippa attack case highlights a trend: a common target profile of internet-exposed OT systems with a weak security posture that mirrors other attack cases.\n\n\n\nAttacks representing a broader concerning trend\n\n\n\nThe CISA advisory that was released following the attacks in November 2023 described the profile of the targeted OT systems as being internet-exposed and having weak sign-in configurations. In May 2024, CISA released another advisory following the more recent attacks against the water sector, which showed that the victims had a similar profile. Again, OT systems that were left internet-exposed and had weak passwords were targeted by nation-state attackers, this time by pro-Russia activists.\n\n\n\nWhile attacks on high-profile targets, especially in the public sector, often receive significant media attention, it\u2019s important to recognize that the private sector and individual users may also be impacted. Notably, the Aliquippa water plant was just one victim in a series of attacks on Unitronics by \u201cCyberAv3ngers\u201d, which also expanded to the private sector. Screenshots of affected systems with the same red screen and message have been posted by users on the Unitronics forum claiming their equipment was attacked, with similar reports also showing on social media platform X. Following the incidents, a vulnerability was assigned for the Unitronics default password configuration (CVE-2023-6448), and a patch was issued by Unitronics to require users to fix the issue. &nbsp;\n\n\n\nThe common target profile for the attack cases analyzed reflects what attackers do to pick an easily accessible and appealing target in the first place. Attackers can, and do, obtain visibility on OT devices that are open to the internet using search engines, identify vulnerable models and open communication ports, and then use the contextual metadata to identify devices that are of special interest, such as ICS systems in water plants or other critical facilities. At that point, a weak password or an outdated system with an exploitable vulnerability is all that stands between them and remote access to the system.\n\n\n\nThe growing attention from attackers towards OT systems, observed across various sectors, is particularly concerning due to inadequate security practices on these systems. The Microsoft Digital Defense Report 2023 highlights that 78% of industrial network devices on customer networks monitored by Microsoft Defender for IoT have known vulnerabilities. Among these, 46% utilize deprecated firmware, for which patches are no longer available, while the remaining 32% operate outdated systems with unpatched vulnerabilities. For devices that are patched, many still use default passwords or have no passwords at all. Microsoft collects statistics on the prevalence of username and password pairs seen used in Microsoft\u2019s sensor network, as was shared in the Microsoft Digital Defense Report 2022. Such outdated and vulnerable systems present attractive targets for future attacks, particularly when coupled with internet connectivity and default passwords. In the next sections, we share recommendations for improving the security posture of OT systems to help prevent attacks.\n\n\nFigure 3. Statistics of vulnerable devices in customer industrial network. Source: Microsoft Digital Defense Report October 2023\n\n\n\nMitigation and protection guidance\n\n\n\nThe analysis of the attack claims in question reveals diverse target profiles. It is therefore vital for organizations of all different sectors to ensure security hygiene for their OT systems to prevent similar threats.\n\n\n\n\nAdopt a comprehensive IoT and OT security solution such as Microsoft Defender for IoT to allow visibility and monitoring of all IoT and OT devices, threat detection and response, and integration with SIEM/SOAR and XDR platforms such as Microsoft Sentinel and Microsoft Defender XDR.\n\n\n\nEnable vulnerability assessments to identify unpatched devices in the organizational network and set workflows for initiating appropriate patch processes through&nbsp; Microsoft Defender Vulnerability Management and Microsoft Defender for Endpoint with the Microsoft Defender for IoT add-on.\n\n\n\nReduce the attack surface by eliminating unnecessary internet connections to IoT devices and OT control systems. Verify that no OT system is directly connected to the internet, for example, through IoT routers or Cellular bridged (LTE or 3G). Close unnecessary open ports and services on their equipment, eliminating remote access entirely when possible, and restricting access behind a firewall or VPN when full elimination cannot be achieved.\n\n\n\nImplement Zero Trust practices by applying network segmentation to prevent an attacker from moving laterally and compromising assets after intrusion. OT devices and networks should be isolated from IT with firewalls. Extend vulnerability and exposure control beyond the firewall with Microsoft Defender External Attack Surface Management. Turn on attack surface reduction rules in Microsoft Defender for Endpoint to prevent common attack techniques such as those used by ransomware groups.\n\n\n\n\nMicrosoft Defender for IoT detections\n\n\n\nMicrosoft Defender for IoT provides detections for suspicious behaviors of OT and IoT devices. Alerts related to internet access and modification of PLC behavior will detect activity of this type, such as:\n\n\n\n\nExternal address within the network communicated with Internet\n\n\n\nInternet Access Detected\n\n\n\nUnauthorized Internet Connectivity Detected\n\n\n\nUnauthorized PLC Program Upload\n\n\n\nUnauthorized PLC Programming\n\n\n\n\nReferences\n\n\n\n\nIRGC-Affiliated Cyber Actors Exploit PLCs in Multiple Sectors, Including U.S. Water and Wastewater Systems Facilities | CISA\n\n\n\nMunicipal Water Authority of Aliquippa hacked by Iranian-backed cyber group \u2013 CBS Pittsburgh (cbsnews.com)\n\n\n\nAliquippa Water Authority \u2013 Municipal Water Authority of Aliquippa\n\n\n\nCyber group backed by Iran is taking credit for Pennsylvania water system cyberattack\n\n\n\nPLC Hacking \u2013 More Commonplace Than You Might Think \u2013 Best Programming Practices \u2013 Unitronics Support Forum: Programmable Controllers (PLC + HMI All-in-One)\n\n\n\nFull Pint Beer on X: \u201cUgh \u2013 the brewery control system received a CYBER ATTACK over the weekend!!! We are working to restore things to working order, kudos to the crew at @Brewmation for working with us over the Thanksgiving weekend! Thank goodness for backups! #cyberattack #automation #ransomware https://t.co/SNdXY9ne4h\u201d / X\n\n\n\nNVD \u2013 CVE-2023-6448 (nist.gov)\n\n\n\nUnitronics-Cybersecurity-Advisory-2023-001-CVE-2023-6448.pdf (unitronicsplc.com)\n\n\n\nIranian cyber attack targets Israeli tech used by several US bodies | The Times of Israel\n\n\n\n\nLearn more\n\n\n\nFor the latest security research from the Microsoft Threat Intelligence community, check out the Microsoft Threat Intelligence Blog:&nbsp;https://aka.ms/threatintelblog.\n\n\n\nTo get notified about new publications and to join discussions on social media, follow us on LinkedIn at https://www.linkedin.com/showcase/microsoft-threat-intelligence, and on X (formerly Twitter) at&nbsp;https://twitter.com/MsftSecIntel.\n\n\n\nTo hear stories and insights from the Microsoft Threat Intelligence community about the ever-evolving threat landscape, listen to the Microsoft Threat Intelligence podcast: https://thecyberwire.com/podcasts/microsoft-threat-intelligence.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\t\t\t", "mentioned_links": ["https://www.microsoft.com/en-us/security/blog/products/microsoft-defender/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-external-id", "https://education.microsoft.com/", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-endpoint-privilege-management", "https://www.microsoft.com/en-us/msrc/", "https://www.microsoft.com/en-us/trust-center", "https://azure.microsoft.com/en-us/products/key-vault/", "https://partner.microsoft.com/en-US/", "https://www.microsoft.com/security/business/endpoint-security/microsoft-defender-endpoint", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-xdr", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-audit", "https://www.microsoft.com/en-us/security/blog/2023/03/20/leverage-cloud-powered-security-with-microsoft-defender-for-iot/", "https://github.com/features/security", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-external-attack-surface-management", "https://www.microsoft.com/en-us/events", "https://azure.microsoft.com/en-us/products/ddos-protection/", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-compliance-manager", "https://www.microsoft.com/en-us/industry/consumer-goods", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-private-access", "https://www.microsoft.com/en-us/security/business/partnerships", "https://account.microsoft.com/", "https://blogs.microsoft.com/", "https://www.youtube.com/channel/UC4s3tv0Qq_OSUBfR735Jc6A", "https://www.microsoft.com/security/security-insider/microsoft-digital-defense-report-2023", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-cloud-pki", "https://www.microsoft.com/en-us/security/business/get-started/contact-us", "https://www.microsoft.com/en-us/security/business/solutions/extended-detection-response-xdr", "https://www.microsoft.com/en-us/microsoft-viva", "https://www.microsoft.com/en-us/security/business/microsoft-purview", "https://twitter.com/msftsecurity", "https://news.microsoft.com/", "https://servicetrust.microsoft.com/", "https://www.microsoft.com/en-us/security", "https://www.microsoft.com/en-us/security/business/microsoft-priva", "https://learn.microsoft.com/microsoft-365/security/defender-endpoint/attack-surface-reduction?view=o365-worldwide", "https://dynamics.microsoft.com/en-us/", "https://www.microsoft.com/en-us/microsoft-copilot", "https://aka.ms/yourcaliforniaprivacychoices", "https://www.microsoft.com/en-us/industry/government", "https://learn.microsoft.com/microsoft-365/security/defender-endpoint/enable-microsoft-defender-for-iot-integration", "https://www.cbsnews.com/pittsburgh/news/municipal-water-authority-of-aliquippa-hacked-iranian-backed-cyber-group/", "https://about.ads.microsoft.com/en-us?s_cid=dig-src_uhfcomm", "https://aka.ms/threatintelblog", "https://www.microsoft.com/en-us/industry", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-data-lifecycle-management", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-workload-id", "https://www.microsoft.com/en-us/security/business/security-101", "https://www.microsoft.com/en-us/d/Surface-Laptop-Studio-2/8rqr54krf1dz", "https://learn.microsoft.com/en-us/learn/topics/sci?wt.mc_id=techcom_header-webpage-m365", "https://downloads.unitronicsplc.com/Sites/plc/Technical_Library/Unitronics-Cybersecurity-Advisory-2023-001-CVE-2023-6448.pdf", "https://www.youtube.com/watch?v=IXBtaBcOc_Y", "https://www.microsoft.com/en-us/d/Surface-Laptop-Go-3/8p0wwgj6c6l2", "https://www.microsoft.com/en-us/security/security-insider/microsoft-digital-defense-report-2023", "https://support.microsoft.com/contactus", "https://learn.microsoft.com/", "https://www.microsoft.com/en-us/mixed-reality/windows-mixed-reality", "https://thecyberwire.com/podcasts/microsoft-threat-intelligence", "https://learn.microsoft.com/en-us/security/", "https://azure.microsoft.com/en-us/solutions/quantum-computing/", "https://www.microsoft.com/en-us/security/business/services", "https://www.microsoft.com/security/business/zero-trust/", "https://www.microsoft.com/en-us/security/blog/content-type/research/", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-cloud-security-posture-management", "https://www.microsoft.com/en-us/power-platform", "https://learn.microsoft.com/azure/external-attack-surface-management/", "https://twitter.com/MsftSecIntel", "https://www.microsoft.com/en-us/security/business/services/microsoft-defender-experts-xdr", "https://www.microsoft.com/en-us/security/business/solutions/generative-ai-cybersecurity", "https://www.cisa.gov/sites/default/files/2024-05/defending-ot-operations-against-ongoing-pro-russia-hacktivist-activity-508c.pdf", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/supply-chain-attacks/", "https://www.microsoft.com/en-us/security/business/microsoft-Intune", "https://www.microsoft.com/en-us/education/devices/overview", "https://www.microsoft.com/en-us/accessibility", "https://go.microsoft.com/fwlink/?linkid=2196228", "https://www.microsoft.com/en-us/industry/manufacturing/microsoft-cloud-for-manufacturing", "https://techcommunity.microsoft.com/", "https://techcommunity.microsoft.com/t5/security-compliance-and-identity/ct-p/MicrosoftSecurityandCompliance", "https://www.microsoft.com/en-us/microsoft-products-and-apps", "https://www.linkedin.com/shareArticle?mini=true&url=https://www.microsoft.com/en-us/security/blog/2024/05/30/exposed-and-vulnerable-recent-attacks-highlight-critical-need-to-protect-internet-exposed-ot-devices/", "https://www.microsoft.com/en-us/microsoft-365/business", "https://partner.microsoft.com/en-us/membership", "https://www.microsoft.com/en-us/security/blog/", "https://www.microsoft.com/en-us/store/b/certified-refurbished-products", "https://www.microsoft.com/en-us/store/b/business?icid=CNavBusinessStore", "https://about.ads.microsoft.com/en-us/partners/welcome?s_cid=en-us-gct-web-src_ext-sub_0-flx_uhfcombepartner", "https://forum.unitronics.com/topic/9904-plc-hacking-more-commonplace-than-you-might-think/", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-endpoint", "https://learn.microsoft.com/docs/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-verified-id", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-cloud-apps", "https://www.microsoft.com/en-us/microsoft-cloud", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-communication-compliance", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-ediscovery", "https://go.microsoft.com/fwlink/?LinkID=206977", "https://www.microsoft.com/en-us/security/business/solutions/privacy-risk-management", "https://www.microsoft.com", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-insider-risk-management", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-business", "https://www.microsoft.com/en-us/insidetrack", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-sentinel", "https://partner.microsoft.com/en-US/membership/cloud-solution-provider", "https://www.microsoft.com/en-us/education", "https://www.microsoft.com/en-us/security/blog/2022/11/22/vulnerable-sdk-components-lead-to-supply-chain-risks-in-iot-and-ot-environments/", "https://www.microsoft.com/en-us/security/business/zero-trust", "https://azure.microsoft.com/en-us/free/students/", "https://www.microsoft.com/en-us/store/b/education", "https://go.microsoft.com/fwlink/?LinkId=521839", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-permissions-management ", "https://www.microsoft.com/en-us/security/business/reports-analysis/industry-recognized-cybersecurity-leader", "https://www.microsoft.com/en-us/download", "https://www.microsoft.com/en-us/sitemap1.aspx", "https://www.microsoft.com/en-us/windows-365", "https://www.microsoft.com/en-us/security/business/microsoft-incident-response", "https://www.microsoft.com/en-us/security/business/services/microsoft-defender-experts-hunting", "https://www.microsoft.com/security/business/endpoint-security/microsoft-defender-iot", "https://www.microsoft.com/en-us/security/business/threat-protection/microsoft-defender-vulnerability-management ", "https://www.microsoft.com/en-us/sustainability/", "https://www.linkedin.com/showcase/microsoft-threat-intelligence", "https://www.microsoft.com/en-us/surface/devices/surface-laptop-7th-edition", "https://www.microsoft.com/windows/windows-11-apps", "https://www.microsoft.com/en-us/education/products/teams", "https://aliquippawater.com/", "https://twitter.com/fullpintbeerpgh/status/1729568323455594998", "https://azuremarketplace.microsoft.com/en-us/", "https://www.microsoft.com/investor/default.aspx", "https://nvd.nist.gov/vuln/detail/CVE-2023-6448", "https://www.microsoft.com/en-us/store/b/payment-financing-options?icid=footer_financing_vcc", "https://www.microsoft.com/en-us/diversity/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-threat-intelligence", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id-governance", "https://www.microsoft.com/security/business/microsoft-digital-defense-report-2022", "https://home.treasury.gov/news/press-releases/jy2072", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-internet-access", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-cloud", "https://www.microsoft.com/en-us/security/business/microsoft-defender", "https://www.linkedin.com/showcase/microsoft-security/", "https://events.microsoft.com/en-us/allevents/?language=English&clientTimeZone=1&search=security", "https://www.microsoft.com/en-us/security/blog/2023/06/22/iot-devices-and-linux-based-systems-targeted-by-openssh-trojan-campaign/", "https://www.microsoft.com/en-us/security/business/services/microsoft-security-enterprise-services", "https://x.com/fullpintbeerpgh/status/1729568323455594998", "https://www.facebook.com/sharer.php?u=https://www.microsoft.com/en-us/security/blog/2024/05/30/exposed-and-vulnerable-recent-attacks-highlight-critical-need-to-protect-internet-exposed-ot-devices/", "https://azure.microsoft.com/en-us/products/web-application-firewall/", "https://azure.microsoft.com/en-us/products/microsoft-entra-ds", "https://azure.microsoft.com/en-us/services/azure-firewall/", "https://www.microsoft.com/en-us/store/b/why-microsoft-store?icid=footer_why-msft-store_7102020", "https://go.microsoft.com/fwlink/?linkid=2196227", "javascript:void(0)", "https://learn.microsoft.com/en-us/security", "#", "https://www.microsoft.com/en-us/sitemap.aspx", "https://learn.microsoft.com/microsoft-365/security/defender-vulnerability-management/defender-vulnerability-management", "https://www.microsoft.com/en-us/security/blog/products/microsoft-defender-for-iot/", "https://www.microsoft.com/en-us/security/business/ai-machine-learning/microsoft-copilot-security", "https://www.microsoft.com/en-us/industry/financial-services/banking", "https://www.microsoft.com/en-us/about", "https://www.microsoft.com/en-us/store/b/returns", "https://www.microsoft.com/en-us/security/locale", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-security-exposure-management", "https://www.microsoft.com/en-us/security/blog/topic/data-protection/", "https://www.microsoft.com/en-us/industry/health/microsoft-cloud-for-healthcare", "https://www.microsoft.com/en-us/security/business/cybersecurity-awareness", "https://www.microsoft.com/en-us/microsoft-teams/group-chat-software", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-data-loss-prevention", "https://www.microsoft.com/en-us/security/business/solutions/data-security", "https://blogs.microsoft.com/on-the-issues/2024/02/06/iran-accelerates-cyber-ops-against-israel/", "https://privacy.microsoft.com/en-us", "https://twitter.com/intent/tweet?url=https://www.microsoft.com/en-us/security/blog/2024/05/30/exposed-and-vulnerable-recent-attacks-highlight-critical-need-to-protect-internet-exposed-ot-devices/", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-advanced-analytics", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-remote-help", "https://www.microsoft.com/en-us/hololens", "https://customers.microsoft.com/en-us/search?sq=Microsoft%20Security&ff=&p=0&so=story_publish_date%20desc", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id-protection ", "https://developer.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-office-365", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-enterprise-application-management", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-for-identity", "https://www.microsoft.com/en-us/research/", "https://www.microsoft.com/en-us/industry/automotive", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/threat-actors/", "https://www.microsoft.com/en-us/dynamics-365", "https://careers.microsoft.com/", "https://www.microsoft.com/en-us/security/business/services/compliance-program-microsoft-cloud", "https://www.microsoft.com/en-us/security/business/get-started/start-free-trial", "https://www.microsoft.com/en-us/security/business/solutions/cloud-workload-protection", "https://www.microsoft.com/en-us/legal/compliance/recycling", "https://www.microsoft.com/en-us/security?wt.mc_id=AID730391_QSG_BLOG_319247&ocid=AID730391_QSG_BLOG_319247", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-iot", "https://www.microsoft.com/en-us/security/blog/author/microsoft-security-threat-intelligence/", "https://www.microsoft.com/en-us/surface/devices/surface-pro-11th-edition", "https://www.microsoft.com/en-us/windows/copilot-ai-features", "https://account.microsoft.com/orders", "https://www.microsoft.com/en-us/ai", "https://www.microsoft.com/en-us/education/buy-license/microsoft365", "https://go.microsoft.com/fwlink/?linkid=2259814", "https://www.microsoft.com/en-us/securityengineering", "https://www.microsoft.com/en-us/security/business/solutions/identity-access", "https://www.microsoft.com/en-us/microsoft-365/business/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id", "https://www.microsoft.com/en-us/licensing/", "https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-335a", "https://choice.microsoft.com", "https://www.microsoft.com/en-us/security/security-insider/", "https://www.microsoft.com/en-us/security/business/solutions/ai-powered-unified-secops-platform", "https://azure.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-information-protection", "https://www.microsoft.com/en-us/security/blog/topic/threat-intelligence/", "https://www.microsoft.com/en-us/security/business/solutions/cloud-security", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/iot-ot-threats/", "https://www.microsoft.com/en-us/microsoft-365/business/copilot-for-microsoft-365", "https://www.timesofisrael.com/iranian-cyber-attack-targets-israeli-tech-used-by-several-us-bodies/", "https://about.ads.microsoft.com/en-us/resources/microsoft-advertising-partner-program/microsoft-advertising-partner-program", "https://azure.microsoft.com/en-us/solutions/space/", "https://www.microsoft.com/en-us/security/blog/2022/10/21/securing-iot-devices-against-attacks-that-target-critical-infrastructure/", "https://visualstudio.microsoft.com/", "https://www.microsoft.com/en-us/security/business/privacy/microsoft-priva-risk-management", "https://www.microsoft.com/en-us/security/business/privacy/microsoft-priva-subject-rights-requests", "https://www.microsoft.com/en-us/security/blog/content-type/news/", "https://appsource.microsoft.com/en-us/", "https://go.microsoft.com/fwlink/?linkid=2139749", "https://www.microsoft.com/education/how-to-buy", "https://www.microsoft.com/en-us/security/blog/topic/iot-security/", "https://www.microsoft.com/en-us/security/business/microsoft-entra", "https://www.microsoft.com/en-us/microsoft-cloud/resources/secure-future-initiative"]}, {"URL": "https://www.microsoft.com/en-us/security/blog/2024/06/04/ai-jailbreaks-what-they-are-and-how-they-can-be-mitigated/", "author": "Microsoft Threat Intelligence", "content": "\n\t\t\t\t\n\t\t\t\t\nGenerative AI systems are made up of multiple components that interact to provide a rich user experience between the human and the AI model(s). As part of a responsible AI approach, AI models are protected by layers of defense mechanisms to prevent the production of harmful content or being used to carry out instructions that go against the intended purpose of the AI integrated application. This blog will provide an understanding of what AI jailbreaks are, why generative AI is susceptible to them, and how you can mitigate the risks and harms.\n\n\n\nWhat is AI jailbreak?\n\n\n\nAn AI jailbreak is a technique that can cause the failure of guardrails (mitigations). The resulting harm comes from whatever guardrail was circumvented: for example, causing the system to violate its operators\u2019 policies, make decisions unduly influenced by one user, or execute malicious instructions. This technique may be associated with additional attack techniques such as prompt injection, evasion, and model manipulation. You can learn more about AI jailbreak techniques in our AI red team\u2019s Microsoft Build session, How Microsoft Approaches AI Red Teaming.\n\n\nFigure 1. AI safety finding ontology&nbsp;\n\n\n\nHere is an example of an attempt to ask an AI assistant to provide information about how to build a Molotov cocktail (firebomb). We know this knowledge is built into most of the generative AI models available today, but is prevented from being provided to the user through filters and other techniques to deny this request. Using a technique like Crescendo, however, the AI assistant can produce the harmful content that should otherwise have been avoided. This particular problem has since been addressed in Microsoft\u2019s safety filters; however, AI models are still susceptible to it. Many variations of these attempts are discovered on a regular basis, then tested and mitigated.\n\n\n\nFigure 2. Crescendo attack to build a Molotov cocktail&nbsp;\n\n\n\nWhy is generative AI susceptible to this issue?\n\n\n\nWhen integrating AI into your applications, consider the characteristics of AI and how they might impact the results and decisions made by this technology. Without anthropomorphizing AI, the interactions are very similar to the issues you might find when dealing with people. You can consider the attributes of an AI language model to be similar to an eager but inexperienced employee trying to help your other employees with their productivity:\n\n\n\n\nOver-confident: They may confidently present ideas or solutions that sound impressive but are not grounded in reality, like an overenthusiastic rookie who hasn\u2019t learned to distinguish between fiction and fact.\n\n\n\nGullible: They can be easily influenced by how tasks are assigned or how questions are asked, much like a na\u00efve employee who takes instructions too literally or is swayed by the suggestions of others.\n\n\n\nWants to impress: While they generally follow company policies, they can be persuaded to bend the rules or bypass safeguards when pressured or manipulated, like an employee who may cut corners when tempted.\n\n\n\nLack of real-world application: Despite their extensive knowledge, they may struggle to apply it effectively in real-world situations, like a new hire who has studied the theory but may lack practical experience and common sense.\n\n\n\n\nIn essence, AI language models can be likened to employees who are enthusiastic and knowledgeable but lack the judgment, context understanding, and adherence to boundaries that come with experience and maturity in a business setting.\n\n\n\nSo we can say that generative AI models and system have the following characteristics:\n\n\n\n\nImaginative but sometimes unreliable\n\n\n\nSuggestible and literal-minded, without appropriate guidance\n\n\n\nPersuadable and potentially exploitable\n\n\n\nKnowledgeable yet impractical for some scenarios\n\n\n\n\nWithout the proper protections in place, these systems can not only produce harmful content, but could also carry out unwanted actions and leak sensitive information.\n\n\n\nDue to the nature of working with human language, generative capabilities, and the data used in training the models, AI models are non-deterministic, i.e., the same input will not always produce the same outputs. These results can be improved in the training phases, as we saw with the results of increased resilience in Phi-3 based on direct feedback from our AI Red Team. As all generative AI systems are subject to these issues, Microsoft recommends taking a zero-trust approach towards the implementation of AI; assume that any generative AI model could be susceptible to jailbreaking and limit the potential damage that can be done if it is achieved. This requires a layered approach to mitigate, detect, and respond to jailbreaks. Learn more about our AI Red Team approach.\n\n\nFigure 3. Anatomy of an AI application\n\n\n\nWhat is the scope of the problem?\n\n\n\nWhen an AI jailbreak occurs, the severity of the impact is determined by the guardrail that it circumvented. Your response to the issue will depend on the specific situation and if the jailbreak can lead to unauthorized access to content or trigger automated actions. For example, if the harmful content is generated and presented back to a single user, this is an isolated incident that, while harmful, is limited. However, if the jailbreak could result in the system carrying out automated actions, or producing content that could be visible to more than the individual user, then this becomes a more severe incident. As a technique, jailbreaks should not have an incident severity of their own; rather, severities should depend on the consequence of the overall event (you can read about Microsoft\u2019s approach in the AI bug bounty program).\n\n\n\nHere are some examples of the types of risks that could occur from an AI jailbreak:\n\n\n\n\nAI safety and security risks:Unauthorized data accessSensitive data exfiltrationModel evasionGenerating ransomware\n\nCircumventing individual policies or compliance systems\n\n\n\n\n\nResponsible AI risks:Producing content that violates policies (e.g., harmful, offensive, or violent content)Access to dangerous capabilities of the model (e.g., producing actionable instructions for dangerous or criminal activity)Subversion of decision-making systems (e.g., making a loan application or hiring system produce attacker-controlled decisions)Causing the system to misbehave in a newsworthy and screenshot-able way\n\nIP infringement\n\n\n\n\n\n\nHow do AI jailbreaks occur?\n\n\n\nThe two basic families of jailbreak depend on who is doing them:\n\n\n\n\nA \u201cclassic\u201d jailbreak happens when an authorized operator of the system crafts jailbreak inputs in order to extend their own powers over the system.\n\n\n\nIndirect prompt injection happens when a system processes data controlled by a third party (e.g., analyzing incoming emails or documents editable by someone other than the operator) who inserts a malicious payload into that data, which then leads to a jailbreak of the system.\n\n\n\n\nYou can learn more about both of these types of jailbreaks here.\n\n\n\nThere is a wide range of known jailbreak-like attacks. Some of them (like DAN) work by adding instructions to a single user input, while others (like Crescendo) act over several turns, gradually shifting the conversation to a particular end. Jailbreaks may use very \u201chuman\u201d techniques such as social psychology, effectively sweet-talking the system into bypassing safeguards, or very \u201cartificial\u201d techniques that inject strings with no obvious human meaning, but which nonetheless could confuse AI systems. Jailbreaks should not, therefore, be regarded as a single technique, but as a group of methodologies in which a guardrail can be talked around by an appropriately crafted input.\n\n\n\nMitigation and protection guidance\n\n\n\nTo mitigate the potential of AI jailbreaks, Microsoft takes defense in depth approach when protecting our AI systems, from models hosted on Azure AI to each Copilot solution we offer. When building your own AI solutions within Azure, the following are some of the key enabling technologies that you can use to implement jailbreak mitigations:\n\n\n\n\nPrompt filtering: Prompt Shields in Azure AI Content Safety\n\n\n\nIdentity management: Managed identities for Azure resources\n\n\n\nData access controls: Microsoft Purview data security for generative AI apps &nbsp;&nbsp;\n\n\n\nSystem metaprompt: System message framework and template recommendations for large language models (LLMs)\n\n\n\nContent filtering: Azure OpenAI Service content filtering\n\n\n\nAbuse monitoring: Azure OpenAI Service abuse monitoring\n\n\n\nModel alignment during training: Microsoft Azure AI Fundamentals: Generative AI \u2013 Training\n\n\n\nThreat protection: Microsoft Defender for Cloud threat protection for AI workloads\n\n\n\nFigure 4. Layered approach to protecting AI applications.\n\n\n\nWith layered defenses, there are increased chances to mitigate, detect, and appropriately respond to any potential jailbreaks.\n\n\n\nTo empower security professionals and machine learning engineers to proactively find risks in their own generative AI systems, Microsoft has released an open automation framework, Python Risk Identification Toolkit for generative AI (PyRIT). Read more about the release of&nbsp;PyRIT for generative AI Red teaming, and&nbsp;access the PyRIT toolkit on GitHub.\n\n\n\nWhen building solutions on Azure AI, use the Azure AI Studio capabilities to build benchmarks, create metrics, and implement continuous monitoring and evaluation for potential jailbreak issues.\n\n\nFigure 5. Azure AI Studio capabilities&nbsp;\n\n\n\nIf you discover new vulnerabilities in any AI platform, we encourage you to follow responsible disclosure practices for the platform owner. Microsoft\u2019s procedure is explained here:&nbsp;Microsoft AI Bounty Program.\n\n\n\nDetection guidance\n\n\n\nMicrosoft builds multiple layers of detections into each of our AI hosting and Copilot solutions.\n\n\n\nTo detect attempts of jailbreak in your own AI systems, you should ensure you have enabled logging and are monitoring interactions in each component, especially the conversation transcripts, system metaprompt, and the prompt completions generated by the AI model.\n\n\n\nMicrosoft recommends setting the Azure AI Content Safety filter severity threshold to the most restrictive options, suitable for your application. You can also use Azure AI Studio to begin the evaluation of your AI application safety with the following guidance: Evaluation of generative AI applications with Azure AI Studio.\n\n\n\nSummary\n\n\n\nThis article provides the foundational guidance and understanding of AI jailbreaks. In future blogs, we will explain the specifics of any newly discovered jailbreak techniques. Each one will articulate the following key points:\n\n\n\n\nWe will describe the jailbreak technique discovered and how it works, with evidential testing results.\n\n\n\nWe will have followed responsible disclosure practices to provide insights to the affected AI providers, ensuring they have suitable time to implement mitigations.\n\n\n\nWe will explain how Microsoft\u2019s own AI systems have been updated to implement mitigations to the jailbreak.\n\n\n\nWe will provide detection and mitigation information to assist others to implement their own further defenses in their AI systems.\n\n\n\n\n\n\n\n\nRichard DiverMicrosoft Security\n\n\n\n\n\n\n\nLearn more\n\n\n\nFor the latest security research from the Microsoft Threat Intelligence community, check out the Microsoft Threat Intelligence Blog:&nbsp;https://aka.ms/threatintelblog.\n\n\n\nTo get notified about new publications and to join discussions on social media, follow us on LinkedIn at https://www.linkedin.com/showcase/microsoft-threat-intelligence, and on X (formerly Twitter) at&nbsp;https://twitter.com/MsftSecIntel.\n\n\n\nTo hear stories and insights from the Microsoft Threat Intelligence community about the ever-evolving threat landscape, listen to the Microsoft Threat Intelligence podcast: https://thecyberwire.com/podcasts/microsoft-threat-intelligence.\n\t\t\t", "mentioned_links": ["https://www.microsoft.com/en-us/security/blog/products/microsoft-defender/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-external-id", "https://github.com/alexisvalentino/Chatgpt-DAN", "https://education.microsoft.com/", "https://www.microsoft.com/ai/principles-and-approach/", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-endpoint-privilege-management", "https://learn.microsoft.com/purview/ai-microsoft-purview", "https://www.microsoft.com/en-us/msrc/", "https://www.microsoft.com/en-us/trust-center", "https://twitter.com/intent/tweet?url=https://www.microsoft.com/en-us/security/blog/2024/06/04/ai-jailbreaks-what-they-are-and-how-they-can-be-mitigated/", "https://azure.microsoft.com/en-us/products/key-vault/", "https://partner.microsoft.com/en-US/", "https://learn.microsoft.com/azure/ai-services/openai/concepts/abuse-monitoring", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/ai-threats/", "https://www.microsoft.com/en-us/msrc/bounty-ai", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-xdr", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-audit", "https://github.com/features/security", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-external-attack-surface-management", "https://www.microsoft.com/en-us/events", "https://azure.microsoft.com/en-us/products/ddos-protection/", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-compliance-manager", "https://www.microsoft.com/en-us/industry/consumer-goods", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-private-access", "https://www.microsoft.com/en-us/security/business/partnerships", "https://account.microsoft.com/", "https://blogs.microsoft.com/", "https://www.youtube.com/channel/UC4s3tv0Qq_OSUBfR735Jc6A", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-cloud-pki", "https://www.microsoft.com/en-us/security/business/get-started/contact-us", "https://www.microsoft.com/en-us/security/business/solutions/extended-detection-response-xdr", "https://www.microsoft.com/en-us/microsoft-viva", "https://www.microsoft.com/en-us/security/business/microsoft-purview", "https://learn.microsoft.com/azure/ai-services/openai/concepts/content-filter?tabs=warning%2Cpython-new", "https://www.microsoft.com/en-us/security/blog/2024/04/11/how-microsoft-discovers-and-mitigates-evolving-attacks-against-ai-guardrails/", "https://twitter.com/msftsecurity", "https://servicetrust.microsoft.com/", "https://news.microsoft.com/", "https://www.microsoft.com/en-us/security", "https://www.microsoft.com/en-us/security/business/microsoft-priva", "https://www.microsoft.com/en-us/security/blog/2024/05/06/new-capabilities-to-help-you-secure-your-ai-transformation/", "https://dynamics.microsoft.com/en-us/", "https://www.microsoft.com/en-us/microsoft-copilot", "https://aka.ms/yourcaliforniaprivacychoices", "https://www.microsoft.com/en-us/industry/government", "https://about.ads.microsoft.com/en-us?s_cid=dig-src_uhfcomm", "https://aka.ms/threatintelblog", "https://www.microsoft.com/en-us/industry", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-data-lifecycle-management", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-workload-id", "https://www.microsoft.com/en-us/security/business/security-101", "https://www.microsoft.com/en-us/d/Surface-Laptop-Studio-2/8rqr54krf1dz", "https://learn.microsoft.com/en-us/learn/topics/sci?wt.mc_id=techcom_header-webpage-m365", "https://www.microsoft.com/en-us/d/Surface-Laptop-Go-3/8p0wwgj6c6l2", "https://www.microsoft.com/en-us/security/security-insider/microsoft-digital-defense-report-2023", "https://support.microsoft.com/contactus", "https://www.youtube.com/watch?v=zFRn_RMSPI4", "https://learn.microsoft.com/", "https://www.microsoft.com/en-us/mixed-reality/windows-mixed-reality", "https://thecyberwire.com/podcasts/microsoft-threat-intelligence", "https://learn.microsoft.com/en-us/security/", "https://azure.microsoft.com/en-us/solutions/quantum-computing/", "https://www.microsoft.com/en-us/security/business/services", "https://www.microsoft.com/en-us/security/blog/content-type/research/", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-cloud-security-posture-management", "https://www.microsoft.com/en-us/power-platform", "https://twitter.com/MsftSecIntel", "https://www.microsoft.com/en-us/security/business/services/microsoft-defender-experts-xdr", "https://www.microsoft.com/en-us/security/business/solutions/generative-ai-cybersecurity", "https://www.microsoft.com/en-us/education/devices/overview", "https://www.microsoft.com/en-us/accessibility", "https://www.microsoft.com/en-us/security/business/microsoft-Intune", "https://go.microsoft.com/fwlink/?linkid=2196228", "https://www.microsoft.com/en-us/industry/manufacturing/microsoft-cloud-for-manufacturing", "https://techcommunity.microsoft.com/", "https://techcommunity.microsoft.com/t5/security-compliance-and-identity/ct-p/MicrosoftSecurityandCompliance", "https://www.microsoft.com/en-us/microsoft-products-and-apps", "https://www.microsoft.com/en-us/microsoft-365/business", "https://partner.microsoft.com/en-us/membership", "https://www.microsoft.com/en-us/security/blog/", "https://www.microsoft.com/en-us/store/b/certified-refurbished-products", "https://learn.microsoft.com/entra/identity/managed-identities-azure-resources/overview", "https://www.microsoft.com/en-us/store/b/business?icid=CNavBusinessStore", "https://about.ads.microsoft.com/en-us/partners/welcome?s_cid=en-us-gct-web-src_ext-sub_0-flx_uhfcombepartner", "https://arxiv.org/abs/2307.15043", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-endpoint", "https://learn.microsoft.com/docs/", "https://github.com/Azure/PyRIT", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-verified-id", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-cloud-apps", "https://www.microsoft.com/en-us/microsoft-cloud", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-communication-compliance", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-ediscovery", "https://go.microsoft.com/fwlink/?LinkID=206977", "https://www.microsoft.com/en-us/security/business/solutions/privacy-risk-management", "https://www.microsoft.com", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-insider-risk-management", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-business", "https://www.microsoft.com/en-us/insidetrack", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-sentinel", "https://partner.microsoft.com/en-US/membership/cloud-solution-provider", "https://www.microsoft.com/en-us/security/blog/topic/ai-and-machine-learning/", "https://www.microsoft.com/en-us/education", "https://www.microsoft.com/en-us/security/business/zero-trust", "https://www.microsoft.com/en-us/security/blog/products/microsoft-copilot-for-security/", "https://azure.microsoft.com/en-us/free/students/", "https://www.microsoft.com/en-us/store/b/education", "https://go.microsoft.com/fwlink/?LinkId=521839", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-permissions-management ", "https://www.microsoft.com/en-us/security/business/reports-analysis/industry-recognized-cybersecurity-leader", "https://www.facebook.com/sharer.php?u=https://www.microsoft.com/en-us/security/blog/2024/06/04/ai-jailbreaks-what-they-are-and-how-they-can-be-mitigated/", "https://www.microsoft.com/en-us/download", "https://www.microsoft.com/en-us/windows-365", "https://www.microsoft.com/en-us/security/business/microsoft-incident-response", "https://crescendo-the-multiturn-jailbreak.github.io/", "https://techcommunity.microsoft.com/t5/microsoft-security-copilot-blog/microsoft-copilot-for-security-general-availability-details/ba-p/4079970", "https://www.microsoft.com/en-us/sitemap1.aspx", "https://www.microsoft.com/en-us/security/business/services/microsoft-defender-experts-hunting", "https://www.linkedin.com/showcase/microsoft-threat-intelligence", "https://www.microsoft.com/en-us/security/business/threat-protection/microsoft-defender-vulnerability-management ", "https://www.microsoft.com/en-us/sustainability/", "https://www.microsoft.com/en-us/surface/devices/surface-laptop-7th-edition", "https://www.microsoft.com/windows/windows-11-apps", "https://www.microsoft.com/en-us/education/products/teams", "https://azuremarketplace.microsoft.com/en-us/", "https://www.microsoft.com/investor/default.aspx", "https://www.microsoft.com/en-us/store/b/payment-financing-options?icid=footer_financing_vcc", "https://www.microsoft.com/en-us/diversity/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-threat-intelligence", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id-governance", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-internet-access", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-cloud", "https://www.microsoft.com/en-us/security/business/microsoft-defender", "https://www.linkedin.com/showcase/microsoft-security/", "https://events.microsoft.com/en-us/allevents/?language=English&clientTimeZone=1&search=security", "https://www.microsoft.com/en-us/security/business/services/microsoft-security-enterprise-services", "https://azure.microsoft.com/en-us/products/web-application-firewall/", "https://azure.microsoft.com/en-us/products/microsoft-entra-ds", "https://azure.microsoft.com/en-us/services/azure-firewall/", "https://www.microsoft.com/en-us/store/b/why-microsoft-store?icid=footer_why-msft-store_7102020", "https://go.microsoft.com/fwlink/?linkid=2196227", "https://learn.microsoft.com/training/paths/introduction-generative-ai/", "javascript:void(0)", "https://learn.microsoft.com/en-us/security", "#", "https://www.microsoft.com/en-us/sitemap.aspx", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/attacker-techniques-tools-and-infrastructure/", "https://www.microsoft.com/en-us/security/business/ai-machine-learning/microsoft-copilot-security", "https://www.microsoft.com/en-us/industry/financial-services/banking", "https://www.microsoft.com/en-us/about", "https://www.microsoft.com/en-us/store/b/returns", "https://www.microsoft.com/en-us/security/locale", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-security-exposure-management", "https://www.microsoft.com/en-us/industry/health/microsoft-cloud-for-healthcare", "https://www.microsoft.com/en-us/security/business/cybersecurity-awareness", "https://www.microsoft.com/en-us/microsoft-teams/group-chat-software", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-data-loss-prevention", "https://www.microsoft.com/en-us/security/business/solutions/data-security", "https://privacy.microsoft.com/en-us", "https://aka.ms/crescendoblog", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-advanced-analytics", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-remote-help", "https://www.microsoft.com/en-us/hololens", "https://customers.microsoft.com/en-us/search?sq=Microsoft%20Security&ff=&p=0&so=story_publish_date%20desc", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id-protection ", "https://developer.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-office-365", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-enterprise-application-management", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-for-identity", "https://www.microsoft.com/en-us/research/", "https://www.microsoft.com/en-us/industry/automotive", "https://www.microsoft.com/en-us/dynamics-365", "https://careers.microsoft.com/", "https://www.microsoft.com/en-us/security/business/services/compliance-program-microsoft-cloud", "https://www.microsoft.com/en-us/security/business/get-started/start-free-trial", "https://www.microsoft.com/en-us/security/business/solutions/cloud-workload-protection", "https://www.microsoft.com/en-us/legal/compliance/recycling", "https://www.microsoft.com/en-us/security?wt.mc_id=AID730391_QSG_BLOG_319247&ocid=AID730391_QSG_BLOG_319247", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-iot", "https://www.microsoft.com/en-us/security/blog/author/microsoft-security-threat-intelligence/", "https://www.microsoft.com/en-us/surface/devices/surface-pro-11th-edition", "https://www.microsoft.com/en-us/windows/copilot-ai-features", "https://account.microsoft.com/orders", "https://learn.microsoft.com/azure/ai-services/openai/concepts/system-message", "https://www.linkedin.com/shareArticle?mini=true&url=https://www.microsoft.com/en-us/security/blog/2024/06/04/ai-jailbreaks-what-they-are-and-how-they-can-be-mitigated/", "https://www.microsoft.com/en-us/ai", "https://www.microsoft.com/en-us/education/buy-license/microsoft365", "https://go.microsoft.com/fwlink/?linkid=2259814", "https://learn.microsoft.com/azure/ai-services/content-safety/concepts/jailbreak-detection", "https://learn.microsoft.com/azure/defender-for-cloud/ai-threat-protection", "https://www.microsoft.com/en-us/securityengineering", "https://www.microsoft.com/en-us/security/business/solutions/identity-access", "https://www.microsoft.com/en-us/microsoft-365/business/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id", "https://www.microsoft.com/en-us/licensing/", "https://youtu.be/zFRn_RMSPI4?si=PoAW7Y-VSgiC4R5p", "https://www.microsoft.com/en-us/security/blog/2024/02/22/announcing-microsofts-open-automation-framework-to-red-team-generative-ai-systems/", "https://learn.microsoft.com/azure/ai-studio/concepts/evaluation-approach-gen-ai#evaluating-jailbreak-vulnerability", "https://www.microsoft.com/en-us/security/security-insider/", "https://choice.microsoft.com", "https://www.microsoft.com/en-us/security/business/solutions/ai-powered-unified-secops-platform", "https://azure.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-information-protection", "https://www.microsoft.com/en-us/security/blog/topic/threat-intelligence/", "https://www.microsoft.com/en-us/security/business/solutions/cloud-security", "https://www.microsoft.com/en-us/microsoft-365/business/copilot-for-microsoft-365", "https://about.ads.microsoft.com/en-us/resources/microsoft-advertising-partner-program/microsoft-advertising-partner-program", "https://learn.microsoft.com/azure/ai-services/content-safety/overview", "https://azure.microsoft.com/en-us/solutions/space/", "https://visualstudio.microsoft.com/", "https://www.microsoft.com/en-us/security/business/privacy/microsoft-priva-risk-management", "https://www.microsoft.com/en-us/security/business/privacy/microsoft-priva-subject-rights-requests", "https://www.microsoft.com/en-us/security/blog/content-type/news/", "https://appsource.microsoft.com/en-us/", "https://go.microsoft.com/fwlink/?linkid=2139749", "https://www.microsoft.com/education/how-to-buy", "https://www.microsoft.com/en-us/security/business/microsoft-entra", "https://www.microsoft.com/en-us/microsoft-cloud/resources/secure-future-initiative"]}, {"URL": "https://www.microsoft.com/en-us/security/blog/2024/06/18/microsoft-defender-experts-for-xdr-recognized-in-the-latest-mitre-engenuity-attck-evaluation-for-managed-services/", "author": "Ryan Kivett", "content": "\n\t\t\t\t\n\t\t\t\t\nMicrosoft Defender Experts for XDR demonstrated excellent managed extended detection and response (MXDR) by unifying our human-driven services and Microsoft Defender XDR in the MITRE Engenuity ATT&amp;CK\u00ae Evaluations: Managed Services menuPass + ALPHV BlackCat.&nbsp;&nbsp;&nbsp;\n\n\n\nDefender Experts for XDR offers a range of capabilities:&nbsp;\n\n\n\n\nManaged detection and response: Let our expert analysts manage your Microsoft Defender XDR incident queue and handle triage, investigation, and response on your behalf.&nbsp;&nbsp;\n\n\n\nProactive threat hunting: Extend your team\u2019s threat hunting capabilities and prioritize significant threats with Defender Experts for Hunting built in.&nbsp;\n\n\n\nLive dashboards and reports: Get a transparent view of our operations conducted on your behalf, along with a noise-free, actionable view of prioritized incidents and detailed analytics.&nbsp;\n\n\n\nProactive check-ins: Benefit from remote, periodic check-ins with your named service delivery manager (SDM) team to guide your MXDR experience and improve your security posture.&nbsp;\n\n\n\nFast and seamless onboarding: Get a guided baselining experience to ensure your Microsoft security products are correctly configured.\n\n\n\n\n\t\n\t\t\n\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\tMicrosoft Defender Experts for XDR\n\n\t\t\t\t\tGive your security operations center (SOC) team coverage with leading end-to-end protection and expertise.\n\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\n\t\t\t\n\n\t\t\t\t\t\n\t\n\n\n\n\nCyberattacks detected by Defender Experts for XDR\n\n\n\nIn the first cyberattack, Defender Experts for XDR provided detection, visibility, and coverage under what Microsoft Threat Intelligence tracks as the threat actor Purple Typhoon.&nbsp;From the early steps in the intrusion, our team alerted the customer that 11 systems and 13 accounts were compromised via a malicious Remote Desktop Protocol (RDP) session, leveraging a Dynamic Link Library (DLL) Search Order Hijacking on a legitimate Notepad++ executable.&nbsp;As is common with this threat actor, the next cyberattack, established a Quasar RAT backdoor triggering keylogging, capturing credentials for the domain admin. After the loaders were executed, scheduled tasks were used to move laterally, execute discovery commands on internal network areas, and complete credential theft dumping.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n\n\n\nFor the second cyberattack, which used BlackCat ransomware, Defender Experts for XDR detected and provided extensive guidance on investigation and remediation actions.&nbsp;The BlackCat ransomware, also known as\u202fALPHV, is a prevalent cyberthreat and a prime example of the growing\u202fransomware-as-a-service (RaaS) gig economy. It\u2019s noteworthy due to its unconventional programming language (Rust), multiple target devices and possible entry points, and affiliation with prolific threat activity groups. While BlackCat\u2019s arrival and execution vary based on the actors deploying it, the outcome is the same\u2014target data is encrypted, exfiltrated, and used for \u201cdouble extortion,\u201d where attackers threaten to release the stolen data to the public if the ransom isn\u2019t paid.&nbsp;This attack used access broker credentials to perform lateral movement, exfiltrate sensitive data via privileged execution, and execute ransomware encryption malware.&nbsp;&nbsp;&nbsp;&nbsp;\n\n\n\nIn both cyberattacks, our team focused on providing focused email, in-product focus to guide the customer, and in a real world cyberattack, our service and product would take disruption actions to stop the cyberattack.\n\n\n\nComprehensive threat hunting, managed response, and product detections&nbsp;\n\n\n\nWith complex cyberattacks, security operations teams need robust guidance on what is happening and how to prioritize remediation efforts.&nbsp;Throughout this evaluation, we provided over 18 incidents, 196 alerts, and enriched product detections with human-driven guidance via email and in product experiences using Managed responses. This includes a detailed investigation summary, indicators of compromise (IOCs), advanced hunting queries (AHQs), and prioritized remediation actions to help contain the cyberthreat. Our world class hunting team focuses on providing initial response to a cyberattack, then iterations on updates based on new threat intelligence findings and other enrichment.&nbsp;&nbsp;&nbsp;\n\n\n\n\n\n\n\nFigure 1. The incident and alerts are tagged with Defender Experts and detailed analysis provided under view Managed response.\n\n\n\n\n\n\nFigure 2. Managed response showing details of investigation summary, IOCs, and TTPs.\n\n\n\n\n\n\n\nFigure 3. Managed response focused remediation one-click actions such as blocking indicator, stopping a malicious process, and resetting passwords.\n\n\n\nAI-driven attack disruption with Microsoft Defender XDR&nbsp;&nbsp;&nbsp;\n\n\n\nAs the second cyberattack leveraged BlackCat ransomware, Microsoft Defender XDR\u2019s attack disruption capability automatically contained the threat and then followed up with hunter guidance on additional containment.&nbsp;This capability combines our industry-leading detection with AI-powered enforcement mechanisms to help mitigate cyberthreats early on in the cyberattack chain and contain their advancement. Analysts have a powerful tool against human-operated cyberattacks while leaving them in complete control of investigating, remediating, and bringing assets back online.&nbsp;\n\n\n\n\n\n\n\nFigure 4. A summary attack graph,&nbsp;managed responses and attack disruption automatically handling this ransomware threat.\n\n\n\nSeamless alert prioritization and consolidation into notifications for the SOC&nbsp;\n\n\n\nWe provide prioritization and focus for a typical customer\u2019s SOC team using tags and incident titles with Defender Experts where we enrich product detections. In addition, a dedicated SDM will conduct periodic touchpoints with customers to share productivity and service metrics, provide insights on any vulnerabilities or changes in their environment, solicit feedback, and make best practices recommendations. Our customers see a reduction in total incident volume over time, improvements in security posture, and overall lower operational overhead. Learn how Defender Experts helps Westminster School. &nbsp;\n\n\n\n\n\n\nFigure 5. Summary of all incidents and Defender Experts tag to help filter and prioritize for customers.\n\n\n\nCommitment to Microsoft MXDR partners&nbsp;\n\n\n\nWe continue our commitment to support our partners in our Microsoft-verified MXDR program. We know that a single provider can\u2019t meet the unique needs of every organization, so we frequently collaborate with our ecosystem of partners to provide customers the flexibility to choose what works best for them\u2014and to leverage those trusted relationships for the best outcomes and returns on their investment.&nbsp;\n\n\n\nWe acknowledge that there are areas for discussion and enhancement, but we will take these as a valuable learning opportunity to continuously improve our products and services for the customers we serve. We appreciate our ongoing collaboration with MITRE as the managed services evaluation process evolves with the growing cyberthreat landscape. We thank\u202fMITRE Engenuity\u202ffor the opportunity to contribute to and participate in this year\u2019s evaluation.&nbsp;\n\n\n\nLearn more&nbsp;about Microsoft Defender Experts for XDR\n\n\n\nTo learn more, visit the Microsoft Defender Experts for XDR web page, read the Defender Experts for XDR docs page, and subscribe to our ongoing news at the Microsoft Security Experts blog.&nbsp;\n\n\n\n\u200b\u200bTo learn more about Microsoft Security solutions, visit our website. Bookmark the\u202fSecurity blog\u202fto keep up with our expert coverage on security matters. Also, follow us on LinkedIn (Microsoft Security) and X (@MSFTSecurity)\u202ffor the latest news and updates on cybersecurity.&nbsp;\n\n\n\n\n\n\n\n\u00a9 June 2024. The MITRE Corporation. This work is reproduced and distributed with the permission of The MITRE Corporation.&nbsp;\n\t\t\t", "mentioned_links": ["https://education.microsoft.com/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-external-id", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-endpoint-privilege-management", "https://www.microsoft.com/en-us/msrc/", "https://www.microsoft.com/en-us/trust-center", "https://www.microsoft.com/en-us/security/blog/author/ryan-kivett/", "https://www.microsoft.com/en-us/security/business/security-101/what-is-cyber-threat-intelligence", "https://azure.microsoft.com/en-us/products/key-vault/", "https://attackevals.mitre-engenuity.org/managed-services/menupass-blackcat/", "https://partner.microsoft.com/en-US/", "https://learn.microsoft.com/en-us/defender-xdr/automatic-attack-disruption", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-xdr", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-audit", "https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2024/06/Picture4-1.jpg", "https://github.com/features/security", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-external-attack-surface-management", "https://www.microsoft.com/en-us/events", "https://azure.microsoft.com/en-us/products/ddos-protection/", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-compliance-manager", "https://www.microsoft.com/en-us/industry/consumer-goods", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-private-access", "https://www.microsoft.com/en-us/security/business/partnerships", "https://www.microsoft.com/security/business/services/microsoft-defender-experts-hunting", "https://techcommunity.microsoft.com/t5/microsoft-security-experts-blog/bg-p/MicrosoftSecurityExperts", "https://blogs.microsoft.com/", "https://account.microsoft.com/", "https://www.youtube.com/channel/UC4s3tv0Qq_OSUBfR735Jc6A", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-cloud-pki", "https://www.microsoft.com/en-us/security/business/get-started/contact-us", "https://www.microsoft.com/en-us/security/business/solutions/extended-detection-response-xdr", "https://www.microsoft.com/en-us/microsoft-viva", "https://www.microsoft.com/en-us/security/business/microsoft-purview", "https://twitter.com/msftsecurity", "https://news.microsoft.com/", "https://servicetrust.microsoft.com/", "https://www.microsoft.com/en-us/security", "https://www.microsoft.com/en-us/security/business/microsoft-priva", "https://www.microsoft.com/security/blog/2022/05/09/ransomware-as-a-service-understanding-the-cybercrime-gig-economy-and-how-to-protect-yourself/", "https://dynamics.microsoft.com/en-us/", "https://www.microsoft.com/en-us/microsoft-copilot", "https://aka.ms/yourcaliforniaprivacychoices", "https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2024/06/Picture3.jpg", "https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2024/06/Picture1-2.jpg", "https://www.microsoft.com/en-us/industry/government", "https://about.ads.microsoft.com/en-us?s_cid=dig-src_uhfcomm", "https://www.microsoft.com/en-us/industry", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-data-lifecycle-management", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-workload-id", "https://www.microsoft.com/security/business/siem-and-xdr/microsoft-defender-xdr", "https://www.microsoft.com/en-us/security/business/security-101", "https://www.microsoft.com/en-us/d/Surface-Laptop-Studio-2/8rqr54krf1dz", "https://learn.microsoft.com/en-us/learn/topics/sci?wt.mc_id=techcom_header-webpage-m365", "https://www.facebook.com/sharer.php?u=https://www.microsoft.com/en-us/security/blog/2024/06/18/microsoft-defender-experts-for-xdr-recognized-in-the-latest-mitre-engenuity-attck-evaluation-for-managed-services/", "https://www.microsoft.com/en-us/d/Surface-Laptop-Go-3/8p0wwgj6c6l2", "https://www.microsoft.com/en-us/security/security-insider/microsoft-digital-defense-report-2023", "https://support.microsoft.com/contactus", "https://learn.microsoft.com/", "https://www.microsoft.com/en-us/mixed-reality/windows-mixed-reality", "https://www.microsoft.com/en-us/security/blog/products/microsoft-defender-experts-for-hunting/", "https://learn.microsoft.com/en-us/security/", "https://azure.microsoft.com/en-us/solutions/quantum-computing/", "https://www.microsoft.com/en-us/security/blog/products/microsoft-security-experts/", "https://www.microsoft.com/en-us/security/business/services", "https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2024/06/Picture2-2.png", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-cloud-security-posture-management", "https://www.microsoft.com/en-us/security/blog/topic/siem-and-xdr/", "https://www.microsoft.com/en-us/power-platform", "https://www.microsoft.com/en-us/security/business/services/microsoft-defender-experts-xdr", "https://www.microsoft.com/en-us/security/business/solutions/generative-ai-cybersecurity", "https://www.microsoft.com/en-us/education/devices/overview", "https://www.microsoft.com/misapartnercatalog?PartnerClassifications=MicrosoftVerifiedManagedXDRSolution", "https://www.microsoft.com/en-us/security/business/microsoft-Intune", "https://www.microsoft.com/en-us/accessibility", "https://go.microsoft.com/fwlink/?linkid=2196228", "https://www.microsoft.com/en-us/industry/manufacturing/microsoft-cloud-for-manufacturing", "https://techcommunity.microsoft.com/", "https://techcommunity.microsoft.com/t5/security-compliance-and-identity/ct-p/MicrosoftSecurityandCompliance", "https://www.microsoft.com/en-us/microsoft-products-and-apps", "https://www.microsoft.com/en-us/microsoft-365/business", "https://partner.microsoft.com/en-us/membership", "https://www.microsoft.com/en-us/security/blog/", "https://www.microsoft.com/en-us/security/blog/topic/analyst-reports/", "https://www.microsoft.com/en-us/store/b/certified-refurbished-products", "https://www.microsoft.com/en-us/store/b/business?icid=CNavBusinessStore", "https://about.ads.microsoft.com/en-us/partners/welcome?s_cid=en-us-gct-web-src_ext-sub_0-flx_uhfcombepartner", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-endpoint", "https://learn.microsoft.com/docs/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-verified-id", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-cloud-apps", "https://www.microsoft.com/en-us/microsoft-cloud", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-communication-compliance", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-ediscovery", "https://go.microsoft.com/fwlink/?LinkID=206977", "https://www.microsoft.com/en-us/security/business/solutions/privacy-risk-management", "https://www.microsoft.com/en-us/security/blog/2024/06/03/microsoft-is-named-a-leader-in-the-forrester-wave-for-xdr/", "https://www.microsoft.com", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-insider-risk-management", "https://twitter.com/intent/tweet?url=https://www.microsoft.com/en-us/security/blog/2024/06/18/microsoft-defender-experts-for-xdr-recognized-in-the-latest-mitre-engenuity-attck-evaluation-for-managed-services/", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-business", "https://www.linkedin.com/shareArticle?mini=true&url=https://www.microsoft.com/en-us/security/blog/2024/06/18/microsoft-defender-experts-for-xdr-recognized-in-the-latest-mitre-engenuity-attck-evaluation-for-managed-services/", "https://www.microsoft.com/en-us/insidetrack", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-sentinel", "https://partner.microsoft.com/en-US/membership/cloud-solution-provider", "https://www.microsoft.com/en-us/education", "https://www.microsoft.com/en-us/security/business/zero-trust", "https://azure.microsoft.com/en-us/free/students/", "https://www.microsoft.com/en-us/store/b/education", "https://go.microsoft.com/fwlink/?LinkId=521839", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-permissions-management ", "https://www.microsoft.com/en-us/security/business/reports-analysis/industry-recognized-cybersecurity-leader", "https://www.microsoft.com/en-us/download", "https://www.microsoft.com/en-us/sitemap1.aspx", "https://www.microsoft.com/en-us/windows-365", "https://www.microsoft.com/en-us/security/business/microsoft-incident-response", "https://learn.microsoft.com/en-us/defender-xdr/managed-detection-and-response-xdr", "https://learn.microsoft.com/microsoft-365/security/defender/dex-xdr-overview?view=o365-worldwide", "https://www.microsoft.com/en-us/security/business/services/microsoft-defender-experts-hunting", "https://www.microsoft.com/en-us/security/business/threat-protection/microsoft-defender-vulnerability-management ", "https://www.microsoft.com/en-us/sustainability/", "https://www.microsoft.com/en-us/surface/devices/surface-laptop-7th-edition", "https://www.microsoft.com/windows/windows-11-apps", "https://www.microsoft.com/en-us/education/products/teams", "https://azuremarketplace.microsoft.com/en-us/", "https://www.microsoft.com/investor/default.aspx", "https://www.microsoft.com/en-us/store/b/payment-financing-options?icid=footer_financing_vcc", "https://www.microsoft.com/en-us/diversity/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-threat-intelligence", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id-governance", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-internet-access", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-cloud", "https://www.microsoft.com/en-us/security/business/microsoft-defender", "https://www.linkedin.com/showcase/microsoft-security/", "https://events.microsoft.com/en-us/allevents/?language=English&clientTimeZone=1&search=security", "https://www.microsoft.com/en-us/security/business/services/microsoft-security-enterprise-services", "https://azure.microsoft.com/en-us/products/web-application-firewall/", "https://azure.microsoft.com/en-us/products/microsoft-entra-ds", "https://azure.microsoft.com/en-us/services/azure-firewall/", "https://www.microsoft.com/en-us/store/b/why-microsoft-store?icid=footer_why-msft-store_7102020", "https://go.microsoft.com/fwlink/?linkid=2196227", "javascript:void(0)", "https://learn.microsoft.com/en-us/security", "#", "https://www.microsoft.com/en-us/sitemap.aspx", "https://www.microsoft.com/en-us/security/business/ai-machine-learning/microsoft-copilot-security", "https://www.microsoft.com/en-us/industry/financial-services/banking", "https://www.microsoft.com/en-us/about", "https://www.microsoft.com/en-us/store/b/returns", "https://www.microsoft.com/en-us/security/locale", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-security-exposure-management", "https://www.microsoft.com/en-us/industry/health/microsoft-cloud-for-healthcare", "https://www.microsoft.com/en-us/security/business/cybersecurity-awareness", "https://www.microsoft.com/en-us/microsoft-teams/group-chat-software", "https://techcommunity.microsoft.com/t5/security-compliance-and-identity/new-blog-post-the-many-lives-of-blackcat-ransomware/m-p/3501842", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune", "https://twitter.com/@MSFTSecurity", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-data-loss-prevention", "https://learn.microsoft.com/defender-xdr/dex-xdr-overview", "https://www.microsoft.com/en-us/security/business/solutions/data-security", "https://privacy.microsoft.com/en-us", "https://customers.microsoft.com/story/1761599991200737574-westminster-microsoft-defender-primary-and-secondary-edu-k-12-en-australia", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-advanced-analytics", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-remote-help", "https://www.microsoft.com/en-us/hololens", "https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2024/06/Picture5-1.png", "https://customers.microsoft.com/en-us/search?sq=Microsoft%20Security&ff=&p=0&so=story_publish_date%20desc", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id-protection ", "https://developer.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-office-365", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-enterprise-application-management", "https://www.microsoft.com/en-us/security/blog/products/microsoft-defender-experts-for-xdr/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-for-identity", "https://www.microsoft.com/en-us/research/", "https://www.varonis.com/blog/alphv-blackcat-ransomware", "https://www.microsoft.com/en-us/industry/automotive", "https://www.microsoft.com/en-us/dynamics-365", "https://careers.microsoft.com/", "https://www.microsoft.com/en-us/security/business/services/compliance-program-microsoft-cloud", "https://www.microsoft.com/en-us/security/business/get-started/start-free-trial", "https://www.microsoft.com/en-us/security/business/solutions/cloud-workload-protection", "https://www.microsoft.com/en-us/legal/compliance/recycling", "https://www.microsoft.com/en-us/security?wt.mc_id=AID730391_QSG_BLOG_319247&ocid=AID730391_QSG_BLOG_319247", "https://www.microsoft.com/security/blog/", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-iot", "https://www.microsoft.com/en-us/surface/devices/surface-pro-11th-edition", "https://www.microsoft.com/en-us/windows/copilot-ai-features", "https://account.microsoft.com/orders", "https://www.microsoft.com/security", "https://www.microsoft.com/en-us/ai", "https://www.microsoft.com/en-us/education/buy-license/microsoft365", "https://go.microsoft.com/fwlink/?linkid=2259814", "https://www.microsoft.com/en-us/securityengineering", "https://www.microsoft.com/security/business/services/microsoft-defender-experts-xdr", "https://www.microsoft.com/en-us/security/business/solutions/identity-access", "https://www.microsoft.com/en-us/microsoft-365/business/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id", "https://www.microsoft.com/en-us/licensing/", "https://security.microsoft.com/intel-profiles/e2ce50467bf60953a8838cf5d054caf7f89a0a7611f65e89a67e0142211a1745", "https://choice.microsoft.com", "https://www.microsoft.com/en-us/security/security-insider/", "https://www.microsoft.com/en-us/security/business/solutions/ai-powered-unified-secops-platform", "https://azure.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-information-protection", "https://www.microsoft.com/en-us/security/blog/topic/threat-intelligence/", "https://www.microsoft.com/en-us/security/business/solutions/cloud-security", "https://www.microsoft.com/en-us/microsoft-365/business/copilot-for-microsoft-365", "https://about.ads.microsoft.com/en-us/resources/microsoft-advertising-partner-program/microsoft-advertising-partner-program", "https://azure.microsoft.com/en-us/solutions/space/", "https://visualstudio.microsoft.com/", "https://www.microsoft.com/en-us/security/business/privacy/microsoft-priva-risk-management", "https://www.microsoft.com/en-us/security/business/privacy/microsoft-priva-subject-rights-requests", "https://mitre-engenuity.org/", "https://appsource.microsoft.com/en-us/", "https://go.microsoft.com/fwlink/?linkid=2139749", "https://www.microsoft.com/education/how-to-buy", "https://www.microsoft.com/en-us/security/business/microsoft-entra", "https://www.microsoft.com/en-us/microsoft-cloud/resources/secure-future-initiative"]}, {"URL": "https://www.microsoft.com/en-us/security/blog/2024/05/01/dirty-stream-attack-discovering-and-mitigating-a-common-vulnerability-pattern-in-android-apps/", "author": "Microsoft Threat Intelligence", "content": "\n\t\t\t\t\n\t\t\t\t\nMicrosoft discovered a path traversal-affiliated vulnerability pattern in multiple popular Android applications that could enable a malicious application to overwrite files in the vulnerable application\u2019s home directory. The implications of this vulnerability pattern include arbitrary code execution and token theft, depending on an application\u2019s implementation. Arbitrary code execution can provide a threat actor with full control over an application\u2019s behavior. Meanwhile, token theft can provide a threat actor with access to the user\u2019s accounts and sensitive data.\n\n\n\nWe identified several vulnerable applications in the Google Play Store that represented over four billion installations. We anticipate that the vulnerability pattern could be found in other applications. We\u2019re sharing this research so developers and publishers can check their apps for similar issues, fix as appropriate, and prevent introducing such vulnerabilities into new apps or releases. &nbsp;As threats across all platforms continue to evolve, industry collaboration among security researchers, security vendors, and the broader security community is essential in improving security for all. Microsoft remains committed to working with the security community to share vulnerability discoveries and threat intelligence to protect users across platforms.\n\n\n\nAfter discovering this issue, we identified several vulnerable applications. As part of our responsible disclosure policy, we notified application developers through Coordinated Vulnerability Disclosure (CVD) via Microsoft Security Vulnerability Research (MSVR) and worked with them to address the issue. We would like to thank the Xiaomi, Inc. and WPS Office security teams for investigating and fixing the issue. As of February 2024, fixes have been deployed for the aforementioned apps, and users are advised to keep their device and installed applications up to date.\n\n\n\nRecognizing that more applications could be affected, we acted to increase developer awareness of the issue by collaborating with Google to publish an article on the Android Developers website, providing guidance in a high-visibility location to help developers avoid introducing this vulnerability pattern into their applications. We also wish to thank Google\u2019s Android Application Security Research team for their partnership in resolving this issue.\n\n\n\nIn this blog post, we continue to raise developer and user awareness by giving a general overview of the vulnerability pattern, and then focusing on Android share targets, as they are the most prone to these types of attacks. We go through an actual code execution case study where we demonstrate impact that extends beyond the mobile device\u2019s scope and could even affect a local network. Finally, we provide guidance to users and application developers and illustrate the importance of collaboration to improve security for all.\n\n\n\nOverview: Data and file sharing on Android\n\n\n\nThe Android operating system enforces isolation by assigning each application its own dedicated data and memory space. To facilitate data and file sharing, Android provides a component called a content provider, which acts as an interface for managing and exposing data to the rest of the installed applications in a secure manner. When used correctly, a content provider provides a reliable solution. However, improper implementation can introduce vulnerabilities that could enable bypassing of read/write restrictions within an application\u2019s home directory.\n\n\n\nThe Android software development kit (SDK) includes the FileProvider class, a subclass of ContentProvider that enables file sharing between installed applications. An application that needs to share its files with other applications can declare a FileProvider in its app manifest and declare the specific paths to share.\n\n\n\nEvery file provider has a property called authority, which identifies it system-wide, and can be used by the consumer (the app that wants to access the shared files) as a form of address. This content-based model bears a strong resemblance to the web model, but instead of the http scheme, consumers utilize the content scheme along with the authority, followed by a pseudo-path to the file that they want to access.\n\n\n\nFor example, assuming that the application com.example.server shares some files under the file:///data/data/com.example.server/files/images directory that it has previously declared as shared using the name shared_images, a consumer can use the content://[authority]/shared_images/[sub-path]/[filename] URI to index these files.\n\n\n\nAccess is given by the data sharing application most commonly using the grantUriPermissions attribute of the Android manifest, in combination with special flags that are used to define a read or write mode of operation. The data sharing application creates and sends an intent to the consumer that provides temporary fine-grained access to a file. &nbsp;Finally, when a provider receives a file access request, it resolves the actual file path that corresponds to the incoming URI and returns a file descriptor to it. &nbsp;\n\n\n\nImplementation pitfalls\n\n\n\nThis content provider-based model provides a well-defined file-sharing mechanism, enabling a serving application to share its files with other applications in a secure manner with fine-grained control. However, we have frequently encountered cases where the consuming application doesn\u2019t validate the content of the file that it receives and, most concerning, it uses the filename provided by the serving application to cache the received file within the consuming application\u2019s internal data directory. If the serving application implements its own malicious version of FileProvider, it may be able to cause the consuming application to overwrite critical files.\n\n\n\n\n\n\n\nIn simple terms, a share target is an Android app that declares itself to handle data and files sent by other apps. Common application categories that can be share targets include mail clients, social networking apps, messaging apps, file editors, browsers, and so on. In a common scenario, when a user clicks on a file, the Android operating system triggers the share-sheet dialog asking the user to select the component that the file should be sent to:\n\n\nFigure 1. The Android share sheet dialog\n\n\n\nWhile this type of guided file-sharing interaction itself may not trigger a successful attack against a share target, a malicious Android application can create a custom, explicit intent and send a file directly to a share target with a malicious filename and without the user\u2019s knowledge or approval. Essentially, the malicious application is substituting its own malicious FileProvider implementation and provides a filename that is improperly trusted by the consuming application.\n\n\nFigure 2. Dirty stream attack\n\n\n\nIn Figure 2, the malicious app, on the left, creates an explicit intent that targets the file processing component of the share target, on the right, and attaches a content URI as an intent\u2019s extra. It then sends this intent to the share target using the startActivity API call.\n\n\n\nAfter this point, most of the share targets that we have reviewed seem to follow a specific code pattern that includes the following steps:\n\n\n\n\nRequest the actual filename from the remote file provider\n\n\n\nUse this filename to initialize a file that is subsequently used to initialize a file output stream\n\n\n\nCreate an input stream using the incoming content URI\n\n\n\nCopy the input stream to the output stream\n\n\n\n\nSince the rogue app controls the name as well as the content of the file, by blindly trusting this input, a share target may overwrite critical files in its private data space, which may lead to serious consequences.\n\n\n\nImpact\n\n\n\nWe identified this vulnerability pattern in the then-current versions of several Android applications published on the Google Play Store, including at least four with more than 500 million installations each. In each case, we responsibly disclosed to the vendor. Two example vulnerable applications that we identified are Xiaomi Inc.\u2019s File Manager (1B+ installs) and WPS Office (500M+ installs).\n\n\n\nIn Xiaomi Inc.\u2019s File Manager, we were able to obtain arbitrary code execution in version V1-210567. After our disclosure, Xiaomi published version V1-210593, and we verified that the vulnerability has been addressed. In WPS Office, we were able to obtain arbitrary code execution in version 16.8.1. After our disclosure, WPS published and informed us that the vulnerability has been addressed as of version 17.0.0.\n\n\n\nThe potential impact varies depending on implementation specifics. For example, it\u2019s very common for Android applications to read their server settings from the shared_prefs directory. In such cases, the malicious app can overwrite these settings, causing the vulnerable app to communicate with an attacker-controlled server and send the user\u2019s authentication tokens or other sensitive information.\n\n\n\nIn a worst-case (and not so uncommon) scenario, the vulnerable application might load native libraries from its data directory (as opposed to the more secure /data/app-lib directory, where the libraries are protected from modification). In this case, the malicious application can overwrite a native library with malicious code that gets executed when the library is loaded. In the following section, we use Xiaomi Inc.\u2019s File Manager to illustrate this case. We demonstrated the ability for a malicious application to overwrite the application\u2019s shared preferences, write a native library to the application\u2019s internal storage, and cause the application to load the library. These actions provided arbitrary code execution with the file manager\u2019s user ID and permissions.\n\n\n\nIn the following sections, we focus on this case and delve into the technical details of this vulnerability pattern.\n\n\n\nCase study: Xiaomi Inc.\u2019s File Manager\n\n\n\nXiaomi Inc.\u2019s File Manager is the default file manager application for Xiaomi devices and is published under the package name com.mi.android.globalFileexplorer on the Google Play Store, where it has been installed over one billion times.\n\n\nFigure 3. Xiaomi\u2019s File Manager profile according to Android rank (source: File Manager)\n\n\n\nBesides having full access to the device\u2019s external storage, the application requests many permissions, including the ability to install other applications:\n\n\nFigure 4. A snapshot of the application\u2019s permissions\n\n\n\nFurther, it offers a junk files cleaner plugin as well as the ability to connect to remote FTP and SMB shares:\n\n\nFigure 5. Connecting to remote shares using the file manager\n\n\n\nVulnerability assessment findings\n\n\n\nDuring our investigation, we identified that the application exports the CopyFileActivity, an activity alias of the com.android.fileexplorer.activity.FileActivity, which is used to handle copy-from-to file operations:\n\n\nFigure 6. Triggering the copy to CopyFileActivity\n\n\n\nSince this activity is exported, it can be triggered by any application installed on the same device by using an explicit intent of action SEND or SEND_MULTIPLE and attaching a content URI corresponding to a file stream.\n\n\n\nUpon receiving such an intent, the browser performs a validity check, which we found to be insufficient:\n\n\nFigure 7. Validating an incoming copy file request\n\n\n\nAs depicted above, the initCopyOrMoveIntent method calls the checkValid method passing as an argument a content URI (steps 1 and 2). However, the checkValid method is designed to handle a file path, not a content URI. It always returns true for a content URI. Instead, a safer practice is to parse the string as a URI, including ensuring the scheme is the expected value (in this case, file, not content).The checkValid method verifies that the copy or move operation doesn\u2019t affect the private directory of the app, by initializing a file object using the incoming string as an argument to the File class constructor and comparing its canonical path with the path that corresponds to the home directory of the application (steps 3 and 4). Given a content URI as a path, the File constructor normalizes it (following a Unix file system normalization), thus the getCanonicalPath method returns a string starting with \u201c/content:/\u201c, which will always pass the validity check. More specifically, the app performs a query to the remote content provider for the _size, _display_name and _data columns (see line 48 below). Then it uses the values returned by these rows to initialize the fields of an object of the com.android.fileexplorer.mode.c class:\n\n\nFigure 8. Getting file metadata from the remote content provider\n\n\n\nGiven the case that the _display_name and _data values, returned from the external file provider, are relative paths to the destination directory, after exiting from the method above, these class fields will contain values like the ones depicted below:\n\n\nFigure 9. The file model initialized after calling the method a\n\n\n\nAs shown above, the paths (variables d and e) of this file-model point to files within the home directory of the application, thus the file streams attached to the incoming intent are going to be written under the specific locations.\n\n\n\nGetting code execution\n\n\n\nAs previously mentioned, the application uses a plugin to clean the device\u2019s junk files:\n\n\nFigure 10. The junk files cleaner plugin user interface\n\n\n\nWhen the application loads this plugin, it makes use of two native libraries: libixiaomifileu.so, which fetches from the /data/app directory, and libixiaomifileuext.so from the home directory:\n\n\nFigure 11. Tracing the loaded native libraries using medusa\n\n\n\nAs apps don\u2019t have write access to the /data/app folder, the libixiaomifileu.so file stored there cannot be replaced. The easiest way to get code execution is to replace the libixiaomifileuext.so with a malicious one. However, an attempt to do so would fail since in this particular case, the vulnerability that we described can only be used to write new files within the home directory, not overwrite existing files. Our next inquiry was to determine how the application loads the libixiaomifileu.so.\n\n\n\nOur assessment showed that before the application loads this library, it follows the following steps:\n\n\n\n\nCalculate the hash of the file libixiaomifileu.so, located in the /data/app directory\n\n\n\n\n\nCompare this hash with the value assigned to the \u201clibixiaomifileu.so_hm5\u201d string, fetched from the com.mi.android.globalFileexprorer_preferences.xml file\n\n\n\nFigure 12. the com.mi.android.globalFileexprorer_preferences.xml\n\n\n\n\nIf the values don\u2019t match, search for the libixiaomifileu.so file in the /files/lib path in the home directory\n\n\n\n\n\nIf the file is found there, calculate its hash and compare it again with the value from the shared_preferences folder\n\n\n\n\n\nIf the hashes match, load the file under the /files/lib using the System.load method\n\n\n\n\nGiven this behavior, in order to get code execution with the file manager\u2019s user ID, an attacker must take the following steps:\n\n\n\n\nUse the path traversal vulnerability to save a malicious library as /files/lib/libixiaomifileu.so (the file does not already exist in that directory, so overwriting is not an issue)\n\n\n\n\n\nCalculate the hash of this library to replace the value of the libixiaomifileu.so_hm5 string\n\n\n\n\n\nTrigger the junk cleaner plugin with an explicit intent, since the activity that loads the native libraries is exported\n\n\n\n\nAn acute reader might have noticed that the second step requires the attacker to force the browser to overwrite the com.mi.android.globalFileexprorer_preferences.xml, which, as we already mentioned, was not possible.\n\n\n\nTo overcome this restriction, we referred to the actual implementation of the SharedPreferences class, where we found that when an Android application uses the getSharedPreferences API method to retrieve an instance of the SharedPreferences class, giving the name of the shared preferences file as an argument, then the constructor of the SharedPreferencesImpl class performs the following steps:\n\n\n\n\nCreate a new file object using the name provided to the getSharedPreferences method, followed by the .xml extension, followed by the .bak extension\n\n\n\n\n\nCheck if this file exists, and in case it does, delete the original xml file and replace it with the one created in the first step\n\n\n\n\nThrough this behavior, we were able to save the com.mi.android.globalFileexprorer_preferences.xml.bak under the shared preferences folder (as during the application\u2019s runtime it is unlikely to exist), so when the app tried to verify the hash, the original xml file was already replaced by our own copy. After this point, by using a single intent to start the junk cleaner plugin, we were able to trick the application to load the malicious library instead of the one under the /data/app folder and get code execution with the browser\u2019s user ID.\n\n\n\nImpact\n\n\n\nOne reason we chose to use this app as a showcase is because the impact extends beyond the user\u2019s mobile device. The application gives the option to connect to remote file shares using the FTP and SMB protocols and the user credentials are saved in clear text in the /data/data/com.mi.android.globalFileexplorer/files/rmt_i.properties file:\n\n\nFigure 13. SMB/FTP credentials saved in clear text\n\n\n\nIf a third party app was able to exploit this vulnerability and obtain code execution, an attacker could retrieve these credentials. The impact would then extend even further, since by the time that a user requests to open a remote share, the browser creates the directory /sdcard/Android/data/com.mi.android.globalFileexplorer/files/usbTemp/ where it saves the files that the user retrieves:\n\n\nFigure 14. SMB shared files, saved in the external storage\n\n\n\nThis means that a remote attacker would be able to read or write files to SMB shares of a local network, assuming that the device was connected to it. The same stands for FTP shares as they are handled exactly in the same way:\n\n\nFigure 15. FTP shared files, saved in the external storage\n\n\n\nIn summary, the exploitation flow is depicted in the figure below:\n\n\nFigure 16. Getting remote access to local shares\n\n\n\nIn step 1, the user opens a malicious app that may pose as a file editor, messaging app, mail client, or any app in general and request the user to save a file. By the time that the user attempts to save such a file, no matter what destination path they choose to save it, the malicious app forces the file browser app to write it under its internal /files/lib folder. Then, the malicious app can start the junk cleaner using an explicit intent (no user interaction is required) and this will lead to code execution with the browser\u2019s ID (step 2).\n\n\n\nIn step 3, the attacker uses the arbitrary code execution capability to retrieve the SMB and FTP credentials from the rmt_i.properties file. Subsequently, the attacker can now jump to step 5 and access the shares directly using the stolen credentials. Alternatively, after retrieving the share credentials, the mobile device can connect to a local network (step 4) and access an SMB or FTP share, allowing the attacker to access the shared files through the /sdcard/Android/data/com.mi.android.globalFileexplorer/files/usbTemp/ folder (step 5).\n\n\n\nRecommendations\n\n\n\nRecognizing that this vulnerability pattern may be widespread, we shared our findings with Google\u2019s Android Application Security Research team. We collaborated with Google to author guidance for Android application developers to help them recognize and avoid this pattern. We recommend developers and security analysts familiarize themselves with the excellent Android application security guidance provided by Google as well as make use of the Android Lint tool included with the Android SDK and integrated with Android Studio (supplemented with Google\u2019s additional security-focused checks) to identify and avoid potential vulnerabilities. GitHub\u2019s CodeQL also provides capabilities to identify vulnerabilities.\n\n\n\nTo prevent these issues, when handling file streams sent by other applications, the safest solution is to completely ignore the name returned by the remote file provider when caching the received content. Some of the most robust approaches we encountered use randomly generated names, so even in the case that the content of an incoming stream is malformed, it won\u2019t tamper with the application.\n\n\n\nIn cases where such an approach is not feasible, developers need to take extra steps to ascertain that the cached file is written to a dedicated directory. As an incoming file stream is usually identified by a content URI, the first step is to reliably identify and sanitize the corresponding filename. Besides filtering characters that may lead to a path traversal and before performing any write operation, developers must verify that the cached file is within the dedicated directory by performing a call to the File.getCanonicalPath and validating the prefix of the returned value.\n\n\n\nAnother area to safeguard is in the way developers try to extract a filename from a content URI. Developers often use Uri.getLastPathSegment(), which returns the (URL) decoded value of the last path URI segment. An attacker can craft a URI with URL encoded characters within this segment, including characters used for path traversal. Using the returned value to cache a file can again render the application vulnerable to this type of attack.\n\n\n\nFor end users, we recommend keeping mobile applications up to date through the Google Play Store (or other appropriate trusted source) to ensure that updates addressing known vulnerabilities are installed. Users should only install applications from trusted sources to avoid potentially malicious applications. We recommend users who accessed SMB or FTP shares through the Xiaomi app before updates to reset credentials and to investigate for any anomalous behavior. Microsoft Defender for Endpoint on Android can alert users and enterprises to malicious applications, and Microsoft Defender Vulnerability Management can identify installed applications with known vulnerabilities.\n\n\n\nDimitrios Valsamaras\n\n\n\nMicrosoft Threat Intelligence\n\n\n\nReferences\n\n\n\n\nhttps://www.blackhat.com/asia-23/briefings/schedule/index.html#dirty-stream-attack-turning-android-share-targets-into-attack-vectors-30234\n\n\n\nhttps://developer.android.com/privacy-and-security/risks/untrustworthy-contentprovider-provided-filename\n\n\n\nhttps://developer.android.com/reference/androidx/core/content/FileProvider\n\n\n\nhttps://developer.android.com/guide/topics/manifest/provider-element#gprmsn\n\n\n\nhttps://play.google.com/store/apps/details?id=com.mi.android.globalFileexplorer\n\n\n\nhttps://play.google.com/store/apps/details?id=cn.wps.moffice_eng\n\n\n\nhttps://googlesamples.github.io/android-custom-lint-rules/checks/UnsafeDynamicallyLoadedCode.md.html\n\n\n\nhttps://androidrank.org/application/file_manager/com.mi.android.globalFileexplorer\n\n\n\nhttps://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/app/SharedPreferencesImpl.java;l=150\n\n\n\nhttps://developer.android.com/privacy-and-security/risks\n\n\n\nhttps://developer.android.com/studio/write/lint#gradle\n\n\n\nhttps://github.com/google/android-security-lints/\n\n\n\nhttps://codeql.github.com/codeql-query-help/java/\n\n\n\n\nLearn more\n\n\n\nFor the latest security research from the Microsoft Threat Intelligence community, check out the Microsoft Threat Intelligence Blog:&nbsp;https://aka.ms/threatintelblog.\n\n\n\nTo get notified about new publications and to join discussions on social media, follow us on LinkedIn at https://www.linkedin.com/showcase/microsoft-threat-intelligence, and on X (formerly Twitter) at&nbsp;https://twitter.com/MsftSecIntel.\n\n\n\nTo hear stories and insights from the Microsoft Threat Intelligence community about the ever-evolving threat landscape, listen to the Microsoft Threat Intelligence podcast: https://thecyberwire.com/podcasts/microsoft-threat-intelligence.\n\t\t\t", "mentioned_links": ["https://www.microsoft.com/en-us/security/blog/products/microsoft-defender/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-external-id", "https://education.microsoft.com/", "https://play.google.com/store/apps/details?id=cn.wps.moffice_eng", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-endpoint-privilege-management", "https://www.microsoft.com/en-us/msrc/", "https://www.microsoft.com/en-us/trust-center", "https://codeql.github.com/codeql-query-help/java/", "https://www.microsoft.com/en-us/security/blog/2023/03/06/protecting-android-clipboard-content-from-unintended-exposure/", "https://azure.microsoft.com/en-us/products/key-vault/", "https://partner.microsoft.com/en-US/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-xdr", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-audit", "https://github.com/features/security", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-external-attack-surface-management", "https://www.microsoft.com/en-us/events", "https://azure.microsoft.com/en-us/products/ddos-protection/", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-compliance-manager", "https://www.microsoft.com/en-us/industry/consumer-goods", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-private-access", "https://www.microsoft.com/en-us/security/business/partnerships", "https://developer.android.com/guide/topics/manifest/provider-element#gprmsn", "https://account.microsoft.com/", "https://blogs.microsoft.com/", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/vulnerabilities-and-exploits/", "https://www.youtube.com/channel/UC4s3tv0Qq_OSUBfR735Jc6A", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-cloud-pki", "https://www.microsoft.com/en-us/security/business/get-started/contact-us", "https://www.microsoft.com/en-us/security/business/solutions/extended-detection-response-xdr", "https://www.microsoft.com/en-us/microsoft-viva", "https://www.microsoft.com/en-us/security/business/microsoft-purview", "https://twitter.com/msftsecurity", "https://news.microsoft.com/", "https://servicetrust.microsoft.com/", "https://www.microsoft.com/en-us/security", "https://www.microsoft.com/en-us/security/business/microsoft-priva", "https://dynamics.microsoft.com/en-us/", "https://www.microsoft.com/en-us/microsoft-copilot", "https://aka.ms/yourcaliforniaprivacychoices", "https://www.microsoft.com/en-us/industry/government", "https://about.ads.microsoft.com/en-us?s_cid=dig-src_uhfcomm", "https://twitter.com/intent/tweet?url=https://www.microsoft.com/en-us/security/blog/2024/05/01/dirty-stream-attack-discovering-and-mitigating-a-common-vulnerability-pattern-in-android-apps/", "https://aka.ms/threatintelblog", "https://www.microsoft.com/en-us/industry", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-data-lifecycle-management", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-workload-id", "https://www.microsoft.com/en-us/security/business/security-101", "https://www.microsoft.com/en-us/d/Surface-Laptop-Studio-2/8rqr54krf1dz", "https://learn.microsoft.com/en-us/learn/topics/sci?wt.mc_id=techcom_header-webpage-m365", "https://www.microsoft.com/en-us/d/Surface-Laptop-Go-3/8p0wwgj6c6l2", "https://www.microsoft.com/en-us/security/security-insider/microsoft-digital-defense-report-2023", "https://support.microsoft.com/contactus", "https://learn.microsoft.com/", "https://www.microsoft.com/en-us/mixed-reality/windows-mixed-reality", "https://thecyberwire.com/podcasts/microsoft-threat-intelligence", "https://learn.microsoft.com/en-us/security/", "https://azure.microsoft.com/en-us/solutions/quantum-computing/", "https://www.microsoft.com/en-us/security/business/services", "https://www.microsoft.com/en-us/security/blog/content-type/research/", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-cloud-security-posture-management", "https://www.microsoft.com/en-us/power-platform", "https://twitter.com/MsftSecIntel", "https://www.microsoft.com/en-us/security/business/services/microsoft-defender-experts-xdr", "https://www.microsoft.com/en-us/security/business/solutions/generative-ai-cybersecurity", "https://www.microsoft.com/en-us/education/devices/overview", "https://www.microsoft.com/en-us/accessibility", "https://www.microsoft.com/en-us/security/business/microsoft-Intune", "https://go.microsoft.com/fwlink/?linkid=2196228", "https://www.microsoft.com/en-us/industry/manufacturing/microsoft-cloud-for-manufacturing", "https://developer.android.com/privacy-and-security/risks/unsafe-uri-loading", "https://techcommunity.microsoft.com/", "https://techcommunity.microsoft.com/t5/security-compliance-and-identity/ct-p/MicrosoftSecurityandCompliance", "https://www.microsoft.com/en-us/microsoft-products-and-apps", "https://www.microsoft.com/en-us/microsoft-365/business", "https://github.com/google/android-security-lints/", "https://partner.microsoft.com/en-us/membership", "https://www.microsoft.com/en-us/security/blog/", "https://www.microsoft.com/en-us/store/b/certified-refurbished-products", "https://www.microsoft.com/en-us/store/b/business?icid=CNavBusinessStore", "https://about.ads.microsoft.com/en-us/partners/welcome?s_cid=en-us-gct-web-src_ext-sub_0-flx_uhfcombepartner", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-endpoint", "https://learn.microsoft.com/docs/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-verified-id", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-cloud-apps", "https://www.microsoft.com/en-us/microsoft-cloud", "https://www.microsoft.com/security/business/threat-protection/microsoft-defender-vulnerability-management", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-communication-compliance", "https://www.facebook.com/sharer.php?u=https://www.microsoft.com/en-us/security/blog/2024/05/01/dirty-stream-attack-discovering-and-mitigating-a-common-vulnerability-pattern-in-android-apps/", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-ediscovery", "https://go.microsoft.com/fwlink/?LinkID=206977", "https://www.microsoft.com/en-us/security/business/solutions/privacy-risk-management", "https://www.microsoft.com", "https://www.microsoft.com/en-us/security/business/risk-management/microsoft-purview-insider-risk-management", "https://www.microsoft.com/en-us/security/blog/2022/08/31/vulnerability-in-tiktok-android-app-could-lead-to-one-click-account-hijacking/", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-business", "https://www.microsoft.com/en-us/insidetrack", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-sentinel", "https://partner.microsoft.com/en-US/membership/cloud-solution-provider", "https://www.microsoft.com/en-us/education", "https://www.microsoft.com/en-us/security/business/zero-trust", "https://developer.android.com/studio/write/lint#gradle", "https://azure.microsoft.com/en-us/free/students/", "https://www.microsoft.com/msrc/msvr", "https://www.microsoft.com/en-us/store/b/education", "https://www.blackhat.com/asia-23/briefings/schedule/index.html#dirty-stream-attack-turning-android-share-targets-into-attack-vectors-30234", "https://developer.android.com/reference/androidx/core/content/FileProvider", "https://go.microsoft.com/fwlink/?LinkId=521839", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-permissions-management ", "https://www.microsoft.com/en-us/security/business/reports-analysis/industry-recognized-cybersecurity-leader", "https://www.microsoft.com/en-us/download", "https://www.microsoft.com/en-us/sitemap1.aspx", "https://www.microsoft.com/en-us/windows-365", "https://www.microsoft.com/en-us/security/business/microsoft-incident-response", "https://www.microsoft.com/en-us/security/business/services/microsoft-defender-experts-hunting", "https://www.linkedin.com/showcase/microsoft-threat-intelligence", "https://www.microsoft.com/en-us/security/business/threat-protection/microsoft-defender-vulnerability-management ", "https://www.microsoft.com/en-us/sustainability/", "https://www.microsoft.com/en-us/surface/devices/surface-laptop-7th-edition", "https://www.microsoft.com/windows/windows-11-apps", "https://www.microsoft.com/en-us/security/blog/products/microsoft-defender-vulnerability-management/", "https://www.microsoft.com/en-us/education/products/teams", "https://azuremarketplace.microsoft.com/en-us/", "https://www.microsoft.com/investor/default.aspx", "https://www.microsoft.com/en-us/store/b/payment-financing-options?icid=footer_financing_vcc", "https://www.microsoft.com/en-us/diversity/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-threat-intelligence", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id-governance", "https://www.microsoft.com/msrc/cvd", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-internet-access", "https://www.microsoft.com/en-us/security/business/cloud-security/microsoft-defender-cloud", "https://www.microsoft.com/en-us/security/business/microsoft-defender", "https://learn.microsoft.com/microsoft-365/security/defender-endpoint/microsoft-defender-endpoint-android?view=o365-worldwide", "https://www.linkedin.com/showcase/microsoft-security/", "https://events.microsoft.com/en-us/allevents/?language=English&clientTimeZone=1&search=security", "https://developer.android.com/guide/components/intents-filters#Types", "https://www.microsoft.com/en-us/security/business/services/microsoft-security-enterprise-services", "https://azure.microsoft.com/en-us/products/web-application-firewall/", "https://azure.microsoft.com/en-us/products/microsoft-entra-ds", "https://azure.microsoft.com/en-us/services/azure-firewall/", "https://www.microsoft.com/en-us/security/blog/2023/11/20/social-engineering-attacks-lure-indian-users-to-install-android-banking-trojans/", "https://www.microsoft.com/en-us/store/b/why-microsoft-store?icid=footer_why-msft-store_7102020", "https://go.microsoft.com/fwlink/?linkid=2196227", "javascript:void(0)", "https://learn.microsoft.com/en-us/security", "#", "https://www.microsoft.com/en-us/sitemap.aspx", "https://www.microsoft.com/en-us/security/business/ai-machine-learning/microsoft-copilot-security", "https://www.microsoft.com/en-us/industry/financial-services/banking", "https://www.microsoft.com/en-us/about", "https://www.microsoft.com/en-us/store/b/returns", "https://www.microsoft.com/en-us/security/locale", "https://androidrank.org/application/file_manager/com.mi.android.globalFileexplorer", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-security-exposure-management", "https://developer.android.com/training/sharing/send", "https://www.microsoft.com/en-us/industry/health/microsoft-cloud-for-healthcare", "https://play.google.com/store/apps/details?id=com.mi.android.globalFileexplorer", "https://www.microsoft.com/en-us/security/business/cybersecurity-awareness", "https://www.microsoft.com/en-us/microsoft-teams/group-chat-software", "https://www.linkedin.com/shareArticle?mini=true&url=https://www.microsoft.com/en-us/security/blog/2024/05/01/dirty-stream-attack-discovering-and-mitigating-a-common-vulnerability-pattern-in-android-apps/", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-data-loss-prevention", "https://www.microsoft.com/en-us/security/business/solutions/data-security", "https://privacy.microsoft.com/en-us", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-advanced-analytics", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-remote-help", "https://www.microsoft.com/en-us/hololens", "https://customers.microsoft.com/en-us/search?sq=Microsoft%20Security&ff=&p=0&so=story_publish_date%20desc", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id-protection ", "https://www.microsoft.com/en-us/security/blog/tag/remote-code-execution/", "https://developer.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-office-365", "https://www.microsoft.com/en-us/security/business/endpoint-management/microsoft-intune-enterprise-application-management", "https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-defender-for-identity", "https://www.microsoft.com/en-us/research/", "https://www.microsoft.com/en-us/industry/automotive", "https://www.microsoft.com/en-us/security/blog/tag/android/", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/threat-actors/", "https://www.microsoft.com/en-us/dynamics-365", "https://careers.microsoft.com/", "https://www.microsoft.com/en-us/security/business/services/compliance-program-microsoft-cloud", "https://www.microsoft.com/en-us/security/business/get-started/start-free-trial", "https://www.microsoft.com/en-us/security/business/solutions/cloud-workload-protection", "https://www.microsoft.com/en-us/legal/compliance/recycling", "https://developer.android.com/privacy-and-security/risks/untrustworthy-contentprovider-provided-filename", "https://www.microsoft.com/en-us/security/blog/threat-intelligence/mobile-threats/", "https://www.microsoft.com/en-us/security?wt.mc_id=AID730391_QSG_BLOG_319247&ocid=AID730391_QSG_BLOG_319247", "https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-iot", "https://www.microsoft.com/en-us/security/blog/author/microsoft-security-threat-intelligence/", "https://www.microsoft.com/en-us/surface/devices/surface-pro-11th-edition", "https://www.microsoft.com/en-us/windows/copilot-ai-features", "https://account.microsoft.com/orders", "https://www.microsoft.com/en-us/ai", "https://www.microsoft.com/en-us/education/buy-license/microsoft365", "https://go.microsoft.com/fwlink/?linkid=2259814", "https://www.microsoft.com/en-us/securityengineering", "https://www.microsoft.com/en-us/security/blog/tag/credential-theft/", "https://www.microsoft.com/en-us/security/business/solutions/identity-access", "https://www.microsoft.com/en-us/microsoft-365/business/", "https://www.microsoft.com/en-us/security/business/identity-access/microsoft-entra-id", "https://www.microsoft.com/en-us/licensing/", "https://choice.microsoft.com", "https://www.microsoft.com/en-us/security/security-insider/", "https://www.microsoft.com/en-us/security/business/solutions/ai-powered-unified-secops-platform", "https://azure.microsoft.com/en-us/", "https://www.microsoft.com/en-us/security/business/information-protection/microsoft-purview-information-protection", "https://www.microsoft.com/en-us/security/blog/topic/threat-intelligence/", "https://www.microsoft.com/en-us/security/business/solutions/cloud-security", "https://www.microsoft.com/en-us/microsoft-365/business/copilot-for-microsoft-365", "https://www.microsoft.com/en-us/security/blog/products/microsoft-defender-for-endpoint/", "https://www.microsoft.com/en-us/security/blog/2023/04/11/dev-0196-quadreams-kingspawn-malware-used-to-target-civil-society-in-europe-north-america-the-middle-east-and-southeast-asia/", "https://about.ads.microsoft.com/en-us/resources/microsoft-advertising-partner-program/microsoft-advertising-partner-program", "https://azure.microsoft.com/en-us/solutions/space/", "https://googlesamples.github.io/android-custom-lint-rules/checks/UnsafeDynamicallyLoadedCode.md.html", "https://visualstudio.microsoft.com/", "https://www.microsoft.com/en-us/security/business/privacy/microsoft-priva-risk-management", "https://www.microsoft.com/en-us/security/business/privacy/microsoft-priva-subject-rights-requests", "https://developer.android.com/privacy-and-security/risks", "https://appsource.microsoft.com/en-us/", "https://go.microsoft.com/fwlink/?linkid=2139749", "https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/app/SharedPreferencesImpl.java;l=150", "https://www.microsoft.com/education/how-to-buy", "https://www.microsoft.com/en-us/security/business/microsoft-entra", "https://www.microsoft.com/en-us/microsoft-cloud/resources/secure-future-initiative"]}]